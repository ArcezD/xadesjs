var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(a)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_get=function e(t,r,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,r);if(void 0===a){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in a)return a.value;var s=a.get;return void 0!==s?s.call(n):void 0},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.XAdES={})}(this,function(e){"use strict";var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};function r(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function n(e,t,r,n){var a,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(i<3?a(s):i>3?a(t,r,s):a(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s}function a(e,t,r,n){return new(r||(r=Promise))(function(a,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(s,o)}l((n=n.apply(e,t||[])).next())})}function i(e,t){var r,n,a,i,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(a=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){s.label=i[1];break}if(6===i[0]&&s.label<a[1]){s.label=a[1],a=i;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(i);break}a[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}}var s="element",o="attribute",l="content",u=1e9;function c(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var a=arguments[0],i=1;i<arguments.length;i++){var s=arguments[i];for(var o in s)s.hasOwnProperty(o)&&(a[o]=s[o])}return a}function h(e){return function(t){var r=t;r.localName=e.localName||r.name,r.namespaceURI=e.namespaceURI||r.namespaceURI||null,r.prefix=e.prefix||r.prefix||null,r.parser=e.parser||r.parser,r.target!==r&&(r.items=c({},r.items)),r.target=t}}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,r){var n=t.constructor,a=r;n.items||(n.items={}),n.target!==n&&(n.items=c({},n.items)),n.target=t,e.parser?n.items[a]={parser:e.parser,required:e.required||!1,maxOccurs:e.maxOccurs||u,minOccurs:void 0===e.minOccurs?0:e.minOccurs,noRoot:e.noRoot||!1}:n.items[a]={namespaceURI:e.namespaceURI||null,required:e.required||!1,prefix:e.prefix||null,defaultValue:e.defaultValue,converter:e.converter},e.localName=e.localName||e.parser&&e.parser.localName||a,n.items[a].namespaceURI=e.namespaceURI||e.parser&&e.parser.namespaceURI||null,n.items[a].prefix=e.prefix||e.parser&&e.parser.prefix||null,n.items[a].localName=e.localName,n.items[a].type=s,v(t,a,e)}}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{required:!1,namespaceURI:null};return function(t,r){var n=t.constructor,a=r;e.localName||(e.localName=r),n.items||(n.items={}),n.target!==n&&(n.items=c({},n.items)),n.target=t,n.items[r]=e,n.items[r].type=o,v(t,a,e)}}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{required:!1};return function(t,r){var n=t.constructor,a=r;n.items||(n.items={}),n.target!==n&&(n.items=c({},n.items)),n.target=t,n.items[r]=e,n.items[r].type=l,v(t,a,e)}}function v(e,t,r){var n="_"+t,a={set:function(e){this[n]!==e&&(this.element=null,this[n]=e)},get:function(){if(void 0===this[n]){var e=r.defaultValue;r.parser&&((e=new r.parser).localName=r.localName),this[n]=e}return this[n]}};Object.defineProperty(e,n,{writable:!0,enumerable:!1}),Object.defineProperty(e,t,a)}var d=function(){function e(t){_classCallCheck(this,e),this.items=new Array,t&&(this.items=t)}return _createClass(e,[{key:"Item",value:function(e){return this.items[e]||null}},{key:"Add",value:function(e){this.items.push(e)}},{key:"Pop",value:function(){return this.items.pop()}},{key:"RemoveAt",value:function(e){this.items=this.items.filter(function(t,r){return r!==e})}},{key:"Clear",value:function(){this.items=new Array}},{key:"GetIterator",value:function(){return this.items}},{key:"ForEach",value:function(e){this.GetIterator().forEach(e)}},{key:"Map",value:function(t){return new e(this.GetIterator().map(t))}},{key:"Filter",value:function(t){return new e(this.GetIterator().filter(t))}},{key:"Sort",value:function(t){return new e(this.GetIterator().sort(t))}},{key:"Every",value:function(e){return this.GetIterator().every(e)}},{key:"Some",value:function(e){return this.GetIterator().some(e)}},{key:"IsEmpty",value:function(){return 0===this.Count}},{key:"Count",get:function(){return this.items.length}}]),e}();var y,g,b=function e(t){for(var r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];_classCallCheck(this,e),this.prefix="XMLJS",this.code=t,this.name=this.constructor.name,arguments[0]=k[t];var i=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var a=e,i=/[^%](%\d+)/g,s=null,o=[];s=i.exec(a);)o.push({arg:s[1],index:s.index});for(var l=o.length-1;l>=0;l--){var u=o[l],c=u.arg.substring(1),h=u.index+1;a=a.substring(0,h)+arguments[+c]+a.substring(h+1+c.length)}return a=a.replace("%%","%")}.apply(this,arguments);this.message=""+this.prefix+function(e,t){for(var r=e+"";r.length<t;)r="0"+r;return r}(t,4)+": "+i,this.stack=new Error(this.message).stack};(g=y||(y={}))[g.NONE=0]="NONE",g[g.NULL_REFERENCE=1]="NULL_REFERENCE",g[g.NULL_PARAM=2]="NULL_PARAM",g[g.DECORATOR_NULL_PARAM=3]="DECORATOR_NULL_PARAM",g[g.COLLECTION_LIMIT=4]="COLLECTION_LIMIT",g[g.METHOD_NOT_IMPLEMENTED=5]="METHOD_NOT_IMPLEMENTED",g[g.METHOD_NOT_SUPPORTED=6]="METHOD_NOT_SUPPORTED",g[g.PARAM_REQUIRED=7]="PARAM_REQUIRED",g[g.CONVERTER_UNSUPPORTED=8]="CONVERTER_UNSUPPORTED",g[g.ELEMENT_MALFORMED=9]="ELEMENT_MALFORMED",g[g.ELEMENT_MISSING=10]="ELEMENT_MISSING",g[g.ATTRIBUTE_MISSING=11]="ATTRIBUTE_MISSING",g[g.CONTENT_MISSING=12]="CONTENT_MISSING",g[g.CRYPTOGRAPHIC=13]="CRYPTOGRAPHIC",g[g.CRYPTOGRAPHIC_NO_MODULE=14]="CRYPTOGRAPHIC_NO_MODULE",g[g.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM=15]="CRYPTOGRAPHIC_UNKNOWN_TRANSFORM",g[g.ALGORITHM_NOT_SUPPORTED=16]="ALGORITHM_NOT_SUPPORTED",g[g.ALGORITHM_WRONG_NAME=17]="ALGORITHM_WRONG_NAME",g[g.XML_EXCEPTION=18]="XML_EXCEPTION";var k={};k[y.NONE]="No decription",k[y.NULL_REFERENCE]="Null reference",k[y.NULL_PARAM]="'%1' has empty '%2' object",k[y.DECORATOR_NULL_PARAM]="Decorator '%1' has empty '%2' parameter",k[y.COLLECTION_LIMIT]="Collection of '%1' in element '%2' has wrong amount of items",k[y.METHOD_NOT_IMPLEMENTED]="Method is not implemented",k[y.METHOD_NOT_SUPPORTED]="Method is not supported",k[y.PARAM_REQUIRED]="Required parameter is missing '%1'",k[y.CONVERTER_UNSUPPORTED]="Converter is not supported",k[y.ELEMENT_MALFORMED]="Malformed element '%1'",k[y.ELEMENT_MISSING]="Element '%1' is missing in '%2'",k[y.ATTRIBUTE_MISSING]="Attribute '%1' is missing in '%2'",k[y.CONTENT_MISSING]="Content is missing in '%1'",k[y.CRYPTOGRAPHIC]="Cryptographic error: %1",k[y.CRYPTOGRAPHIC_NO_MODULE]="WebCrypto module is not found",k[y.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM]="Unknown transform %1",k[y.ALGORITHM_NOT_SUPPORTED]="Algorithm is not supported '%1'",k[y.ALGORITHM_WRONG_NAME]="Algorithm wrong name in use '%1'",k[y.XML_EXCEPTION]="XML exception: %1";var C,w,N=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"ToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=new Uint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);default:throw new b(y.CONVERTER_UNSUPPORTED)}}},{key:"FromString",value:function(e){switch((arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8").toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);default:throw new b(y.CONVERTER_UNSUPPORTED)}}},{key:"ToBase64",value:function(e){if("undefined"!=typeof btoa){var t=this.ToString(e,"binary");return btoa(t)}if("undefined"!=typeof Buffer)return new Buffer(e).toString("base64");throw new b(y.CONVERTER_UNSUPPORTED)}},{key:"FromBase64",value:function(e){if(e=e.replace(/\n/g,"").replace(/\r/g,"").replace(/\t/g,"").replace(/\s/g,""),"undefined"!=typeof atob)return this.FromBinary(atob(e));if("undefined"!=typeof Buffer)return new Buffer(e,"base64");throw new b(y.CONVERTER_UNSUPPORTED)}},{key:"FromBase64Url",value:function(e){return this.FromBase64(this.Base64Padding(e.replace(/\-/g,"+").replace(/\_/g,"/")))}},{key:"ToBase64Url",value:function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}},{key:"FromUtf8String",value:function(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r}},{key:"ToUtf8String",value:function(e){var t=String.fromCharCode.apply(null,e);return decodeURIComponent(escape(t))}},{key:"FromBinary",value:function(e){for(var t=e.length,r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r}},{key:"ToBinary",value:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}},{key:"ToHex",value:function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r].toString(16);t.push(1===n.length?"0"+n:n)}return t.join("")}},{key:"FromHex",value:function(e){for(var t=new Uint8Array(e.length/2),r=0;r<e.length;r+=2){var n=e.slice(r,r+2);t[r/2]=parseInt(n,16)}return t}},{key:"ToDateTime",value:function(e){return new Date(e)}},{key:"FromDateTime",value:function(e){return e.toISOString()}},{key:"Base64Padding",value:function(e){var t=4-e.length%4;if(t<4)for(var r=0;r<t;r++)e+="=";return e}}]),e}(),S="application/xml";(w=C||(C={}))[w.None=0]="None",w[w.Element=1]="Element",w[w.Attribute=2]="Attribute",w[w.Text=3]="Text",w[w.CDATA=4]="CDATA",w[w.EntityReference=5]="EntityReference",w[w.Entity=6]="Entity",w[w.ProcessingInstruction=7]="ProcessingInstruction",w[w.Comment=8]="Comment",w[w.Document=9]="Document",w[w.DocumentType=10]="DocumentType",w[w.DocumentFragment=11]="DocumentFragment",w[w.Notation=12]="Notation",w[w.Whitespace=13]="Whitespace",w[w.SignificantWhitespace=14]="SignificantWhitespace",w[w.EndElement=15]="EndElement",w[w.EndEntity=16]="EndEntity",w[w.XmlDeclaration=17]="XmlDeclaration";var A=function(e,t){throw new Error("Not implemented")},_=void 0;if("undefined"==typeof self){_=global;var P=require("xmldom-alpha");A=require("xpath.js"),_.XMLSerializer=P.XMLSerializer,_.DOMParser=P.DOMParser,_.DOMImplementation=P.DOMImplementation,_.document=(new DOMImplementation).createDocument("http://www.w3.org/1999/xhtml","html",null)}else _=self;var I="undefined"!=typeof self?function(e,t){for(var r=null==e.ownerDocument?e:e.ownerDocument,n=document.createNSResolver(null==e.ownerDocument?e.documentElement:e.ownerDocument.documentElement),a=r.evaluate(t,e,n,XPathResult.ANY_TYPE,null),i=[],s=void 0;s=a.iterateNext();)i.push(s);return i}:A;function E(e){return e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),(new DOMParser).parseFromString(e,S)}function R(e,t){var r=I(e,t);return r&&r.length>0?r[0]:null}function O(e){var t={};return function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t&&t.nodeType===C.Element){var n=t;n.namespaceURI&&"http://www.w3.org/XML/1998/namespace"!==n.namespaceURI&&!r[n.prefix||""]&&(r[n.prefix?n.prefix:""]=t.namespaceURI);for(var a=0;a<t.childNodes.length;a++){var i=t.childNodes.item(a);i&&i.nodeType===C.Element&&e(i,r)}}}(e,t),t}function B(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var a=arguments[0],i=1;i<arguments.length;i++){var s=arguments[i];for(var o in s)s.hasOwnProperty(o)&&(a[o]=s[o])}return a}var x={get:function(e){if(e)return N.ToBase64(e)},set:function(e){return N.FromBase64(e)}},U={get:function(e){return e?e.toString():"0"},set:function(e){return Number(e)}},D=function(){function e(){_classCallCheck(this,e),this.prefix=this.GetStatic().prefix||null,this.localName=this.GetStatic().localName,this.namespaceURI=this.GetStatic().namespaceURI}return _createClass(e,[{key:"HasChanged",value:function(){var e=this.GetStatic();if(e.items)for(var t in e.items)if(e.items.hasOwnProperty(t)){var r=e.items[t],n=this[t];if(r.parser&&n&&n.HasChanged())return!0}return null===this.element}},{key:"GetXml",value:function(e){if(!e&&!this.HasChanged())return this.element||null;var t=this.CreateDocument(),r=this.CreateElement(),n=this.GetStatic(),a=this.localName;if(n.items)for(var i in n.items)if(n.items.hasOwnProperty(i)){var u=this[i],c=n.items[i];switch(c.type){case l:var h=c,m=h.converter?h.converter.get(u):u;if(h.required&&null==m)throw new b(y.CONTENT_MISSING,a);(h.defaultValue!==u||h.required)&&(r.textContent=m);break;case o:var f=c,p=f.converter?f.converter.get(u):u;if(f.required&&null==p)throw new b(y.ATTRIBUTE_MISSING,f.localName,a);(f.defaultValue!==u||f.required)&&(f.namespaceURI?r.setAttributeNS(f.namespaceURI,f.localName,p):r.setAttribute(f.localName,p));break;case s:var v=c,d=null;if(v.parser){if(v.required&&!u||v.minOccurs&&!u.Count)throw new b(y.ELEMENT_MISSING,u.localName,a);u&&(d=u.GetXml(void 0===u.element&&(v.required||u.Count)))}else{var g=v.converter?v.converter.get(u):u;if(v.required&&void 0===g)throw new b(y.ELEMENT_MISSING,v.localName,a);(u!==v.defaultValue||v.required)&&((d=v.namespaceURI?t.createElementNS(v.namespaceURI,(v.prefix?v.prefix+":":"")+v.localName):t.createElement((v.prefix?v.prefix+":":"")+v.localName)).textContent=g)}if(d)if(v.noRoot){for(var k=[],w=0;w<d.childNodes.length;w++){var N=d.childNodes.item(w);N.nodeType===C.Element&&k.push(N)}if(k.length<v.minOccurs||k.length>v.maxOccurs)throw new b(y.COLLECTION_LIMIT,u.localName,n.localName);k.forEach(function(e){return r.appendChild(e.cloneNode(!0))})}else{if(d.childNodes.length<v.minOccurs||d.childNodes.length>v.maxOccurs)throw new b(y.COLLECTION_LIMIT,u.localName,n.localName);r.appendChild(d)}}}return this.OnGetXml(r),this.element=r,r}},{key:"LoadXml",value:function(e){var t=void 0;"string"==typeof e?t=E(e).documentElement:t=e;if(!t)throw new b(y.PARAM_REQUIRED,"element");var r=this.GetStatic(),n=this.localName;if(t.localName!==n||t.namespaceURI!=this.NamespaceURI)throw new b(y.ELEMENT_MALFORMED,n);if(r.items)for(var a in r.items)if(r.items.hasOwnProperty(a)){var i=r.items[a];switch(i.type){case l:var u=i;if(u.required&&!t.textContent)throw new b(y.CONTENT_MISSING,n);if(t.textContent){var c=u.converter?u.converter.set(t.textContent):t.textContent;this[a]=c}else this[a]=u.defaultValue;break;case o:var h=i,m=void 0,f=void 0;if(h.namespaceURI?(m=t.hasAttributeNS.bind(t,h.namespaceURI,h.localName),f=t.getAttributeNS.bind(t,h.namespaceURI,h.localName)):(m=t.hasAttribute.bind(t,h.localName),f=t.getAttribute.bind(t,h.localName)),h.required&&!m())throw new b(y.ATTRIBUTE_MISSING,h.localName,n);if(m()){var p=h.converter?h.converter.set(f()):f();this[a]=p}else this[a]=h.defaultValue;break;case s:var v=i;if(v.noRoot){if(!v.parser)throw new b(y.XML_EXCEPTION,"Schema for '"+v.localName+"' with flag noRoot must have 'parser'");var d=new v.parser;if(!(d instanceof L))throw new b(y.XML_EXCEPTION,"Schema for '"+v.localName+"' with flag noRoot must have 'parser' like instance of XmlCollection");if(d.OnLoadXml(t),delete d.element,d.Count<v.minOccurs||d.Count>v.maxOccurs)throw new b(y.COLLECTION_LIMIT,v.parser.localName,n);this[a]=d;continue}for(var g=null,k=0;k<t.childNodes.length;k++){var w=t.childNodes.item(k);if(w.nodeType===C.Element){var N=w;if(N.localName===v.localName&&N.namespaceURI==v.namespaceURI){g=N;break}}}if(v.required&&!g)throw new b(y.ELEMENT_MISSING,v.parser?v.parser.localName:v.localName,n);if(v.parser){if(g){var S=new v.parser;S.localName=v.localName,S.namespaceURI=v.namespaceURI,this[a]=S,S.LoadXml(g)}}else if(g){var A=v.converter?v.converter.set(g.textContent):g.textContent;this[a]=A}else this[a]=v.defaultValue}}this.OnLoadXml(t),this.prefix=t.prefix||"",this.element=t}},{key:"toString",value:function(){var e=this.GetXml();return e?(new XMLSerializer).serializeToString(e):""}},{key:"GetElement",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.element)throw new b(y.NULL_PARAM,this.localName);return e.GetElement(this.element,t,r)}},{key:"GetChildren",value:function(t,r){if(!this.element)throw new b(y.NULL_PARAM,this.localName);return e.GetChildren(this.element,t,r||this.NamespaceURI||void 0)}},{key:"GetChild",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.element)throw new b(y.NULL_PARAM,this.localName);return e.GetChild(this.element,t,this.NamespaceURI||void 0,r)}},{key:"GetFirstChild",value:function(t,r){if(!this.element)throw new b(y.NULL_PARAM,this.localName);return e.GetFirstChild(this.element,t,r)}},{key:"GetAttribute",value:function(t,r){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this.element)throw new b(y.NULL_PARAM,this.localName);return e.GetAttribute(this.element,t,r,n)}},{key:"IsEmpty",value:function(){return void 0===this.Element}},{key:"OnLoadXml",value:function(e){}},{key:"GetStatic",value:function(){return this.constructor}},{key:"GetPrefix",value:function(){return this.Prefix?this.prefix+":":""}},{key:"OnGetXml",value:function(e){}},{key:"CreateElement",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e||(e=this.CreateDocument()),t=t||this.localName,r=r||this.NamespaceURI,n=n||this.prefix;var a=e.createElementNS(this.NamespaceURI,(n?n+":":"")+t);return e.importNode(a,!0),a}},{key:"CreateDocument",value:function(){return e.CreateDocument(this.localName,this.NamespaceURI,this.Prefix)}},{key:"Element",get:function(){return this.element}},{key:"Prefix",get:function(){return this.prefix},set:function(e){this.prefix=e}},{key:"LocalName",get:function(){return this.localName}},{key:"NamespaceURI",get:function(){return this.namespaceURI||null}}],[{key:"LoadXml",value:function(e){var t=new this;return t.LoadXml(e),t}},{key:"GetElement",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=e.getElementsByTagName(t);if(r&&0===n.length)throw new b(y.ELEMENT_MISSING,t,e.localName);return n[0]||null}},{key:"GetAttribute",value:function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.hasAttribute(t))return e.getAttribute(t);if(n)throw new b(y.ATTRIBUTE_MISSING,t,e.localName);return r}},{key:"GetElementById",value:function(e,t){if(null==e||null==t)return null;var r=null;return e.nodeType===C.Document&&(r=e.getElementById(t)),null==r&&null==(r=R(e,"//*[@Id='"+t+"']"))&&null==(r=R(e,"//*[@ID='"+t+"']"))&&(r=R(e,"//*[@id='"+t+"']")),r}},{key:"CreateDocument",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"xml_root",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n="",a="",i="";r&&(n=r+":",a=":"+r),t&&(i=" xmlns"+a+'="'+t+'"');var s=""+n+e;return(new DOMParser).parseFromString("<"+s+i+"></"+s+">",S)}},{key:"GetChildren",value:function(e,t,r){e=e.documentElement||e;for(var n=[],a=0;a<e.childNodes.length;a++){var i=e.childNodes[a];i.nodeType!==C.Element||i.localName!==t||i.namespaceURI!==r&&r||n.push(i)}return n}},{key:"GetFirstChild",value:function(e,t,r){e=e.documentElement||e;for(var n=0;n<e.childNodes.length;n++){var a=e.childNodes[n];if(a.nodeType===C.Element&&a.localName===t&&(a.namespaceURI===r||!r))return a}return null}},{key:"GetChild",value:function(e,t,r){for(var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=0;a<e.childNodes.length;a++){var i=e.childNodes[a];if(i.nodeType===C.Element&&i.localName===t&&(i.namespaceURI===r||!r))return i}if(n)throw new b(y.ELEMENT_MISSING,t,e.localName);return null}}]),e}(),L=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.items=new Array,e}return _inherits(t,D),_createClass(t,[{key:"HasChanged",value:function(){var e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"HasChanged",this).call(this),r=this.Some(function(e){return e.HasChanged()});return e||r}},{key:"Item",value:function(e){return this.items[e]||null}},{key:"Add",value:function(e){this.items.push(e),this.element=null}},{key:"Pop",value:function(){return this.element=null,this.items.pop()}},{key:"RemoveAt",value:function(e){this.items=this.items.filter(function(t,r){return r!==e}),this.element=null}},{key:"Clear",value:function(){this.items=new Array,this.element=null}},{key:"GetIterator",value:function(){return this.items}},{key:"ForEach",value:function(e){this.GetIterator().forEach(e)}},{key:"Map",value:function(e){return new d(this.GetIterator().map(e))}},{key:"Filter",value:function(e){return new d(this.GetIterator().filter(e))}},{key:"Sort",value:function(e){return new d(this.GetIterator().sort(e))}},{key:"Every",value:function(e){return this.GetIterator().every(e)}},{key:"Some",value:function(e){return this.GetIterator().some(e)}},{key:"IsEmpty",value:function(){return 0===this.Count}},{key:"OnGetXml",value:function(e){var t=!0,r=!1,n=void 0;try{for(var a,i=this.GetIterator()[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value.GetXml();s&&e.appendChild(s)}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}}},{key:"OnLoadXml",value:function(e){var t=this.GetStatic();if(!t.parser)throw new b(y.XML_EXCEPTION,t.localName+" doesn't have required 'parser' in @XmlElement");for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes.item(r);if(n.nodeType===C.Element&&n.localName===t.parser.localName&&n.namespaceURI==t.namespaceURI){var a=n,i=new t.parser;i.LoadXml(a),this.Add(i)}}}},{key:"Count",get:function(){return this.items.length}}]),t}(),T=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,d),_createClass(t,[{key:"Add",value:function(e){e.prefix=e.prefix||"",e.namespace=e.namespace||"",_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Add",this).call(this,e)}},{key:"GetPrefix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.Count-1,r=this.Count-1;e=e||"",t>r&&(t=r);for(var n=t;n>=0;n--){var a=this.items[n];if(a.prefix===e)return a}return null}},{key:"GetNamespace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.Count-1,r=this.Count-1;e=e||"",t>r&&(t=r);for(var n=t;n>=0;n--){var a=this.items[n];if(a.namespace===e)return a}return null}}]),t}(),j={DefaultPrefix:"xades",NamespaceURI:"http://uri.etsi.org/01903/v1.3.2#",SignedPropertiesType:"http://uri.etsi.org/01903/v1.3.2#SignedProperties",ElementNames:{Any:"Any",ByName:"ByName",ByKey:"ByKey",AttrAuthoritiesCertValues:"AttrAuthoritiesCertValues",AttributeRevocationValues:"AttributeRevocationValues",AttributeCertificateRefs:"AttributeCertificateRefs",AttributeRevocationRefs:"AttributeRevocationRefs",QualifyingProperties:"QualifyingProperties",QualifyingPropertiesReference:"QualifyingPropertiesReference",SignedProperties:"SignedProperties",SignedSignatureProperties:"SignedSignatureProperties",SignedDataObjectProperties:"SignedDataObjectProperties",UnsignedProperties:"UnsignedProperties",UnsignedSignatureProperties:"UnsignedSignatureProperties",UnsignedDataObjectProperties:"UnsignedDataObjectProperties",UnsignedDataObjectProperty:"UnsignedDataObjectProperty",SigningTime:"SigningTime",SigningCertificate:"SigningCertificate",SignaturePolicyIdentifier:"SignaturePolicyIdentifier",SignatureProductionPlace:"SignatureProductionPlace",SignerRole:"SignerRole",Cert:"Cert",CertDigest:"CertDigest",IssuerSerial:"IssuerSerial",DataObjectFormat:"DataObjectFormat",CommitmentTypeIndication:"CommitmentTypeIndication",AllDataObjectsTimeStamp:"AllDataObjectsTimeStamp",IndividualDataObjectsTimeStamp:"IndividualDataObjectsTimeStamp",HashDataInfo:"HashDataInfo",EncapsulatedTimeStamp:"EncapsulatedTimeStamp",XMLTimeStamp:"XMLTimeStamp",XAdESTimeStamp:"XAdESTimeStamp",OtherTimeStamp:"OtherTimeStamp",Description:"Description",ObjectIdentifier:"ObjectIdentifier",MimeType:"MimeType",Encoding:"Encoding",Identifier:"Identifier",DocumentationReferences:"DocumentationReferences",DocumentationReference:"DocumentationReference",CommitmentTypeId:"CommitmentTypeId",ObjectReference:"ObjectReference",CommitmentTypeQualifiers:"CommitmentTypeQualifiers",AllSignedDataObjects:"AllSignedDataObjects",CommitmentTypeQualifier:"CommitmentTypeQualifier",SignaturePolicyId:"SignaturePolicyId",SignaturePolicyImplied:"SignaturePolicyImplied",SigPolicyId:"SigPolicyId",SigPolicyHash:"SigPolicyHash",SigPolicyQualifier:"SigPolicyQualifier",SigPolicyQualifiers:"SigPolicyQualifiers",SPURI:"SPURI",SPUserNotice:"SPUserNotice",NoticeRef:"NoticeRef",ExplicitText:"ExplicitText",ClaimedRoles:"ClaimedRoles",ClaimedRole:"ClaimedRole",CertifiedRoles:"CertifiedRoles",CertifiedRole:"CertifiedRole",Organization:"Organization",NoticeNumbers:"NoticeNumbers",Int:"int",City:"City",PostalCode:"PostalCode",StateOrProvince:"StateOrProvince",CountryName:"CountryName",CounterSignature:"CounterSignature",SignatureTimeStamp:"SignatureTimeStamp",CompleteCertificateRefs:"CompleteCertificateRefs",CompleteRevocationRefs:"CompleteRevocationRefs",SigAndRefsTimeStamp:"SigAndRefsTimeStamp",RefsOnlyTimeStamp:"RefsOnlyTimeStamp",CertificateValues:"CertificateValues",RevocationValues:"RevocationValues",ArchiveTimeStamp:"ArchiveTimeStamp",CertRefs:"CertRefs",CRLRefs:"CRLRefs",CRLRef:"CRLRef",OCSPRefs:"OCSPRefs",OtherRefs:"OtherRefs",OtherRef:"OtherRef",DigestAlgAndValue:"DigestAlgAndValue",CRLIdentifier:"CRLIdentifier",Issuer:"Issuer",IssueTime:"IssueTime",Number:"Number",OCSPRef:"OCSPRef",OCSPIdentifier:"OCSPIdentifier",ResponderID:"ResponderID",ProducedAt:"ProducedAt",EncapsulatedX509Certificate:"EncapsulatedX509Certificate",OtherCertificate:"OtherCertificate",CRLValues:"CRLValues",OCSPValues:"OCSPValues",OtherValues:"OtherValues",OtherValue:"OtherValue",EncapsulatedCRLValue:"EncapsulatedCRLValue",EncapsulatedOCSPValue:"EncapsulatedOCSPValue",ReferenceInfo:"ReferenceInfo",Include:"Include"},AttributeNames:{Id:"Id",Encoding:"Encoding",Target:"Target",ObjectReference:"ObjectReference",Qualifier:"Qualifier",Uri:"uri",URI:"URI",ReferencedData:"referencedData"}},H=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:"xades",namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix})],t)}(D),V=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:"xades_collection",namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix})],t)}(L),M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([p()],t.prototype,"Value",void 0),t=n([h({localName:j.ElementNames.Any})],t)}(H),K=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.Any})],t)}(V),X={get:function(e){switch(e){case"der":case"ber":case"cer":case"per":case"xer":return"http://uri.etsi.org/01903/v1.2.2#"+e.toUpperCase()}},set:function(e){var t=/#(\w+)$/.exec(e);return t?t[1].toLowerCase():null}},G=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),n([f({localName:j.AttributeNames.Encoding,defaultValue:null,converter:X})],t.prototype,"Encoding",void 0),n([p({required:!0,converter:x})],t.prototype,"Value",void 0),t=n([h({localName:"EncapsulatedPKIData"})],t)}(H),F=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.OtherCertificate})],t)}(M),J=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:"OtherCertificateCollection",parser:F})],t)}(V),q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.EncapsulatedX509Certificate})],t)}(G),W=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:"EncapsulatedX509CertificateCollection",parser:q})],t)}(V),Q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),n([m({parser:W,noRoot:!0})],t.prototype,"EncapsulatedX509Certificates",void 0),n([m({parser:J,noRoot:!0})],t.prototype,"OtherCertificates",void 0),t=n([h({localName:j.ElementNames.CertificateValues})],t)}(H),z=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.Qualifier})],t.prototype,"Qualifier",void 0),n([p({defaultValue:"",required:!0})],t.prototype,"Value",void 0),t=n([h({localName:j.ElementNames.Identifier})],t)}(H),Y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.OnLoadXml=function(e){e.textContent&&(this.Uri=e.textContent)},t.prototype.OnGetXml=function(e){this.Uri&&(e.textContent=this.Uri)},n([p({defaultValue:"",required:!0})],t.prototype,"Uri",void 0),t=n([h({localName:j.ElementNames.DocumentationReference})],t)}(H),Z=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.DocumentationReferences,parser:Y})],t)}(V),$=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([m({parser:z,required:!0})],t.prototype,"Identifier",void 0),n([m({localName:j.ElementNames.Description,namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix,defaultValue:""})],t.prototype,"Description",void 0),n([m({parser:Z})],t.prototype,"DocumentationReferences",void 0),t=n([h({localName:j.ElementNames.ObjectIdentifier})],t)}(H),ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.CommitmentTypeQualifier})],t)}(M),te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.CommitmentTypeQualifiers,parser:ee})],t)}(V),re=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([p({required:!0})],t.prototype,"Value",void 0),t=n([h({localName:j.ElementNames.ObjectReference})],t)}(H),ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:"ObjectReferences",parser:re})],t)}(V),ae={set:function(e){return!0},get:function(e){}},ie=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([m({localName:j.ElementNames.CommitmentTypeId,required:!0,namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix,parser:$})],t.prototype,"CommitmentTypeId",void 0),n([m({parser:ne,noRoot:!0})],t.prototype,"ObjectReference",void 0),n([m({localName:j.ElementNames.AllSignedDataObjects,namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix,converter:ae,defaultValue:!1})],t.prototype,"AllSignedDataObjects",void 0),n([m({localName:j.ElementNames.CommitmentTypeQualifiers,parser:ee})],t.prototype,"CommitmentTypeQualifiers",void 0),t=n([h({localName:j.ElementNames.CommitmentTypeIndication})],t)}(H);function se(e,t,r){return e instanceof Object==!1?r:t in e?e[t]:r}function oe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength,n="",a=!0,i=!1,s=void 0;try{for(var o,l=new Uint8Array(e,t,r)[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var u=o.value.toString(16).toUpperCase();n=n+(1===u.length?"0":"")+u}}catch(e){i=!0,s=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw s}}return n}function le(e,t,r,n){return t instanceof ArrayBuffer==!1?(e.error='Wrong parameter: inputBuffer must be "ArrayBuffer"',!1):0===t.byteLength?(e.error="Wrong parameter: inputBuffer has zero length",!1):r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):n<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-n<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1)}function ue(e,t){for(var r=0,n=e.length-1;n>=0;n--)r+=e[e.length-1-n]*Math.pow(2,t*n);return r}function ce(e,t){for(var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)||-1,n=e,a=0,i=Math.pow(2,t),s=1;s<8;s++){if(e<i){var o=void 0;if(r<0)o=new ArrayBuffer(s),a=s;else{if(r<s)return new ArrayBuffer(0);o=new ArrayBuffer(r),a=r}for(var l=new Uint8Array(o),u=s-1;u>=0;u--){var c=Math.pow(2,u*t);l[a-u-1]=Math.floor(n/c),n-=l[a-u-1]*c}return o}i*=Math.pow(2,t)}return new ArrayBuffer(0)}function he(){for(var e=0,t=0,r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];var i=!0,s=!1,o=void 0;try{for(var l,u=n[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){e+=l.value.byteLength}}catch(e){s=!0,o=e}finally{try{!i&&u.return&&u.return()}finally{if(s)throw o}}var c=new ArrayBuffer(e),h=new Uint8Array(c),m=!0,f=!1,p=void 0;try{for(var v,d=n[Symbol.iterator]();!(m=(v=d.next()).done);m=!0){var y=v.value;h.set(new Uint8Array(y),t),t+=y.byteLength}}catch(e){f=!0,p=e}finally{try{!m&&d.return&&d.return()}finally{if(f)throw p}}return c}function me(){for(var e=0,t=0,r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];var i=!0,s=!1,o=void 0;try{for(var l,u=n[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){e+=l.value.length}}catch(e){s=!0,o=e}finally{try{!i&&u.return&&u.return()}finally{if(s)throw o}}var c=new ArrayBuffer(e),h=new Uint8Array(c),m=!0,f=!1,p=void 0;try{for(var v,d=n[Symbol.iterator]();!(m=(v=d.next()).done);m=!0){var y=v.value;h.set(y,t),t+=y.length}}catch(e){f=!0,p=e}finally{try{!m&&d.return&&d.return()}finally{if(f)throw p}}return h}function fe(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),a=0;a<r.length;a++)if(r[a]!==n[a])return!1;return!0}function pe(e,t){for(var r=e.toString(10),n=t-r.length,a=new Array(n),i=0;i<n;i++)a[i]="0";return a.join("").concat(r)}var ve=[new Uint8Array([1])],de="0123456789",ye=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.blockLength=se(t,"blockLength",0),this.error=se(t,"error",""),this.warnings=se(t,"warnings",[]),this.valueBeforeDecode="valueBeforeDecode"in t?t.valueBeforeDecode.slice(0):new ArrayBuffer(0)}return _createClass(e,[{key:"toJSON",value:function(){return{blockName:this.constructor.blockName(),blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:oe(this.valueBeforeDecode,0,this.valueBeforeDecode.byteLength)}}}],[{key:"blockName",value:function(){return"baseBlock"}}]),e}(),ge=function(e){return function(t){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,r);var t=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.isHexOnly=se(e,"isHexOnly",!1),t.valueHex="valueHex"in e?e.valueHex.slice(0):new ArrayBuffer(0),t}return _inherits(r,e),_createClass(r,[{key:"fromBER",value:function(e,t,r){return!1===le(this,e,t,r)?-1:0===new Uint8Array(e,t,r).length?(this.warnings.push("Zero buffer length"),t):(this.valueHex=e.slice(t,t+r),this.blockLength=r,t+r)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!0!==this.isHexOnly?(this.error='Flag "isHexOnly" is not set, abort',new ArrayBuffer(0)):!0===e?new ArrayBuffer(this.valueHex.byteLength):this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.isHexOnly=this.isHexOnly,e.valueHex=oe(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"hexBlock"}}]),r}()},be=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return"idBlock"in e?(r.isHexOnly=se(e.idBlock,"isHexOnly",!1),r.valueHex=se(e.idBlock,"valueHex",new ArrayBuffer(0)),r.tagClass=se(e.idBlock,"tagClass",-1),r.tagNumber=se(e.idBlock,"tagNumber",-1),r.isConstructed=se(e.idBlock,"isConstructed",!1)):(r.tagClass=-1,r.tagNumber=-1,r.isConstructed=!1),r}return _inherits(t,ge(ye)),_createClass(t,[{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=0,r=void 0,n=void 0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",new ArrayBuffer(0)}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){if(r=new ArrayBuffer(1),n=new Uint8Array(r),!e){var a=this.tagNumber;t|=a&=31,n[0]=t}return r}if(!1===this.isHexOnly){var i=ce(this.tagNumber,7),s=new Uint8Array(i),o=i.byteLength;if(r=new ArrayBuffer(o+1),(n=new Uint8Array(r))[0]=31|t,!e){for(var l=0;l<o-1;l++)n[l+1]=128|s[l];n[o]=s[o-1]}return r}if(r=new ArrayBuffer(this.valueHex.byteLength+1),(n=new Uint8Array(r))[0]=31|t,!1===e){for(var u=new Uint8Array(this.valueHex),c=0;c<u.length-1;c++)n[c+1]=128|u[c];n[this.valueHex.byteLength]=u[u.length-1]}return r}},{key:"fromBER",value:function(e,t,r){if(!1===le(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.error="Zero buffer length",-1;switch(192&n[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&n[0]),this.isHexOnly=!1;var a=31&n[0];if(31!==a)this.tagNumber=a,this.blockLength=1;else{var i=1;this.valueHex=new ArrayBuffer(255);for(var s=255,o=new Uint8Array(this.valueHex);128&n[i];){if(o[i-1]=127&n[i],++i>=n.length)return this.error="End of input reached before message was fully decoded",-1;if(i===s){s+=255;for(var l=new ArrayBuffer(s),u=new Uint8Array(l),c=0;c<o.length;c++)u[c]=o[c];this.valueHex=new ArrayBuffer(s),o=new Uint8Array(this.valueHex)}}this.blockLength=i+1,o[i-1]=127&n[i];for(var h=new ArrayBuffer(i),m=new Uint8Array(h),f=0;f<i;f++)m[f]=o[f];this.valueHex=new ArrayBuffer(i),(o=new Uint8Array(this.valueHex)).set(m),this.blockLength<=9?this.tagNumber=ue(o,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.tagClass=this.tagClass,e.tagNumber=this.tagNumber,e.isConstructed=this.isConstructed,e}}],[{key:"blockName",value:function(){return"identificationBlock"}}]),t}(),ke=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return"lenBlock"in e?(r.isIndefiniteForm=se(e.lenBlock,"isIndefiniteForm",!1),r.longFormUsed=se(e.lenBlock,"longFormUsed",!1),r.length=se(e.lenBlock,"length",0)):(r.isIndefiniteForm=!1,r.longFormUsed=!1,r.length=0),r}return _inherits(t,ye),_createClass(t,[{key:"fromBER",value:function(e,t,r){if(!1===le(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.error="Zero buffer length",-1;if(255===n[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===n[0],!0===this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&n[0]),!1===this.longFormUsed)return this.length=n[0],this.blockLength=1,t+this.blockLength;var a=127&n[0];if(a>8)return this.error="Too big integer",-1;if(a+1>n.length)return this.error="End of input reached before message was fully decoded",-1;for(var i=new Uint8Array(a),s=0;s<a;s++)i[s]=n[s+1];return 0===i[a-1]&&this.warnings.push("Needlessly long encoded length"),this.length=ue(i,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unneccesary usage of long length form"),this.blockLength=a+1,t+this.blockLength}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=void 0,r=void 0;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),!1===e&&((r=new Uint8Array(t))[0]=128),t;if(!0===this.longFormUsed){var n=ce(this.length,8);if(n.byteLength>127)return this.error="Too big length",new ArrayBuffer(0);if(t=new ArrayBuffer(n.byteLength+1),!0===e)return t;var a=new Uint8Array(n);(r=new Uint8Array(t))[0]=128|n.byteLength;for(var i=0;i<n.byteLength;i++)r[i+1]=a[i];return t}return t=new ArrayBuffer(1),!1===e&&((r=new Uint8Array(t))[0]=this.length),t}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.isIndefiniteForm=this.isIndefiniteForm,e.longFormUsed=this.longFormUsed,e.length=this.length,e}}],[{key:"blockName",value:function(){return"lengthBlock"}}]),t}(),Ce=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,ye),_createClass(t,[{key:"fromBER",value:function(e,t,r){throw TypeError('User need to make a specific function in a class which extends "LocalValueBlock"')}},{key:"toBER",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];throw TypeError('User need to make a specific function in a class which extends "LocalValueBlock"')}}],[{key:"blockName",value:function(){return"valueBlock"}}]),t}(),we=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ce;_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return"name"in e&&(n.name=e.name),"optional"in e&&(n.optional=e.optional),"primitiveSchema"in e&&(n.primitiveSchema=e.primitiveSchema),n.idBlock=new be(e),n.lenBlock=new ke(e),n.valueBlock=new r(e),n}return _inherits(t,ye),_createClass(t,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=void 0,r=this.idBlock.toBER(e),n=this.valueBlock.toBER(!0);this.lenBlock.length=n.byteLength;if(t=he(t=he(r,this.lenBlock.toBER(e)),!1===e?this.valueBlock.toBER(e):new ArrayBuffer(this.lenBlock.length)),!0===this.lenBlock.isIndefiniteForm){var a=new ArrayBuffer(2);if(!1===e){var i=new Uint8Array(a);i[0]=0,i[1]=0}t=he(t,a)}return t}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.idBlock=this.idBlock.toJSON(),e.lenBlock=this.lenBlock.toJSON(),e.valueBlock=this.valueBlock.toJSON(),"name"in this&&(e.name=this.name),"optional"in this&&(e.optional=this.optional),"primitiveSchema"in this&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}}],[{key:"blockName",value:function(){return"BaseBlock"}}]),t}(),Ne=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.valueHex="valueHex"in e?e.valueHex.slice(0):new ArrayBuffer(0),r.isHexOnly=se(e,"isHexOnly",!0),r}return _inherits(t,Ce),_createClass(t,[{key:"fromBER",value:function(e,t,r){if(!1===le(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.warnings.push("Zero buffer length"),t;this.valueHex=new ArrayBuffer(n.length);for(var a=new Uint8Array(this.valueHex),i=0;i<n.length;i++)a[i]=n[i];return this.blockLength=r,t+r}},{key:"toBER",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.valueHex=oe(this.valueHex,0,this.valueHex.byteLength),e.isHexOnly=this.isHexOnly,e}}],[{key:"blockName",value:function(){return"PrimitiveValueBlock"}}]),t}(),Se=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Ne));return r.idBlock.isConstructed=!1,r}return _inherits(t,we),_createClass(t,null,[{key:"blockName",value:function(){return"PRIMITIVE"}}]),t}(),Ae=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.value=se(e,"value",[]),r.isIndefiniteForm=se(e,"isIndefiniteForm",!1),r}return _inherits(t,Ce),_createClass(t,[{key:"fromBER",value:function(e,t,r){var n=t,a=r;if(!1===le(this,e,t,r))return-1;if(0===new Uint8Array(e,t,r).length)return this.warnings.push("Zero buffer length"),t;for(var i=t;(!0===this.isIndefiniteForm?1:r)>0;){var s=gt(e,i,r);if(-1===s.offset)return this.error=s.result.error,this.warnings.concat(s.result.warnings),-1;if(i=s.offset,this.blockLength+=s.result.blockLength,r-=s.result.blockLength,this.value.push(s.result),!0===this.isIndefiniteForm&&s.result.constructor.blockName()===Ie.blockName())break}return!0===this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.blockName()===Ie.blockName()?this.value.pop():this.warnings.push("No EndOfContent block encoded")),this.valueBeforeDecode=e.slice(n,n+a),i}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(0),r=0;r<this.value.length;r++){t=he(t,this.value[r].toBER(e))}return t}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}e.isIndefiniteForm=this.isIndefiniteForm,e.value=[];for(var r=0;r<this.value.length;r++)e.value.push(this.value[r].toJSON());return e}}],[{key:"blockName",value:function(){return"ConstructedValueBlock"}}]),t}(),_e=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Ae));return r.idBlock.isConstructed=!0,r}return _inherits(t,we),_createClass(t,[{key:"fromBER",value:function(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}}],[{key:"blockName",value:function(){return"CONSTRUCTED"}}]),t}(),Pe=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,Ce),_createClass(t,[{key:"fromBER",value:function(e,t,r){return t}},{key:"toBER",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new ArrayBuffer(0)}}],[{key:"blockName",value:function(){return"EndOfContentValueBlock"}}]),t}(),Ie=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Pe));return r.idBlock.tagClass=1,r.idBlock.tagNumber=0,r}return _inherits(t,we),_createClass(t,null,[{key:"blockName",value:function(){return"EndOfContent"}}]),t}(),Ee=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));(r.value=se(e,"value",!1),r.isHexOnly=se(e,"isHexOnly",!1),"valueHex"in e)?r.valueHex=e.valueHex.slice(0):(r.valueHex=new ArrayBuffer(1),!0===r.value&&(new Uint8Array(r.valueHex)[0]=255));return r}return _inherits(t,Ce),_createClass(t,[{key:"fromBER",value:function(e,t,r){if(!1===le(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.value=0!==n[0],this.isHexOnly=!0,this.valueHex=new ArrayBuffer(n.length);for(var a=new Uint8Array(this.valueHex),i=0;i<n.length;i++)a[i]=n[i];return this.blockLength=r,t+r}},{key:"toBER",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.valueHex}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e.isHexOnly=this.isHexOnly,e.valueHex=oe(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"BooleanValueBlock"}}]),t}(),Re=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Ee));return r.idBlock.tagClass=1,r.idBlock.tagNumber=1,r}return _inherits(t,we),_createClass(t,null,[{key:"blockName",value:function(){return"Boolean"}}]),t}(),Oe=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=16,r}return _inherits(t,_e),_createClass(t,null,[{key:"blockName",value:function(){return"Sequence"}}]),t}(),Be=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=17,r}return _inherits(t,_e),_createClass(t,null,[{key:"blockName",value:function(){return"Set"}}]),t}(),xe=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,ye));return r.idBlock.tagClass=1,r.idBlock.tagNumber=5,r}return _inherits(t,we),_createClass(t,[{key:"fromBER",value:function(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(2);if(!0===e)return t;var r=new Uint8Array(t);return r[0]=5,r[1]=0,t}}],[{key:"blockName",value:function(){return"Null"}}]),t}(),Ue=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.isConstructed=se(e,"isConstructed",!1),r}return _inherits(t,ge(Ae)),_createClass(t,[{key:"fromBER",value:function(e,r,n){var a=0;if(!0===this.isConstructed){if(this.isHexOnly=!1,-1===(a=Ae.prototype.fromBER.call(this,e,r,n)))return a;for(var i=0;i<this.value.length;i++){var s=this.value[i].constructor.blockName();if(s===Ie.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(s!==De.blockName())return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,a=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"fromBER",this).call(this,e,r,n),this.blockLength=n;return a}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===this.isConstructed)return Ae.prototype.toBER.call(this,e);var t=new ArrayBuffer(this.valueHex.byteLength);return!0===e?t:0===this.valueHex.byteLength?t:t=this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=oe(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"OctetStringValueBlock"}}]),t}(),De=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Ue));return r.idBlock.tagClass=1,r.idBlock.tagNumber=4,r}return _inherits(t,we),_createClass(t,[{key:"fromBER",value:function(e,r,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===n?(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),r):_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"fromBER",this).call(this,e,r,n)}},{key:"isEqual",value:function(e){return e instanceof t!=!1&&JSON.stringify(this)===JSON.stringify(e)}}],[{key:"blockName",value:function(){return"OctetString"}}]),t}(),Le=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.unusedBits=se(e,"unusedBits",0),r.isConstructed=se(e,"isConstructed",!1),r.blockLength=r.valueHex.byteLength+1,r}return _inherits(t,ge(Ae)),_createClass(t,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;var n=-1;if(!0===this.isConstructed){if(-1===(n=Ae.prototype.fromBER.call(this,e,t,r)))return n;for(var a=0;a<this.value.length;a++){var i=this.value[a].constructor.blockName();if(i===Ie.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(i!==Te.blockName())return this.error="BIT STRING may consists of BIT STRINGs only",-1;if(this.unusedBits>0&&this.value[a].unusedBits>0)return this.error='Usign of "unused bits" inside constructive BIT STRING allowed for least one only',-1;if(this.unusedBits=this.value[a].unusedBits,this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1}return n}if(!1===le(this,e,t,r))return-1;var s=new Uint8Array(e,t,r);if(this.unusedBits=s[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;this.valueHex=new ArrayBuffer(s.length-1);for(var o=new Uint8Array(this.valueHex),l=0;l<r-1;l++)o[l]=s[l+1];return this.blockLength=s.length,t+r}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===this.isConstructed)return Ae.prototype.toBER.call(this,e);if(!0===e)return new ArrayBuffer(this.valueHex.byteLength+1);if(0===this.valueHex.byteLength)return new ArrayBuffer(0);var t=new Uint8Array(this.valueHex),r=new ArrayBuffer(this.valueHex.byteLength+1),n=new Uint8Array(r);n[0]=this.unusedBits;for(var a=0;a<this.valueHex.byteLength;a++)n[a+1]=t[a];return r}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.unusedBits=this.unusedBits,e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=oe(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"BitStringValueBlock"}}]),t}(),Te=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Le));return r.idBlock.tagClass=1,r.idBlock.tagNumber=3,r}return _inherits(t,we),_createClass(t,[{key:"fromBER",value:function(e,r,n){return 0===n?r:(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"fromBER",this).call(this,e,r,n))}},{key:"isEqual",value:function(e){return e instanceof t!=!1&&JSON.stringify(this)===JSON.stringify(e)}}],[{key:"blockName",value:function(){return"BitString"}}]),t}(),je=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return"value"in e&&(r.valueDec=e.value),r}return _inherits(t,ge(Ce)),_createClass(t,[{key:"fromDER",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=this.fromBER(e,t,r);if(-1===a)return a;var i=new Uint8Array(this._valueHex);if(0===i[0]&&0!=(128&i[1])){var s=new ArrayBuffer(this._valueHex.byteLength-1);new Uint8Array(s).set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=s.slice(0)}else if(0!==n&&this._valueHex.byteLength<n){n-this._valueHex.byteLength>1&&(n=this._valueHex.byteLength+1);var o=new ArrayBuffer(n);new Uint8Array(o).set(i,n-this._valueHex.byteLength),this._valueHex=o.slice(0)}return a}},{key:"toDER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new Uint8Array(this._valueHex);switch(!0){case 0!=(128&t[0]):var r=new ArrayBuffer(this._valueHex.byteLength+1),n=new Uint8Array(r);n[0]=0,n.set(t,1),this._valueHex=r.slice(0);break;case 0===t[0]&&0==(128&t[1]):var a=new ArrayBuffer(this._valueHex.byteLength-1);new Uint8Array(a).set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=a.slice(0)}return this.toBER(e)}},{key:"fromBER",value:function(e,r,n){var a=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"fromBER",this).call(this,e,r,n);return-1===a?a:(this.blockLength=n,r+n)}},{key:"toBER",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e}},{key:"toString",value:function(){function e(e,t){for(var r=new Uint8Array([0]),n=new Uint8Array(e),a=new Uint8Array(t),i=n.slice(0),s=i.length-1,o=a.slice(0),l=o.length-1,u=0,c=0,h=l<s?s:l;h>=0;h--,c++){switch(!0){case c<o.length:u=i[s-c]+o[l-c]+r[0];break;default:u=i[s-c]+r[0]}switch(r[0]=u/10,!0){case c>=i.length:i=me(new Uint8Array([u%10]),i);break;default:i[s-c]=u%10}}return r[0]>0&&(i=me(r,i)),i.slice(0)}function t(e){if(e>=ve.length)for(var t=ve.length;t<=e;t++){for(var r=new Uint8Array([0]),n=ve[t-1].slice(0),a=n.length-1;a>=0;a--){var i=new Uint8Array([(n[a]<<1)+r[0]]);r[0]=i[0]/10,n[a]=i[0]%10}r[0]>0&&(n=me(r,n)),ve.push(n)}return ve[e]}function r(e,t){for(var r=0,n=new Uint8Array(e),a=new Uint8Array(t),i=n.slice(0),s=i.length-1,o=a.slice(0),l=o.length-1,u=void 0,c=0,h=l;h>=0;h--,c++)switch(u=i[s-c]-o[l-c]-r,!0){case u<0:r=1,i[s-c]=u+10;break;default:r=0,i[s-c]=u}if(r>0)for(var m=s-l+1;m>=0;m--,c++){if(!((u=i[s-c]-r)<0)){r=0,i[s-c]=u;break}r=1,i[s-c]=u+10}return i.slice()}for(var n=8*this._valueHex.byteLength-1,a=new Uint8Array(8*this._valueHex.byteLength/3),i=0,s=void 0,o=new Uint8Array(this._valueHex),l="",u=!1,c=this._valueHex.byteLength-1;c>=0;c--){s=o[c];for(var h=0;h<8;h++){if(1==(1&s))switch(i){case n:a=r(t(i),a),l="-";break;default:a=e(a,t(i))}i++,s>>=1}}for(var m=0;m<a.length;m++)a[m]&&(u=!0),u&&(l+=de.charAt(a[m]));return!1===u&&(l+=de.charAt(0)),l}},{key:"valueHex",set:function(e){this._valueHex=e.slice(0),e.byteLength>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,e.byteLength>0&&(this._valueDec=function(){var e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){var t=255===e[0]&&128&e[1],r=0===e[0]&&0==(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}for(var n=new ArrayBuffer(this.valueHex.byteLength),a=new Uint8Array(n),i=0;i<this.valueHex.byteLength;i++)a[i]=0;a[0]=128&e[0];for(var s=ue(a,8),o=new ArrayBuffer(this.valueHex.byteLength),l=new Uint8Array(o),u=0;u<this.valueHex.byteLength;u++)l[u]=e[u];return l[0]&=127,ue(l,8)-s}.call(this)))},get:function(){return this._valueHex}},{key:"valueDec",set:function(e){this._valueDec=e,this.isHexOnly=!1,this._valueHex=function(e){for(var t=e<0?-1*e:e,r=128,n=1;n<8;n++){if(t<=r){if(e<0){var a=ce(r-t,8,n);return new Uint8Array(a)[0]|=128,a}var i=ce(t,8,n),s=new Uint8Array(i);if(128&s[0]){var o=i.slice(0),l=new Uint8Array(o);i=new ArrayBuffer(i.byteLength+1),s=new Uint8Array(i);for(var u=0;u<o.byteLength;u++)s[u+1]=l[u];s[0]=0}return i}r*=Math.pow(2,8)}return new ArrayBuffer(0)}(e)},get:function(){return this._valueDec}}],[{key:"blockName",value:function(){return"IntegerValueBlock"}}]),t}(),He=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,je));return r.idBlock.tagClass=1,r.idBlock.tagNumber=2,r}return _inherits(t,we),_createClass(t,[{key:"isEqual",value:function(e){return e instanceof t?this.valueBlock.isHexOnly&&e.valueBlock.isHexOnly?fe(this.valueBlock.valueHex,e.valueBlock.valueHex):this.valueBlock.isHexOnly===e.valueBlock.isHexOnly&&this.valueBlock.valueDec===e.valueBlock.valueDec:e instanceof ArrayBuffer&&fe(this.valueBlock.valueHex,e)}},{key:"convertToDER",value:function(){var e=new t({valueHex:this.valueBlock.valueHex});return e.valueBlock.toDER(),e}},{key:"convertFromDER",value:function(){var e=this.valueBlock.valueHex.byteLength%2?this.valueBlock.valueHex.byteLength+1:this.valueBlock.valueHex.byteLength,r=new t({valueHex:this.valueBlock.valueHex});return r.valueBlock.fromDER(r.valueBlock.valueHex,0,r.valueBlock.valueHex.byteLength,e),r}}],[{key:"blockName",value:function(){return"Integer"}}]),t}(),Ve=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=10,r}return _inherits(t,He),_createClass(t,null,[{key:"blockName",value:function(){return"Enumerated"}}]),t}(),Me=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.valueDec=se(e,"valueDec",-1),r.isFirstSid=se(e,"isFirstSid",!1),r}return _inherits(t,ge(ye)),_createClass(t,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;if(!1===le(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);for(var a=new Uint8Array(this.valueHex),i=0;i<r&&(a[i]=127&n[i],this.blockLength++,0!=(128&n[i]));i++);for(var s=new ArrayBuffer(this.blockLength),o=new Uint8Array(s),l=0;l<this.blockLength;l++)o[l]=a[l];return this.valueHex=s.slice(0),a=new Uint8Array(this.valueHex),0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===a[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=ue(a,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=void 0,r=void 0;if(this.isHexOnly){if(!0===e)return new ArrayBuffer(this.valueHex.byteLength);var n=new Uint8Array(this.valueHex);t=new ArrayBuffer(this.blockLength),r=new Uint8Array(t);for(var a=0;a<this.blockLength-1;a++)r[a]=128|n[a];return r[this.blockLength-1]=n[this.blockLength-1],t}var i=ce(this.valueDec,7);if(0===i.byteLength)return this.error="Error during encoding SID value",new ArrayBuffer(0);if(t=new ArrayBuffer(i.byteLength),!1===e){var s=new Uint8Array(i);r=new Uint8Array(t);for(var o=0;o<i.byteLength-1;o++)r[o]=128|s[o];r[i.byteLength-1]=s[i.byteLength-1]}return t}},{key:"toString",value:function(){var e="";if(!0===this.isHexOnly)e=oe(this.valueHex,0,this.valueHex.byteLength);else if(this.isFirstSid){var t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e.isFirstSid=this.isFirstSid,e}}],[{key:"blockName",value:function(){return"sidBlock"}}]),t}(),Ke=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.fromString(se(e,"value","")),r}return _inherits(t,Ce),_createClass(t,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var a=new Me;if(-1===(n=a.fromBER(e,n,r)))return this.blockLength=0,this.error=a.error,n;0===this.value.length&&(a.isFirstSid=!0),this.blockLength+=a.blockLength,r-=a.blockLength,this.value.push(a)}return n}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(0),r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,new ArrayBuffer(0);t=he(t,n)}return t}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="",a=!1;do{if(n=-1===(r=e.indexOf(".",t))?e.substr(t):e.substr(t,r-t),t=r+1,a){var i=this.value[0],s=0;switch(i.valueDec){case 0:break;case 1:s=40;break;case 2:s=80;break;default:return this.value=[],!1}var o=parseInt(n,10);if(isNaN(o))return!0;i.valueDec=o+s,a=!1}else{var l=new Me;if(l.valueDec=parseInt(n,10),isNaN(l.valueDec))return!0;0===this.value.length&&(l.isFirstSid=!0,a=!0),this.value.push(l)}}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e+="."),t?(n="{"+n+"}",this.value[r].isFirstSid?e="2.{"+n+" - 80}":e+=n):e+=n}return e}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}e.value=this.toString(),e.sidArray=[];for(var r=0;r<this.value.length;r++)e.sidArray.push(this.value[r].toJSON());return e}}],[{key:"blockName",value:function(){return"ObjectIdentifierValueBlock"}}]),t}(),Xe=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Ke));return r.idBlock.tagClass=1,r.idBlock.tagNumber=6,r}return _inherits(t,we),_createClass(t,null,[{key:"blockName",value:function(){return"ObjectIdentifier"}}]),t}(),Ge=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.isHexOnly=!0,r.value="",r}return _inherits(t,ge(ye)),_createClass(t,[{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"Utf8StringValueBlock"}}]),t}(),Fe=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Ge));return"value"in e&&r.fromString(e.value),r.idBlock.tagClass=1,r.idBlock.tagNumber=12,r}return _inherits(t,we),_createClass(t,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e));try{this.valueBlock.value=decodeURIComponent(escape(this.valueBlock.value))}catch(e){this.warnings.push('Error during "decodeURIComponent": '+e+", using raw string")}}},{key:"fromString",value:function(e){var t=unescape(encodeURIComponent(e)),r=t.length;this.valueBlock.valueHex=new ArrayBuffer(r);for(var n=new Uint8Array(this.valueBlock.valueHex),a=0;a<r;a++)n[a]=t.charCodeAt(a);this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"Utf8String"}}]),t}(),Je=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.isHexOnly=!0,r.value="",r}return _inherits(t,ge(ye)),_createClass(t,[{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"BmpStringValueBlock"}}]),t}(),qe=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Je));return"value"in e&&r.fromString(e.value),r.idBlock.tagClass=1,r.idBlock.tagNumber=30,r}return _inherits(t,we),_createClass(t,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){for(var t=e.slice(0),r=new Uint8Array(t),n=0;n<r.length;n+=2){var a=r[n];r[n]=r[n+1],r[n+1]=a}this.valueBlock.value=String.fromCharCode.apply(null,new Uint16Array(t))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(2*t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++){var a=ce(e.charCodeAt(n),8),i=new Uint8Array(a);if(!(i.length>2))for(var s=2-i.length,o=i.length-1;o>=0;o--)r[2*n+o+s]=i[o]}this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"BmpString"}}]),t}(),We=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.isHexOnly=!0,r.value="",r}return _inherits(t,ge(ye)),_createClass(t,[{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"UniversalStringValueBlock"}}]),t}(),Qe=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,We));return"value"in e&&r.fromString(e.value),r.idBlock.tagClass=1,r.idBlock.tagNumber=28,r}return _inherits(t,we),_createClass(t,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){for(var t=e.slice(0),r=new Uint8Array(t),n=0;n<r.length;n+=4)r[n]=r[n+3],r[n+1]=r[n+2],r[n+2]=0,r[n+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(4*t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++){var a=ce(e.charCodeAt(n),8),i=new Uint8Array(a);if(!(i.length>4))for(var s=4-i.length,o=i.length-1;o>=0;o--)r[4*n+o+s]=i[o]}this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"UniversalString"}}]),t}(),ze=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.value="",r.isHexOnly=!0,r}return _inherits(t,ge(ye)),_createClass(t,[{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"SimpleStringValueBlock"}}]),t}(),Ye=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,ze));return"value"in e&&r.fromString(e.value),r}return _inherits(t,we),_createClass(t,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"SIMPLESTRING"}}]),t}(),Ze=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=18,r}return _inherits(t,Ye),_createClass(t,null,[{key:"blockName",value:function(){return"NumericString"}}]),t}(),$e=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=19,r}return _inherits(t,Ye),_createClass(t,null,[{key:"blockName",value:function(){return"PrintableString"}}]),t}(),et=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=20,r}return _inherits(t,Ye),_createClass(t,null,[{key:"blockName",value:function(){return"TeletexString"}}]),t}(),tt=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=21,r}return _inherits(t,Ye),_createClass(t,null,[{key:"blockName",value:function(){return"VideotexString"}}]),t}(),rt=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=22,r}return _inherits(t,Ye),_createClass(t,null,[{key:"blockName",value:function(){return"IA5String"}}]),t}(),nt=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=25,r}return _inherits(t,Ye),_createClass(t,null,[{key:"blockName",value:function(){return"GraphicString"}}]),t}(),at=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=26,r}return _inherits(t,Ye),_createClass(t,null,[{key:"blockName",value:function(){return"VisibleString"}}]),t}(),it=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=27,r}return _inherits(t,Ye),_createClass(t,null,[{key:"blockName",value:function(){return"GeneralString"}}]),t}(),st=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=29,r}return _inherits(t,Ye),_createClass(t,null,[{key:"blockName",value:function(){return"CharacterString"}}]),t}(),ot=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(r.year=0,r.month=0,r.day=0,r.hour=0,r.minute=0,r.second=0,"value"in e){r.fromString(e.value),r.valueBlock.valueHex=new ArrayBuffer(e.value.length);for(var n=new Uint8Array(r.valueBlock.valueHex),a=0;a<e.value.length;a++)n[a]=e.value.charCodeAt(a)}return"valueDate"in e&&(r.fromDate(e.valueDate),r.valueBlock.valueHex=r.toBuffer()),r.idBlock.tagClass=1,r.idBlock.tagNumber=23,r}return _inherits(t,at),_createClass(t,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}},{key:"fromString",value:function(e){var t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null!==t){var r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}else this.error="Wrong input string for convertion"}},{key:"toString",value:function(){var e=new Array(7);return e[0]=pe(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=pe(this.month,2),e[2]=pe(this.day,2),e[3]=pe(this.hour,2),e[4]=pe(this.minute,2),e[5]=pe(this.second,2),e[6]="Z",e.join("")}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e}}],[{key:"blockName",value:function(){return"UTCTime"}}]),t}(),lt=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(r.year=0,r.month=0,r.day=0,r.hour=0,r.minute=0,r.second=0,r.millisecond=0,"value"in e){r.fromString(e.value),r.valueBlock.valueHex=new ArrayBuffer(e.value.length);for(var n=new Uint8Array(r.valueBlock.valueHex),a=0;a<e.value.length;a++)n[a]=e.value.charCodeAt(a)}return"valueDate"in e&&(r.fromDate(e.valueDate),r.valueBlock.valueHex=r.toBuffer()),r.idBlock.tagClass=1,r.idBlock.tagNumber=24,r}return _inherits(t,at),_createClass(t,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}},{key:"fromString",value:function(e){var t=!1,r="",n="",a=0,i=void 0,s=0,o=0;if("Z"===e[e.length-1])r=e.substr(0,e.length-1),t=!0;else{var l=new Number(e[e.length-1]);if(isNaN(l.valueOf()))throw new Error("Wrong input string for convertion");r=e}if(t){if(-1!==r.indexOf("+"))throw new Error("Wrong input string for convertion");if(-1!==r.indexOf("-"))throw new Error("Wrong input string for convertion")}else{var u=1,c=r.indexOf("+"),h="";if(-1===c&&(c=r.indexOf("-"),u=-1),-1!==c){if(h=r.substr(c+1),r=r.substr(0,c),2!==h.length&&4!==h.length)throw new Error("Wrong input string for convertion");var m=new Number(h.substr(0,2));if(isNaN(m.valueOf()))throw new Error("Wrong input string for convertion");if(s=u*m,4===h.length){if(m=new Number(h.substr(2,2)),isNaN(m.valueOf()))throw new Error("Wrong input string for convertion");o=u*m}}}var f=r.indexOf(".");if(-1===f&&(f=r.indexOf(",")),-1!==f){var p=new Number("0"+r.substr(f));if(isNaN(p.valueOf()))throw new Error("Wrong input string for convertion");a=p.valueOf(),n=r.substr(0,f)}else n=r;switch(!0){case 8===n.length:if(i=/(\d{4})(\d{2})(\d{2})/gi,-1!==f)throw new Error("Wrong input string for convertion");break;case 10===n.length:if(i=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==f){var v=60*a;this.minute=Math.floor(v),v=60*(v-this.minute),this.second=Math.floor(v),v=1e3*(v-this.second),this.millisecond=Math.floor(v)}break;case 12===n.length:if(i=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==f){var d=60*a;this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case 14===n.length:if(i=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==f){var y=1e3*a;this.millisecond=Math.floor(y)}break;default:throw new Error("Wrong input string for convertion")}var g=i.exec(n);if(null===g)throw new Error("Wrong input string for convertion");for(var b=1;b<g.length;b++)switch(b){case 1:this.year=parseInt(g[b],10);break;case 2:this.month=parseInt(g[b],10);break;case 3:this.day=parseInt(g[b],10);break;case 4:this.hour=parseInt(g[b],10)+s;break;case 5:this.minute=parseInt(g[b],10)+o;break;case 6:this.second=parseInt(g[b],10);break;default:throw new Error("Wrong input string for convertion")}if(!1===t){var k=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=k.getUTCFullYear(),this.month=k.getUTCMonth(),this.day=k.getUTCDay(),this.hour=k.getUTCHours(),this.minute=k.getUTCMinutes(),this.second=k.getUTCSeconds(),this.millisecond=k.getUTCMilliseconds()}}},{key:"toString",value:function(){var e=[];return e.push(pe(this.year,4)),e.push(pe(this.month,2)),e.push(pe(this.day,2)),e.push(pe(this.hour,2)),e.push(pe(this.minute,2)),e.push(pe(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(pe(this.millisecond,3))),e.push("Z"),e.join("")}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e.millisecond=this.millisecond,e}}],[{key:"blockName",value:function(){return"GeneralizedTime"}}]),t}(),ut=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=31,r}return _inherits(t,Fe),_createClass(t,null,[{key:"blockName",value:function(){return"DATE"}}]),t}(),ct=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=32,r}return _inherits(t,Fe),_createClass(t,null,[{key:"blockName",value:function(){return"TimeOfDay"}}]),t}(),ht=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=33,r}return _inherits(t,Fe),_createClass(t,null,[{key:"blockName",value:function(){return"DateTime"}}]),t}(),mt=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=34,r}return _inherits(t,Fe),_createClass(t,null,[{key:"blockName",value:function(){return"Duration"}}]),t}(),ft=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=14,r}return _inherits(t,Fe),_createClass(t,null,[{key:"blockName",value:function(){return"TIME"}}]),t}(),pt=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.value=se(t,"value",[]),this.optional=se(t,"optional",!1)},vt=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.name=se(t,"name",""),this.optional=se(t,"optional",!1)},dt=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.name=se(t,"name",""),this.optional=se(t,"optional",!1),this.value=se(t,"value",new vt),this.local=se(t,"local",!1)},yt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.data=se(t,"data",new ArrayBuffer(0))}return _createClass(e,[{key:"fromBER",value:function(e,t,r){this.data=e.slice(t,r)}},{key:"toBER",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.data}}]),e}();function gt(e,t,r){var n=t;var a=new we({},Object);if(!1===le(new ye,e,t,r))return a.error="Wrong input parameters",{offset:-1,result:a};if(0===new Uint8Array(e,t,r).length)return this.error="Zero buffer length",{offset:-1,result:a};var i=a.idBlock.fromBER(e,t,r);if(a.warnings.concat(a.idBlock.warnings),-1===i)return a.error=a.idBlock.error,{offset:-1,result:a};if(t=i,r-=a.idBlock.blockLength,i=a.lenBlock.fromBER(e,t,r),a.warnings.concat(a.lenBlock.warnings),-1===i)return a.error=a.lenBlock.error,{offset:-1,result:a};if(t=i,r-=a.lenBlock.blockLength,!1===a.idBlock.isConstructed&&!0===a.lenBlock.isIndefiniteForm)return a.error="Indefinite length form used for primitive encoding form",{offset:-1,result:a};var s=we;switch(a.idBlock.tagClass){case 1:if(a.idBlock.tagNumber>=37&&!1===a.idBlock.isHexOnly)return a.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:a};switch(a.idBlock.tagNumber){case 0:if(!0===a.idBlock.isConstructed&&a.lenBlock.length>0)return a.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:a};s=Ie;break;case 1:s=Re;break;case 2:s=He;break;case 3:s=Te;break;case 4:s=De;break;case 5:s=xe;break;case 6:s=Xe;break;case 10:s=Ve;break;case 12:s=Fe;break;case 14:s=ft;break;case 15:return a.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:a};case 16:s=Oe;break;case 17:s=Be;break;case 18:s=Ze;break;case 19:s=$e;break;case 20:s=et;break;case 21:s=tt;break;case 22:s=rt;break;case 23:s=ot;break;case 24:s=lt;break;case 25:s=nt;break;case 26:s=at;break;case 27:s=it;break;case 28:s=Qe;break;case 29:s=st;break;case 30:s=qe;break;case 31:s=ut;break;case 32:s=ct;break;case 33:s=ht;break;case 34:s=mt;break;default:var o=void 0;(o=!0===a.idBlock.isConstructed?new _e:new Se).idBlock=a.idBlock,o.lenBlock=a.lenBlock,o.warnings=a.warnings,i=(a=o).fromBER(e,t,r)}break;case 2:case 3:case 4:default:s=!0===a.idBlock.isConstructed?_e:Se}return i=(a=function(e,t){if(e instanceof t)return e;var r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecode=e.valueBeforeDecode.slice(0),r}(a,s)).fromBER(e,t,!0===a.lenBlock.isIndefiniteForm?r:a.lenBlock.length),a.valueBeforeDecode=e.slice(n,n+a.blockLength),{offset:i,result:a}}function bt(e){if(0===e.byteLength){var t=new we({},Object);return t.error="Input buffer has zero length",{offset:-1,result:t}}return gt(e,0,e.byteLength)}function kt(e,t,r){if(r instanceof pt){for(var n=0;n<r.value.length;n++){if(!0===kt(e,t,r.value[n]).verified)return{verified:!0,result:e}}var a={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty("name")&&(a.name=r.name),a}if(r instanceof vt)return r.hasOwnProperty("name")&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==!1)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("idBlock"in r==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var i=r.idBlock.toBER(!1);if(0===i.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(i,0,i.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if("isHexOnly"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(!0===r.idBlock.isHexOnly){if("valueHex"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var s=new Uint8Array(r.idBlock.valueHex),o=new Uint8Array(t.idBlock.valueHex);if(s.length!==o.length)return{verified:!1,result:e};for(var l=0;l<s.length;l++)if(s[l]!==o[1])return{verified:!1,result:e}}if(r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(e[r.name]=t)),!0===r.idBlock.isConstructed){var u=0,c={verified:!1},h=r.valueBlock.value.length;if(h>0&&r.valueBlock.value[0]instanceof dt&&(h=t.valueBlock.value.length),0===h)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){for(var m=!0,f=0;f<r.valueBlock.value.length;f++)m=m&&(r.valueBlock.value[f].optional||!1);return!0===m?{verified:!0,result:e}:(r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(var p=0;p<h;p++)if(p-u>=t.valueBlock.value.length){if(!1===r.valueBlock.value[p].optional){var v={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],v.name=r.name)),v}}else if(r.valueBlock.value[0]instanceof dt){if(!1===(c=kt(e,t.valueBlock.value[p],r.valueBlock.value[0].value)).verified){if(!0!==r.valueBlock.value[0].optional)return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),c;u++}if("name"in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){var d={};void 0===(d="local"in r.valueBlock.value[0]&&!0===r.valueBlock.value[0].local?t:e)[r.valueBlock.value[0].name]&&(d[r.valueBlock.value[0].name]=[]),d[r.valueBlock.value[0].name].push(t.valueBlock.value[p])}}else if(!1===(c=kt(e,t.valueBlock.value[p-u],r.valueBlock.value[p])).verified){if(!0!==r.valueBlock.value[p].optional)return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),c;u++}if(!1===c.verified){var y={verified:!1,result:e};return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],y.name=r.name)),y}return{verified:!0,result:e}}if("primitiveSchema"in r&&"valueHex"in t.valueBlock){var g=bt(t.valueBlock.valueHex);if(-1===g.offset){var b={verified:!1,result:g.result};return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],b.name=r.name)),b}return kt(e,g.result,r.primitiveSchema)}return{verified:!0,result:e}}function Ct(e,t,r){return e instanceof Object==!1?r:t in e?e[t]:r}function wt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength,n="",a=!0,i=!1,s=void 0;try{for(var o,l=new Uint8Array(e,t,r)[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var u=o.value.toString(16).toUpperCase();n=n+(1===u.length?"0":"")+u}}catch(e){i=!0,s=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw s}}return n}function Nt(){for(var e=0,t=0,r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];var i=!0,s=!1,o=void 0;try{for(var l,u=n[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){e+=l.value.byteLength}}catch(e){s=!0,o=e}finally{try{!i&&u.return&&u.return()}finally{if(s)throw o}}var c=new ArrayBuffer(e),h=new Uint8Array(c),m=!0,f=!1,p=void 0;try{for(var v,d=n[Symbol.iterator]();!(m=(v=d.next()).done);m=!0){var y=v.value;h.set(new Uint8Array(y),t),t+=y.byteLength}}catch(e){f=!0,p=e}finally{try{!m&&d.return&&d.return()}finally{if(f)throw p}}return c}function St(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),a=0;a<r.length;a++)if(r[a]!==n[a])return!1;return!0}var At="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function Pt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=0,i=0,s=0,o="",l=t?_t:At;if(n){for(var u=0,c=0;c<e.length;c++)if(0!==e.charCodeAt(c)){u=c;break}e=e.slice(u)}for(;a<e.length;){var h=e.charCodeAt(a++);a>=e.length&&(i=1);var m=e.charCodeAt(a++);a>=e.length&&(s=1);var f=e.charCodeAt(a++),p=h>>2,v=(3&h)<<4|m>>4,d=(15&m)<<2|f>>6,y=63&f;1===i?d=y=64:1===s&&(y=64),o+=r?64===d?""+l.charAt(p)+l.charAt(v):64===y?""+l.charAt(p)+l.charAt(v)+l.charAt(d):""+l.charAt(p)+l.charAt(v)+l.charAt(d)+l.charAt(y):""+l.charAt(p)+l.charAt(v)+l.charAt(d)+l.charAt(y)}return o}function It(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t?_t:At;function a(e){for(var t=0;t<64;t++)if(n.charAt(t)===e)return t;return 64}function i(e){return 64===e?0:e}for(var s=0,o="";s<e.length;){var l=a(e.charAt(s++)),u=s>=e.length?0:a(e.charAt(s++)),c=s>=e.length?0:a(e.charAt(s++)),h=s>=e.length?0:a(e.charAt(s++)),m=i(l)<<2|i(u)>>4,f=(15&i(u))<<4|i(c)>>2,p=(3&i(c))<<6|i(h);o+=String.fromCharCode(m),64!==c&&(o+=String.fromCharCode(f)),64!==h&&(o+=String.fromCharCode(p))}if(r){for(var v=-1,d=o.length-1;d>=0;d--)if(0!==o.charCodeAt(d)){v=d;break}-1!==v&&(o=o.slice(0,v+1))}return o}function Et(e){var t="",r=new Uint8Array(e),n=!0,a=!1,i=void 0;try{for(var s,o=r[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var l=s.value;t+=String.fromCharCode(l)}}catch(e){a=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(a)throw i}}return t}function Rt(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),a=0;a<t;a++)n[a]=e.charCodeAt(a);return r}var Ot=Math.log(2);var Bt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.algorithmId=Ct(t,"algorithmId",e.defaultValues("algorithmId")),"algorithmParams"in t&&(this.algorithmParams=Ct(t,"algorithmParams",e.defaultValues("algorithmParams"))),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{algorithmIdentifier:"algorithm",algorithmParams:"params"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for AlgorithmIdentifier");this.algorithmId=r.result.algorithm.valueBlock.toString(),"params"in r.result&&(this.algorithmParams=r.result.params)}},{key:"toSchema",value:function(){var e=[];return e.push(new Xe({value:this.algorithmId})),"algorithmParams"in this&&this.algorithmParams instanceof vt==!1&&e.push(this.algorithmParams),new Oe({value:e})}},{key:"toJSON",value:function(){var e={algorithmId:this.algorithmId};return"algorithmParams"in this&&this.algorithmParams instanceof vt==!1&&(e.algorithmParams=this.algorithmParams.toJSON()),e}},{key:"isEqual",value:function(t){return t instanceof e!=!1&&(this.algorithmId===t.algorithmId&&("algorithmParams"in this?"algorithmParams"in t&&JSON.stringify(this.algorithmParams)===JSON.stringify(t.algorithmParams):!("algorithmParams"in t)))}}],[{key:"defaultValues",value:function(e){switch(e){case"algorithmId":return"";case"algorithmParams":return new vt;default:throw new Error("Invalid member name for AlgorithmIdentifier class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"algorithmId":return""===t;case"algorithmParams":return t instanceof vt;default:throw new Error("Invalid member name for AlgorithmIdentifier class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",optional:e.optional||!1,value:[new Xe({name:e.algorithmIdentifier||""}),new vt({name:e.algorithmParams||"",optional:!0})]})}}]),e}(),xt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.x=Ct(t,"x",e.defaultValues("x")),this.y=Ct(t,"y",e.defaultValues("y")),this.namedCurve=Ct(t,"namedCurve",e.defaultValues("namedCurve")),"schema"in t&&this.fromSchema(t.schema),"json"in t&&this.fromJSON(t.json)}return _createClass(e,[{key:"fromSchema",value:function(e){if(e instanceof ArrayBuffer==!1)throw new Error("Object's schema was not verified against input data for ECPublicKey");if(4!==new Uint8Array(e)[0])throw new Error("Object's schema was not verified against input data for ECPublicKey");var t=void 0;switch(this.namedCurve){case"1.2.840.10045.3.1.7":t=32;break;case"1.3.132.0.34":t=48;break;case"1.3.132.0.35":t=66;break;default:throw new Error("Incorrect curve OID: "+this.namedCurve)}if(e.byteLength!==2*t+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.x=e.slice(1,t+1),this.y=e.slice(1+t,2*t+1)}},{key:"toSchema",value:function(){return new yt({data:Nt(new Uint8Array([4]).buffer,this.x,this.y)})}},{key:"toJSON",value:function(){var e="";switch(this.namedCurve){case"1.2.840.10045.3.1.7":e="P-256";break;case"1.3.132.0.34":e="P-384";break;case"1.3.132.0.35":e="P-521"}return{crv:e,x:Pt(Et(this.x),!0,!0,!1),y:Pt(Et(this.y),!0,!0,!1)}}},{key:"fromJSON",value:function(e){var t=0;if(!("crv"in e))throw new Error('Absent mandatory parameter "crv"');switch(e.crv.toUpperCase()){case"P-256":this.namedCurve="1.2.840.10045.3.1.7",t=32;break;case"P-384":this.namedCurve="1.3.132.0.34",t=48;break;case"P-521":this.namedCurve="1.3.132.0.35",t=66}if(!("x"in e))throw new Error('Absent mandatory parameter "x"');var r=Rt(It(e.x,!0));if(r.byteLength<t){this.x=new ArrayBuffer(t);var n=new Uint8Array(this.x),a=new Uint8Array(r);n.set(1,a)}else this.x=r.slice(0,t);if(!("y"in e))throw new Error('Absent mandatory parameter "y"');var i=Rt(It(e.y,!0));if(i.byteLength<t){this.y=new ArrayBuffer(t);var s=new Uint8Array(this.y),o=new Uint8Array(i);s.set(1,o)}else this.y=i.slice(0,t)}}],[{key:"defaultValues",value:function(e){switch(e){case"x":case"y":return new ArrayBuffer(0);case"namedCurve":return"";default:throw new Error("Invalid member name for ECCPublicKey class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"x":case"y":return St(r,e.defaultValues(t));case"namedCurve":return""===r;default:throw new Error("Invalid member name for ECCPublicKey class: "+t)}}},{key:"schema",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new yt}}]),e}(),Ut=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.modulus=Ct(t,"modulus",e.defaultValues("modulus")),this.publicExponent=Ct(t,"publicExponent",e.defaultValues("publicExponent")),"schema"in t&&this.fromSchema(t.schema),"json"in t&&this.fromJSON(t.json)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{modulus:"modulus",publicExponent:"publicExponent"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RSAPublicKey");this.modulus=r.result.modulus.convertFromDER(256),this.publicExponent=r.result.publicExponent}},{key:"toSchema",value:function(){return new Oe({value:[this.modulus.convertToDER(),this.publicExponent]})}},{key:"toJSON",value:function(){return{n:Pt(Et(this.modulus.valueBlock.valueHex),!0,!0,!0),e:Pt(Et(this.publicExponent.valueBlock.valueHex),!0,!0,!0)}}},{key:"fromJSON",value:function(e){if(!("n"in e))throw new Error('Absent mandatory parameter "n"');var t,r,n,a,i=Rt(It(e.n,!0));if(this.modulus=new He({valueHex:i.slice(0,Math.pow(2,(t=i.byteLength,r=Math.log(t)/Ot,n=Math.floor(r),a=Math.round(r),n===a?n:a)))}),!("e"in e))throw new Error('Absent mandatory parameter "e"');this.publicExponent=new He({valueHex:Rt(It(e.e,!0)).slice(0,3)})}}],[{key:"defaultValues",value:function(e){switch(e){case"modulus":case"publicExponent":return new He;default:throw new Error("Invalid member name for RSAPublicKey class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new He({name:e.modulus||""}),new He({name:e.publicExponent||""})]})}}]),e}(),Dt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.algorithm=Ct(t,"algorithm",e.defaultValues("algorithm")),this.subjectPublicKey=Ct(t,"subjectPublicKey",e.defaultValues("subjectPublicKey")),"parsedKey"in t&&(this.parsedKey=Ct(t,"parsedKey",e.defaultValues("parsedKey"))),"schema"in t&&this.fromSchema(t.schema),"json"in t&&this.fromJSON(t.json)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{algorithm:{names:{blockName:"algorithm"}},subjectPublicKey:"subjectPublicKey"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PUBLIC_KEY_INFO");switch(this.algorithm=new Bt({schema:r.result.algorithm}),this.subjectPublicKey=r.result.subjectPublicKey,this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams instanceof Xe)try{this.parsedKey=new xt({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHex})}catch(e){}break;case"1.2.840.113549.1.1.1":var n=bt(this.subjectPublicKey.valueBlock.valueHex);if(-1!==n.offset)try{this.parsedKey=new Ut({schema:n.result})}catch(e){}}}},{key:"toSchema",value:function(){return new Oe({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}},{key:"toJSON",value:function(){if("parsedKey"in this==!1)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};var e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}var t=this.parsedKey.toJSON(),r=!0,n=!1,a=void 0;try{for(var i,s=Object.keys(t)[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var o=i.value;e[o]=t[o]}}catch(e){n=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw a}}return e}},{key:"fromJSON",value:function(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new xt({json:e}),this.algorithm=new Bt({algorithmId:"1.2.840.10045.2.1",algorithmParams:new Xe({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Ut({json:e}),this.algorithm=new Bt({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new xe});break;default:throw new Error('Invalid value for "kty" parameter: '+e.kty)}this.subjectPublicKey=new Te({valueHex:this.parsedKey.toSchema().toBER(!1)})}}},{key:"importKey",value:function(e){var t=Promise.resolve(),r=this;if(void 0===e)return Promise.reject("Need to provide publicKey input parameter");var n=Wt();return void 0===n?Promise.reject("Unable to create WebCrypto object"):t=(t=t.then(function(){return n.exportKey("spki",e)})).then(function(e){var t=bt(e);try{r.fromSchema(t.result)}catch(e){return Promise.reject("Error during initializing object from schema")}},function(e){return Promise.reject("Error during exporting public key: "+e)})}}],[{key:"defaultValues",value:function(e){switch(e){case"algorithm":return new Bt;case"subjectPublicKey":return new Te;default:throw new Error("Invalid member name for PublicKeyInfo class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[Bt.schema(e.algorithm||{}),new Te({name:e.subjectPublicKey||""})]})}}]),e}(),Lt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.type=Ct(t,"type",e.defaultValues("type")),this.values=Ct(t,"values",e.defaultValues("values")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{type:"type",values:"values"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for ATTRIBUTE");this.type=r.result.type.valueBlock.toString(),this.values=r.result.values}},{key:"toSchema",value:function(){return new Oe({value:[new Xe({value:this.type}),new Be({value:this.values})]})}},{key:"toJSON",value:function(){return{type:this.type,values:Array.from(this.values,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"type":return"";case"values":return[];default:throw new Error("Invalid member name for Attribute class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"type":return""===t;case"values":return 0===t.length;default:throw new Error("Invalid member name for Attribute class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new Xe({name:e.type||""}),new Be({name:e.setName||"",value:[new dt({name:e.values||"",value:new vt})]})]})}}]),e}(),Tt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=Ct(t,"version",e.defaultValues("version")),this.privateKey=Ct(t,"privateKey",e.defaultValues("privateKey")),"namedCurve"in t&&(this.namedCurve=Ct(t,"namedCurve",e.defaultValues("namedCurve"))),"publicKey"in t&&(this.publicKey=Ct(t,"publicKey",e.defaultValues("publicKey"))),"schema"in t&&this.fromSchema(t.schema),"json"in t&&this.fromJSON(t.json)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{version:"version",privateKey:"privateKey",namedCurve:"namedCurve",publicKey:"publicKey"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for ECPrivateKey");if(this.version=r.result.version.valueBlock.valueDec,this.privateKey=r.result.privateKey,"namedCurve"in r.result&&(this.namedCurve=r.result.namedCurve.valueBlock.toString()),"publicKey"in r.result){var n={schema:r.result.publicKey.valueBlock.valueHex};"namedCurve"in this&&(n.namedCurve=this.namedCurve),this.publicKey=new xt(n)}}},{key:"toSchema",value:function(){var e=[new He({value:this.version}),this.privateKey];return"namedCurve"in this&&e.push(new _e({idBlock:{tagClass:3,tagNumber:0},value:[new Xe({value:this.namedCurve})]})),"publicKey"in this&&e.push(new _e({idBlock:{tagClass:3,tagNumber:1},value:[new Te({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new Oe({value:e})}},{key:"toJSON",value:function(){if("namedCurve"in this==!1||e.compareWithDefault("namedCurve",this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');var t="";switch(this.namedCurve){case"1.2.840.10045.3.1.7":t="P-256";break;case"1.3.132.0.34":t="P-384";break;case"1.3.132.0.35":t="P-521"}var r={crv:t,d:Pt(Et(this.privateKey.valueBlock.valueHex),!0,!0,!1)};if("publicKey"in this){var n=this.publicKey.toJSON();r.x=n.x,r.y=n.y}return r}},{key:"fromJSON",value:function(e){var t=0;if(!("crv"in e))throw new Error('Absent mandatory parameter "crv"');switch(e.crv.toUpperCase()){case"P-256":this.namedCurve="1.2.840.10045.3.1.7",t=32;break;case"P-384":this.namedCurve="1.3.132.0.34",t=48;break;case"P-521":this.namedCurve="1.3.132.0.35",t=66}if(!("d"in e))throw new Error('Absent mandatory parameter "d"');var r=Rt(It(e.d,!0));if(r.byteLength<t){var n=new ArrayBuffer(t),a=new Uint8Array(n),i=new Uint8Array(r);a.set(1,i),this.privateKey=new De({valueHex:n})}else this.privateKey=new De({valueHex:r.slice(0,t)});"x"in e&&"y"in e&&(this.publicKey=new xt({json:e}))}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 1;case"privateKey":return new De;case"namedCurve":return"";case"publicKey":return new xt;default:throw new Error("Invalid member name for ECCPrivateKey class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"version":return r===e.defaultValues(t);case"privateKey":return r.isEqual(e.defaultValues(t));case"namedCurve":return""===r;case"publicKey":return xt.compareWithDefault("namedCurve",r.namedCurve)&&xt.compareWithDefault("x",r.x)&&xt.compareWithDefault("y",r.y);default:throw new Error("Invalid member name for ECCPrivateKey class: "+t)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new He({name:e.version||""}),new De({name:e.privateKey||""}),new _e({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Xe({name:e.namedCurve||""})]}),new _e({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Te({name:e.publicKey||""})]})]})}}]),e}(),jt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.prime=Ct(t,"prime",e.defaultValues("prime")),this.exponent=Ct(t,"exponent",e.defaultValues("exponent")),this.coefficient=Ct(t,"coefficient",e.defaultValues("coefficient")),"schema"in t&&this.fromSchema(t.schema),"json"in t&&this.fromJSON(t.json)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{prime:"prime",exponent:"exponent",coefficient:"coefficient"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for OtherPrimeInfo");this.prime=r.result.prime.convertFromDER(),this.exponent=r.result.exponent.convertFromDER(),this.coefficient=r.result.coefficient.convertFromDER()}},{key:"toSchema",value:function(){return new Oe({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}},{key:"toJSON",value:function(){return{r:Pt(Et(this.prime.valueBlock.valueHex),!0,!0),d:Pt(Et(this.exponent.valueBlock.valueHex),!0,!0),t:Pt(Et(this.coefficient.valueBlock.valueHex),!0,!0)}}},{key:"fromJSON",value:function(e){if(!("r"in e))throw new Error('Absent mandatory parameter "r"');if(this.prime=new He({valueHex:Rt(It(e.r,!0))}),!("d"in e))throw new Error('Absent mandatory parameter "d"');if(this.exponent=new He({valueHex:Rt(It(e.d,!0))}),!("t"in e))throw new Error('Absent mandatory parameter "t"');this.coefficient=new He({valueHex:Rt(It(e.t,!0))})}}],[{key:"defaultValues",value:function(e){switch(e){case"prime":case"exponent":case"coefficient":return new He;default:throw new Error("Invalid member name for OtherPrimeInfo class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new He({name:e.prime||""}),new He({name:e.exponent||""}),new He({name:e.coefficient||""})]})}}]),e}(),Ht=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=Ct(t,"version",e.defaultValues("version")),this.modulus=Ct(t,"modulus",e.defaultValues("modulus")),this.publicExponent=Ct(t,"publicExponent",e.defaultValues("publicExponent")),this.privateExponent=Ct(t,"privateExponent",e.defaultValues("privateExponent")),this.prime1=Ct(t,"prime1",e.defaultValues("prime1")),this.prime2=Ct(t,"prime2",e.defaultValues("prime2")),this.exponent1=Ct(t,"exponent1",e.defaultValues("exponent1")),this.exponent2=Ct(t,"exponent2",e.defaultValues("exponent2")),this.coefficient=Ct(t,"coefficient",e.defaultValues("coefficient")),"otherPrimeInfos"in t&&(this.otherPrimeInfos=Ct(t,"otherPrimeInfos",e.defaultValues("otherPrimeInfos"))),"schema"in t&&this.fromSchema(t.schema),"json"in t&&this.fromJSON(t.json)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{version:"version",modulus:"modulus",publicExponent:"publicExponent",privateExponent:"privateExponent",prime1:"prime1",prime2:"prime2",exponent1:"exponent1",exponent2:"exponent2",coefficient:"coefficient",otherPrimeInfo:{names:{blockName:"otherPrimeInfos"}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RSAPrivateKey");this.version=r.result.version.valueBlock.valueDec,this.modulus=r.result.modulus.convertFromDER(256),this.publicExponent=r.result.publicExponent,this.privateExponent=r.result.privateExponent.convertFromDER(256),this.prime1=r.result.prime1.convertFromDER(128),this.prime2=r.result.prime2.convertFromDER(128),this.exponent1=r.result.exponent1.convertFromDER(128),this.exponent2=r.result.exponent2.convertFromDER(128),this.coefficient=r.result.coefficient.convertFromDER(128),"otherPrimeInfos"in r.result&&(this.otherPrimeInfos=Array.from(r.result.otherPrimeInfos,function(e){return new jt({schema:e})}))}},{key:"toSchema",value:function(){var e=[];return e.push(new He({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),"otherPrimeInfos"in this&&e.push(new Oe({value:Array.from(this.otherPrimeInfos,function(e){return e.toSchema()})})),new Oe({value:e})}},{key:"toJSON",value:function(){var e={n:Pt(Et(this.modulus.valueBlock.valueHex),!0,!0,!0),e:Pt(Et(this.publicExponent.valueBlock.valueHex),!0,!0,!0),d:Pt(Et(this.privateExponent.valueBlock.valueHex),!0,!0,!0),p:Pt(Et(this.prime1.valueBlock.valueHex),!0,!0,!0),q:Pt(Et(this.prime2.valueBlock.valueHex),!0,!0,!0),dp:Pt(Et(this.exponent1.valueBlock.valueHex),!0,!0,!0),dq:Pt(Et(this.exponent2.valueBlock.valueHex),!0,!0,!0),qi:Pt(Et(this.coefficient.valueBlock.valueHex),!0,!0,!0)};return"otherPrimeInfos"in this&&(e.oth=Array.from(this.otherPrimeInfos,function(e){return e.toJSON()})),e}},{key:"fromJSON",value:function(e){if(!("n"in e))throw new Error('Absent mandatory parameter "n"');if(this.modulus=new He({valueHex:Rt(It(e.n,!0,!0))}),!("e"in e))throw new Error('Absent mandatory parameter "e"');if(this.publicExponent=new He({valueHex:Rt(It(e.e,!0,!0))}),!("d"in e))throw new Error('Absent mandatory parameter "d"');if(this.privateExponent=new He({valueHex:Rt(It(e.d,!0,!0))}),!("p"in e))throw new Error('Absent mandatory parameter "p"');if(this.prime1=new He({valueHex:Rt(It(e.p,!0,!0))}),!("q"in e))throw new Error('Absent mandatory parameter "q"');if(this.prime2=new He({valueHex:Rt(It(e.q,!0,!0))}),!("dp"in e))throw new Error('Absent mandatory parameter "dp"');if(this.exponent1=new He({valueHex:Rt(It(e.dp,!0,!0))}),!("dq"in e))throw new Error('Absent mandatory parameter "dq"');if(this.exponent2=new He({valueHex:Rt(It(e.dq,!0,!0))}),!("qi"in e))throw new Error('Absent mandatory parameter "qi"');this.coefficient=new He({valueHex:Rt(It(e.qi,!0,!0))}),"oth"in e&&(this.otherPrimeInfos=Array.from(e.oth,function(e){return new jt({json:e})}))}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 0;case"modulus":case"publicExponent":case"privateExponent":case"prime1":case"prime2":case"exponent1":case"exponent2":case"coefficient":return new He;case"otherPrimeInfos":return[];default:throw new Error("Invalid member name for RSAPrivateKey class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new He({name:e.version||""}),new He({name:e.modulus||""}),new He({name:e.publicExponent||""}),new He({name:e.privateExponent||""}),new He({name:e.prime1||""}),new He({name:e.prime2||""}),new He({name:e.exponent1||""}),new He({name:e.exponent2||""}),new He({name:e.coefficient||""}),new Oe({optional:!0,value:[new dt({name:e.otherPrimeInfosName||"",value:jt.schema(e.otherPrimeInfo||{})})]})]})}}]),e}(),Vt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=Ct(t,"version",e.defaultValues("version")),this.privateKeyAlgorithm=Ct(t,"privateKeyAlgorithm",e.defaultValues("privateKeyAlgorithm")),this.privateKey=Ct(t,"privateKey",e.defaultValues("privateKey")),"attributes"in t&&(this.attributes=Ct(t,"attributes",e.defaultValues("attributes"))),"parsedKey"in t&&(this.parsedKey=Ct(t,"parsedKey",e.defaultValues("parsedKey"))),"schema"in t&&this.fromSchema(t.schema),"json"in t&&this.fromJSON(t.json)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{version:"version",privateKeyAlgorithm:{names:{blockName:"privateKeyAlgorithm"}},privateKey:"privateKey",attributes:"attributes"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PKCS8");switch(this.version=r.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new Bt({schema:r.result.privateKeyAlgorithm}),this.privateKey=r.result.privateKey,"attributes"in r.result&&(this.attributes=Array.from(r.result.attributes,function(e){return new Lt({schema:e})})),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":var n=bt(this.privateKey.valueBlock.valueHex);-1!==n.offset&&(this.parsedKey=new Ht({schema:n.result}));break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof Xe){var a=bt(this.privateKey.valueBlock.valueHex);-1!==a.offset&&(this.parsedKey=new Tt({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:a.result}))}}}},{key:"toSchema",value:function(){var e=[new He({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return"attributes"in this&&e.push(new _e({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,function(e){return e.toSchema()})})),new Oe({value:e})}},{key:"toJSON",value:function(){if("parsedKey"in this==!1){var e={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return"attributes"in this&&(e.attributes=Array.from(this.attributes,function(e){return e.toJSON()})),e}var t={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":t.kty="EC";break;case"1.2.840.113549.1.1.1":t.kty="RSA"}var r=this.parsedKey.toJSON(),n=!0,a=!1,i=void 0;try{for(var s,o=Object.keys(r)[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var l=s.value;t[l]=r[l]}}catch(e){a=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(a)throw i}}return t}},{key:"fromJSON",value:function(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Tt({json:e}),this.privateKeyAlgorithm=new Bt({algorithmId:"1.2.840.10045.2.1",algorithmParams:new Xe({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Ht({json:e}),this.privateKeyAlgorithm=new Bt({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new xe});break;default:throw new Error('Invalid value for "kty" parameter: '+e.kty)}this.privateKey=new De({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 0;case"privateKeyAlgorithm":return new Bt;case"privateKey":return new De;case"attributes":return[];default:throw new Error("Invalid member name for PrivateKeyInfo class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new He({name:e.version||""}),Bt.schema(e.privateKeyAlgorithm||{}),new De({name:e.privateKey||""}),new _e({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new dt({name:e.attributes||"",value:Lt.schema()})]})]})}}]),e}(),Mt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,e),this.contentType=Ct(t,"contentType",e.defaultValues("contentType")),this.contentEncryptionAlgorithm=Ct(t,"contentEncryptionAlgorithm",e.defaultValues("contentEncryptionAlgorithm")),"encryptedContent"in t&&(this.encryptedContent=t.encryptedContent,1===this.encryptedContent.idBlock.tagClass&&4===this.encryptedContent.idBlock.tagNumber&&!1===this.encryptedContent.idBlock.isConstructed)){for(var r=new De({idBlock:{isConstructed:!0},isConstructed:!0}),n=0,a=this.encryptedContent.valueBlock.valueHex.byteLength;a>0;){for(var i=new Uint8Array(this.encryptedContent.valueBlock.valueHex,n,n+1024>this.encryptedContent.valueBlock.valueHex.byteLength?this.encryptedContent.valueBlock.valueHex.byteLength-n:1024),s=new ArrayBuffer(i.length),o=new Uint8Array(s),l=0;l<o.length;l++)o[l]=i[l];r.valueBlock.value.push(new De({valueHex:s})),a-=i.length,n+=i.length}this.encryptedContent=r}"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{contentType:"contentType",contentEncryptionAlgorithm:{names:{blockName:"contentEncryptionAlgorithm"}},encryptedContent:"encryptedContent"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for EncryptedContentInfo");this.contentType=r.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new Bt({schema:r.result.contentEncryptionAlgorithm}),"encryptedContent"in r.result&&(this.encryptedContent=r.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}},{key:"toSchema",value:function(){var e={isIndefiniteForm:!1},t=[];if(t.push(new Xe({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),"encryptedContent"in this){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;var r=this.encryptedContent;r.idBlock.tagClass=3,r.idBlock.tagNumber=0,r.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(r)}return new Oe({lenBlock:e,value:t})}},{key:"toJSON",value:function(){var e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return"encryptedContent"in this&&(e.encryptedContent=this.encryptedContent.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"contentType":return"";case"contentEncryptionAlgorithm":return new Bt;case"encryptedContent":return new De;default:throw new Error("Invalid member name for EncryptedContentInfo class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"contentType":return""===r;case"contentEncryptionAlgorithm":return""===r.algorithmId&&"algorithmParams"in r==!1;case"encryptedContent":return r.isEqual(e.defaultValues(t));default:throw new Error("Invalid member name for EncryptedContentInfo class: "+t)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new Xe({name:e.contentType||""}),Bt.schema(e.contentEncryptionAlgorithm||{}),new pt({value:[new _e({name:e.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0},value:[new dt({value:new De})]}),new Se({name:e.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0}})]})]})}}]),e}(),Kt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.hashAlgorithm=Ct(t,"hashAlgorithm",e.defaultValues("hashAlgorithm")),this.maskGenAlgorithm=Ct(t,"maskGenAlgorithm",e.defaultValues("maskGenAlgorithm")),this.saltLength=Ct(t,"saltLength",e.defaultValues("saltLength")),this.trailerField=Ct(t,"trailerField",e.defaultValues("trailerField")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{hashAlgorithm:{names:{blockName:"hashAlgorithm"}},maskGenAlgorithm:{names:{blockName:"maskGenAlgorithm"}},saltLength:"saltLength",trailerField:"trailerField"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RSASSA_PSS_params");"hashAlgorithm"in r.result&&(this.hashAlgorithm=new Bt({schema:r.result.hashAlgorithm})),"maskGenAlgorithm"in r.result&&(this.maskGenAlgorithm=new Bt({schema:r.result.maskGenAlgorithm})),"saltLength"in r.result&&(this.saltLength=r.result.saltLength.valueBlock.valueDec),"trailerField"in r.result&&(this.trailerField=r.result.trailerField.valueBlock.valueDec)}},{key:"toSchema",value:function(){var t=[];return this.hashAlgorithm.isEqual(e.defaultValues("hashAlgorithm"))||t.push(new _e({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(e.defaultValues("maskGenAlgorithm"))||t.push(new _e({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==e.defaultValues("saltLength")&&t.push(new _e({idBlock:{tagClass:3,tagNumber:2},value:[new He({value:this.saltLength})]})),this.trailerField!==e.defaultValues("trailerField")&&t.push(new _e({idBlock:{tagClass:3,tagNumber:3},value:[new He({value:this.trailerField})]})),new Oe({value:t})}},{key:"toJSON",value:function(){var t={};return this.hashAlgorithm.isEqual(e.defaultValues("hashAlgorithm"))||(t.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(e.defaultValues("maskGenAlgorithm"))||(t.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==e.defaultValues("saltLength")&&(t.saltLength=this.saltLength),this.trailerField!==e.defaultValues("trailerField")&&(t.trailerField=this.trailerField),t}}],[{key:"defaultValues",value:function(e){switch(e){case"hashAlgorithm":return new Bt({algorithmId:"1.3.14.3.2.26",algorithmParams:new xe});case"maskGenAlgorithm":return new Bt({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new Bt({algorithmId:"1.3.14.3.2.26",algorithmParams:new xe}).toSchema()});case"saltLength":return 20;case"trailerField":return 1;default:throw new Error("Invalid member name for RSASSAPSSParams class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new _e({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[Bt.schema(e.hashAlgorithm||{})]}),new _e({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[Bt.schema(e.maskGenAlgorithm||{})]}),new _e({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new He({name:e.saltLength||""})]}),new _e({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new He({name:e.trailerField||""})]})]})}}]),e}(),Xt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.salt=Ct(t,"salt",e.defaultValues("salt")),this.iterationCount=Ct(t,"iterationCount",e.defaultValues("iterationCount")),"keyLength"in t&&(this.keyLength=Ct(t,"keyLength",e.defaultValues("keyLength"))),"prf"in t&&(this.prf=Ct(t,"prf",e.defaultValues("prf"))),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{saltPrimitive:"salt",saltConstructed:{names:{blockName:"salt"}},iterationCount:"iterationCount",keyLength:"keyLength",prf:{names:{blockName:"prf",optional:!0}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PBKDF2_params");this.salt=r.result.salt,this.iterationCount=r.result.iterationCount.valueBlock.valueDec,"keyLength"in r.result&&(this.keyLength=r.result.keyLength.valueBlock.valueDec),"prf"in r.result&&(this.prf=new Bt({schema:r.result.prf}))}},{key:"toSchema",value:function(){var t=[];return t.push(this.salt),t.push(new He({value:this.iterationCount})),"keyLength"in this&&e.defaultValues("keyLength")!==this.keyLength&&t.push(new He({value:this.keyLength})),"prf"in this&&!1===e.defaultValues("prf").isEqual(this.prf)&&t.push(this.prf.toSchema()),new Oe({value:t})}},{key:"toJSON",value:function(){var t={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return"keyLength"in this&&e.defaultValues("keyLength")!==this.keyLength&&(t.keyLength=this.keyLength),"prf"in this&&!1===e.defaultValues("prf").isEqual(this.prf)&&(t.prf=this.prf.toJSON()),t}}],[{key:"defaultValues",value:function(e){switch(e){case"salt":return{};case"iterationCount":return-1;case"keyLength":return 0;case"prf":return new Bt({algorithmId:"1.3.14.3.2.26",algorithmParams:new xe});default:throw new Error("Invalid member name for PBKDF2Params class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new pt({value:[new De({name:e.saltPrimitive||""}),Bt.schema(e.saltConstructed||{})]}),new He({name:e.iterationCount||""}),new He({name:e.keyLength||"",optional:!0}),Bt.schema(e.prf||{names:{optional:!0}})]})}}]),e}(),Gt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.keyDerivationFunc=Ct(t,"keyDerivationFunc",e.defaultValues("keyDerivationFunc")),this.encryptionScheme=Ct(t,"encryptionScheme",e.defaultValues("encryptionScheme")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{keyDerivationFunc:{names:{blockName:"keyDerivationFunc"}},encryptionScheme:{names:{blockName:"encryptionScheme"}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PBES2_params");this.keyDerivationFunc=new Bt({schema:r.result.keyDerivationFunc}),this.encryptionScheme=new Bt({schema:r.result.encryptionScheme})}},{key:"toSchema",value:function(){return new Oe({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}},{key:"toJSON",value:function(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"keyDerivationFunc":case"encryptionScheme":return new Bt;default:throw new Error("Invalid member name for PBES2Params class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[Bt.schema(e.keyDerivationFunc||{}),Bt.schema(e.encryptionScheme||{})]})}}]),e}();function Ft(e,t,r,n,a,i){var s=void 0,o=void 0,l=[];switch(t.toUpperCase()){case"SHA-1":s=20,o=64;break;case"SHA-256":s=32,o=64;break;case"SHA-384":s=48,o=128;break;case"SHA-512":s=64,o=128;break;default:throw new Error("Unsupported hashing algorithm")}for(var u=new Uint8Array(n),c=new ArrayBuffer(2*n.byteLength+2),h=new Uint8Array(c),m=0;m<u.length;m++)h[2*m]=0,h[2*m+1]=u[m];h[h.length-2]=0,h[h.length-1]=0,n=c.slice(0);for(var f=new ArrayBuffer(o),p=new Uint8Array(f),v=0;v<f.byteLength;v++)p[v]=3;for(var d=a.byteLength,y=o*Math.ceil(d/o),g=new ArrayBuffer(y),b=new Uint8Array(g),k=new Uint8Array(a),C=0;C<y;C++)b[C]=k[C%d];for(var w=n.byteLength,N=o*Math.ceil(w/o),S=new ArrayBuffer(N),A=new Uint8Array(S),_=new Uint8Array(n),P=0;P<N;P++)A[P]=_[P%w];var I=g.byteLength+S.byteLength,E=new ArrayBuffer(I),R=new Uint8Array(E);R.set(b),R.set(A,b.length);for(var O=Math.ceil((r>>3)/s),B=Promise.resolve(E),x=0;x<=O;x++){B=B.then(function(e){var t=new ArrayBuffer(f.byteLength+e.byteLength),r=new Uint8Array(t);return r.set(p),r.set(R,p.length),t});for(var U=0;U<i;U++)B=B.then(function(r){return e.digest({name:t},new Uint8Array(r))});B=B.then(function(e){for(var t=new ArrayBuffer(o),r=new Uint8Array(t),n=0;n<t.byteLength;n++)r[n]=e[n%e.length];for(var a=Math.ceil(d/o)+Math.ceil(w/o),i=[],s=0,u=o,c=0;c<a;c++){var h=Array.from(new Uint8Array(E.slice(s,s+u)));(s+=o)+o>E.byteLength&&(u=E.byteLength-s);for(var m=511,f=t.byteLength-1;f>=0;f--)m>>=8,m+=r[f]+h[f],h[f]=255&m;i.push.apply(i,_toConsumableArray(h))}return E=new ArrayBuffer(i.length),(R=new Uint8Array(E)).set(i),l.push.apply(l,_toConsumableArray(new Uint8Array(e))),E})}return B=B.then(function(){var e=new ArrayBuffer(r>>3);return new Uint8Array(e).set(new Uint8Array(l).slice(0,r>>3)),e})}var Jt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.crypto=Ct(t,"crypto",{}),this.subtle=Ct(t,"subtle",{}),this.name=Ct(t,"name","")}return _createClass(e,[{key:"importKey",value:function(e,t,r,n,a){var i=this,s={};switch(t instanceof Uint8Array&&(t=t.buffer),e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,r,n,a);case"spki":var o=bt(t);if(-1===o.offset)return Promise.reject("Incorrect keyData");var l=new Dt;try{l.fromSchema(o.result)}catch(e){return Promise.reject("Incorrect keyData")}switch(r.name.toUpperCase()){case"RSA-PSS":switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="PS1";break;case"SHA-256":s.alg="PS256";break;case"SHA-384":s.alg="PS384";break;case"SHA-512":s.alg="PS512";break;default:return Promise.reject("Incorrect hash algorithm: "+r.hash.name.toUpperCase())}case"RSASSA-PKCS1-V1_5":if(a=["verify"],s.kty="RSA",s.ext=n,s.key_ops=a,"1.2.840.113549.1.1.1"!==l.algorithm.algorithmId)return Promise.reject("Incorrect public key algorithm: "+l.algorithm.algorithmId);if("alg"in s==!1)switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="RS1";break;case"SHA-256":s.alg="RS256";break;case"SHA-384":s.alg="RS384";break;case"SHA-512":s.alg="RS512";break;default:return Promise.reject("Incorrect public key algorithm: "+l.algorithm.algorithmId)}var u=l.toJSON(),c=!0,h=!1,m=void 0;try{for(var f,p=Object.keys(u)[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var v=f.value;s[v]=u[v]}}catch(e){h=!0,m=e}finally{try{!c&&p.return&&p.return()}finally{if(h)throw m}}break;case"ECDSA":a=["verify"];case"ECDH":if(s={kty:"EC",ext:n,key_ops:a},"1.2.840.10045.2.1"!==l.algorithm.algorithmId)return Promise.reject("Incorrect public key algorithm: "+l.algorithm.algorithmId);var d=l.toJSON(),y=!0,g=!1,b=void 0;try{for(var k,C=Object.keys(d)[Symbol.iterator]();!(y=(k=C.next()).done);y=!0){var w=k.value;s[w]=d[w]}}catch(e){g=!0,b=e}finally{try{!y&&C.return&&C.return()}finally{if(g)throw b}}break;case"RSA-OAEP":if(s.kty="RSA",s.ext=n,s.key_ops=a,"safari"===this.name.toLowerCase())s.alg="RSA-OAEP";else switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="RSA-OAEP-1";break;case"SHA-256":s.alg="RSA-OAEP-256";break;case"SHA-384":s.alg="RSA-OAEP-384";break;case"SHA-512":s.alg="RSA-OAEP-512";break;default:return Promise.reject("Incorrect public key algorithm: "+l.algorithm.algorithmId)}var N=l.toJSON(),S=!0,A=!1,_=void 0;try{for(var P,I=Object.keys(N)[Symbol.iterator]();!(S=(P=I.next()).done);S=!0){var E=P.value;s[E]=N[E]}}catch(e){A=!0,_=e}finally{try{!S&&I.return&&I.return()}finally{if(A)throw _}}break;default:return Promise.reject("Incorrect algorithm name: "+r.name.toUpperCase())}break;case"pkcs8":var R=new Vt,O=bt(t);if(-1===O.offset)return Promise.reject("Incorrect keyData");try{R.fromSchema(O.result)}catch(e){return Promise.reject("Incorrect keyData")}switch(r.name.toUpperCase()){case"RSA-PSS":switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="PS1";break;case"SHA-256":s.alg="PS256";break;case"SHA-384":s.alg="PS384";break;case"SHA-512":s.alg="PS512";break;default:return Promise.reject("Incorrect hash algorithm: "+r.hash.name.toUpperCase())}case"RSASSA-PKCS1-V1_5":if(a=["sign"],s.kty="RSA",s.ext=n,s.key_ops=a,"1.2.840.113549.1.1.1"!==R.privateKeyAlgorithm.algorithmId)return Promise.reject("Incorrect private key algorithm: "+R.privateKeyAlgorithm.algorithmId);if("alg"in s==!1)switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="RS1";break;case"SHA-256":s.alg="RS256";break;case"SHA-384":s.alg="RS384";break;case"SHA-512":s.alg="RS512";break;default:return Promise.reject("Incorrect hash algorithm: "+r.hash.name.toUpperCase())}var B=R.toJSON(),x=!0,U=!1,D=void 0;try{for(var L,T=Object.keys(B)[Symbol.iterator]();!(x=(L=T.next()).done);x=!0){var j=L.value;s[j]=B[j]}}catch(e){U=!0,D=e}finally{try{!x&&T.return&&T.return()}finally{if(U)throw D}}break;case"ECDSA":a=["sign"];case"ECDH":if(s={kty:"EC",ext:n,key_ops:a},"1.2.840.10045.2.1"!==R.privateKeyAlgorithm.algorithmId)return Promise.reject("Incorrect algorithm: "+R.privateKeyAlgorithm.algorithmId);var H=R.toJSON(),V=!0,M=!1,K=void 0;try{for(var X,G=Object.keys(H)[Symbol.iterator]();!(V=(X=G.next()).done);V=!0){var F=X.value;s[F]=H[F]}}catch(e){M=!0,K=e}finally{try{!V&&G.return&&G.return()}finally{if(M)throw K}}break;case"RSA-OAEP":if(s.kty="RSA",s.ext=n,s.key_ops=a,"safari"===this.name.toLowerCase())s.alg="RSA-OAEP";else switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="RSA-OAEP-1";break;case"SHA-256":s.alg="RSA-OAEP-256";break;case"SHA-384":s.alg="RSA-OAEP-384";break;case"SHA-512":s.alg="RSA-OAEP-512";break;default:return Promise.reject("Incorrect hash algorithm: "+r.hash.name.toUpperCase())}var J=R.toJSON(),q=!0,W=!1,Q=void 0;try{for(var z,Y=Object.keys(J)[Symbol.iterator]();!(q=(z=Y.next()).done);q=!0){var Z=z.value;s[Z]=J[Z]}}catch(e){W=!0,Q=e}finally{try{!q&&Y.return&&Y.return()}finally{if(W)throw Q}}break;default:return Promise.reject("Incorrect algorithm name: "+r.name.toUpperCase())}break;case"jwk":s=t;break;default:return Promise.reject("Incorrect format: "+e)}return"safari"===this.name.toLowerCase()?Promise.resolve().then(function(){return i.subtle.importKey("jwk",Rt(JSON.stringify(s)),r,n,a)}).then(function(e){return e},function(e){return i.subtle.importKey("jwk",s,r,n,a)}):this.subtle.importKey("jwk",s,r,n,a)}},{key:"exportKey",value:function(e,t){var r=this.subtle.exportKey("jwk",t);switch("safari"===this.name.toLowerCase()&&(r=r.then(function(e){return e instanceof ArrayBuffer?JSON.parse(Et(e)):e})),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":r=r.then(function(e){var t=new Dt;try{t.fromJSON(e)}catch(e){return Promise.reject("Incorrect key data")}return t.toSchema().toBER(!1)});break;case"pkcs8":r=r.then(function(e){var t=new Vt;try{t.fromJSON(e)}catch(e){return Promise.reject("Incorrect key data")}return t.toSchema().toBER(!1)});break;case"jwk":break;default:return Promise.reject("Incorrect format: "+e)}return r}},{key:"convert",value:function(e,t,r,n,a,i){var s=this;switch(e.toLowerCase()){case"raw":switch(t.toLowerCase()){case"raw":return Promise.resolve(r);case"spki":return Promise.resolve().then(function(){return s.importKey("raw",r,n,a,i)}).then(function(e){return s.exportKey("spki",e)});case"pkcs8":return Promise.resolve().then(function(){return s.importKey("raw",r,n,a,i)}).then(function(e){return s.exportKey("pkcs8",e)});case"jwk":return Promise.resolve().then(function(){return s.importKey("raw",r,n,a,i)}).then(function(e){return s.exportKey("jwk",e)});default:return Promise.reject("Incorrect outputFormat: "+t)}case"spki":switch(t.toLowerCase()){case"raw":return Promise.resolve().then(function(){return s.importKey("spki",r,n,a,i)}).then(function(e){return s.exportKey("raw",e)});case"spki":return Promise.resolve(r);case"pkcs8":return Promise.reject("Impossible to convert between SPKI/PKCS8");case"jwk":return Promise.resolve().then(function(){return s.importKey("spki",r,n,a,i)}).then(function(e){return s.exportKey("jwk",e)});default:return Promise.reject("Incorrect outputFormat: "+t)}case"pkcs8":switch(t.toLowerCase()){case"raw":return Promise.resolve().then(function(){return s.importKey("pkcs8",r,n,a,i)}).then(function(e){return s.exportKey("raw",e)});case"spki":return Promise.reject("Impossible to convert between SPKI/PKCS8");case"pkcs8":return Promise.resolve(r);case"jwk":return Promise.resolve().then(function(){return s.importKey("pkcs8",r,n,a,i)}).then(function(e){return s.exportKey("jwk",e)});default:return Promise.reject("Incorrect outputFormat: "+t)}case"jwk":switch(t.toLowerCase()){case"raw":return Promise.resolve().then(function(){return s.importKey("jwk",r,n,a,i)}).then(function(e){return s.exportKey("raw",e)});case"spki":return Promise.resolve().then(function(){return s.importKey("jwk",r,n,a,i)}).then(function(e){return s.exportKey("spki",e)});case"pkcs8":return Promise.resolve().then(function(){return s.importKey("jwk",r,n,a,i)}).then(function(e){return s.exportKey("pkcs8",e)});case"jwk":return Promise.resolve(r);default:return Promise.reject("Incorrect outputFormat: "+t)}default:return Promise.reject("Incorrect inputFormat: "+e)}}},{key:"encrypt",value:function(){var e;return(e=this.subtle).encrypt.apply(e,arguments)}},{key:"decrypt",value:function(){var e;return(e=this.subtle).decrypt.apply(e,arguments)}},{key:"sign",value:function(){var e;return(e=this.subtle).sign.apply(e,arguments)}},{key:"verify",value:function(){var e;return(e=this.subtle).verify.apply(e,arguments)}},{key:"digest",value:function(){var e;return(e=this.subtle).digest.apply(e,arguments)}},{key:"generateKey",value:function(){var e;return(e=this.subtle).generateKey.apply(e,arguments)}},{key:"deriveKey",value:function(){var e;return(e=this.subtle).deriveKey.apply(e,arguments)}},{key:"deriveBits",value:function(){var e;return(e=this.subtle).deriveBits.apply(e,arguments)}},{key:"wrapKey",value:function(){var e;return(e=this.subtle).wrapKey.apply(e,arguments)}},{key:"unwrapKey",value:function(){var e;return(e=this.subtle).unwrapKey.apply(e,arguments)}},{key:"getRandomValues",value:function(e){if("getRandomValues"in this.crypto==!1)throw new Error("No support for getRandomValues");return this.crypto.getRandomValues(e)}},{key:"getAlgorithmByOID",value:function(e){switch(e){case"1.2.840.113549.1.1.1":case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}return{}}},{key:"getOIDByAlgorithm",value:function(e){var t="";switch(e.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.113549.1.1.5";break;case"SHA-256":t="1.2.840.113549.1.1.11";break;case"SHA-384":t="1.2.840.113549.1.1.12";break;case"SHA-512":t="1.2.840.113549.1.1.13"}break;case"RSA-PSS":t="1.2.840.113549.1.1.10";break;case"RSA-OAEP":t="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.10045.4.1";break;case"SHA-256":t="1.2.840.10045.4.3.2";break;case"SHA-384":t="1.2.840.10045.4.3.3";break;case"SHA-512":t="1.2.840.10045.4.3.4"}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":t="1.3.133.16.840.63.0.2";break;case"SHA-256":t="1.3.132.1.11.1";break;case"SHA-384":t="1.3.132.1.11.2";break;case"SHA-512":t="1.3.132.1.11.3"}break;case"AES-CTR":break;case"AES-CBC":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.2";break;case 192:t="2.16.840.1.101.3.4.1.22";break;case 256:t="2.16.840.1.101.3.4.1.42"}break;case"AES-CMAC":break;case"AES-GCM":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.6";break;case 192:t="2.16.840.1.101.3.4.1.26";break;case 256:t="2.16.840.1.101.3.4.1.46"}break;case"AES-CFB":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.4";break;case 192:t="2.16.840.1.101.3.4.1.24";break;case 256:t="2.16.840.1.101.3.4.1.44"}break;case"AES-KW":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.5";break;case 192:t="2.16.840.1.101.3.4.1.25";break;case 256:t="2.16.840.1.101.3.4.1.45"}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.113549.2.7";break;case"SHA-256":t="1.2.840.113549.2.9";break;case"SHA-384":t="1.2.840.113549.2.10";break;case"SHA-512":t="1.2.840.113549.2.11"}break;case"DH":t="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":t="1.3.14.3.2.26";break;case"SHA-256":t="2.16.840.1.101.3.4.2.1";break;case"SHA-384":t="2.16.840.1.101.3.4.2.2";break;case"SHA-512":t="2.16.840.1.101.3.4.2.3";break;case"CONCAT":case"HKDF":break;case"PBKDF2":t="1.2.840.113549.1.5.12";break;case"P-256":t="1.2.840.10045.3.1.7";break;case"P-384":t="1.3.132.0.34";break;case"P-521":t="1.3.132.0.35"}return t}},{key:"getAlgorithmParameters",value:function(e,t){var r={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":r={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":r={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":r={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":r={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;case"exportkey":default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":r={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":r={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":r={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":r={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":switch(t.toLowerCase()){case"derivekey":r={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"HKDF"},usages:[]}}break;case"PBKDF2":switch(t.toLowerCase()){case"derivekey":r={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"PBKDF2"},usages:[]}}}return r}},{key:"getHashAlgorithm",value:function(e){var t="";switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{var r=new Kt({schema:e.algorithmParams});if("hashAlgorithm"in r){var n=this.getAlgorithmByOID(r.hashAlgorithm.algorithmId);if("name"in n==!1)return"";t=n.name}else t="SHA-1"}catch(e){}}return t}},{key:"encryptEncryptedContentInfo",value:function(e){var t=this;if(e instanceof Object==!1)return Promise.reject('Parameters must have type "Object"');if("password"in e==!1)return Promise.reject('Absent mandatory parameter "password"');if("contentEncryptionAlgorithm"in e==!1)return Promise.reject('Absent mandatory parameter "contentEncryptionAlgorithm"');if("hmacHashAlgorithm"in e==!1)return Promise.reject('Absent mandatory parameter "hmacHashAlgorithm"');if("iterationCount"in e==!1)return Promise.reject('Absent mandatory parameter "iterationCount"');if("contentToEncrypt"in e==!1)return Promise.reject('Absent mandatory parameter "contentToEncrypt"');if("contentType"in e==!1)return Promise.reject('Absent mandatory parameter "contentType"');var r=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm);if(""===r)return Promise.reject('Wrong "contentEncryptionAlgorithm" value');var n=this.getOIDByAlgorithm({name:"PBKDF2"});if(""===n)return Promise.reject("Can not find OID for PBKDF2");var a=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}});if(""===a)return Promise.reject('Incorrect value for "hmacHashAlgorithm": '+e.hmacHashAlgorithm);var i=Promise.resolve(),s=new ArrayBuffer(16),o=new Uint8Array(s);this.getRandomValues(o);var l=new ArrayBuffer(64),u=new Uint8Array(l);this.getRandomValues(u);var c=new Uint8Array(e.contentToEncrypt),h=new Xt({salt:new De({valueHex:l}),iterationCount:e.iterationCount,prf:new Bt({algorithmId:a,algorithmParams:new xe})});return i=(i=(i=(i=i.then(function(){var r=new Uint8Array(e.password);return t.importKey("raw",r,"PBKDF2",!1,["deriveKey"])},function(e){return Promise.reject(e)})).then(function(r){return t.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:u,iterations:e.iterationCount},r,e.contentEncryptionAlgorithm,!1,["encrypt"])},function(e){return Promise.reject(e)})).then(function(r){return t.encrypt({name:e.contentEncryptionAlgorithm.name,iv:o},r,c)},function(e){return Promise.reject(e)})).then(function(t){var a=new Gt({keyDerivationFunc:new Bt({algorithmId:n,algorithmParams:h.toSchema()}),encryptionScheme:new Bt({algorithmId:r,algorithmParams:new De({valueHex:s})})});return new Mt({contentType:e.contentType,contentEncryptionAlgorithm:new Bt({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:a.toSchema()}),encryptedContent:new De({valueHex:t})})},function(e){return Promise.reject(e)})}},{key:"decryptEncryptedContentInfo",value:function(e){var t=this;if(e instanceof Object==!1)return Promise.reject('Parameters must have type "Object"');if("password"in e==!1)return Promise.reject('Absent mandatory parameter "password"');if("encryptedContentInfo"in e==!1)return Promise.reject('Absent mandatory parameter "encryptedContentInfo"');if("1.2.840.113549.1.5.13"!==e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId)return Promise.reject('Unknown "contentEncryptionAlgorithm": '+this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId);var r=Promise.resolve(),n=void 0;try{n=new Gt({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "pbes2Parameters"')}var a=void 0;try{a=new Xt({schema:n.keyDerivationFunc.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "pbkdf2Params"')}var i=this.getAlgorithmByOID(n.encryptionScheme.algorithmId);if("name"in i==!1)return Promise.reject('Incorrect OID for "contentEncryptionAlgorithm": '+n.encryptionScheme.algorithmId);var s=n.encryptionScheme.algorithmParams.valueBlock.valueHex,o=new Uint8Array(s),l=a.salt.valueBlock.valueHex,u=new Uint8Array(l),c=a.iterationCount,h="SHA-1";if("prf"in a){var m=this.getAlgorithmByOID(a.prf.algorithmId);if("name"in m==!1)return Promise.reject("Incorrect OID for HMAC hash algorithm");h=m.hash.name}return r=(r=(r=r.then(function(){return t.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"])},function(e){return Promise.reject(e)})).then(function(e){return t.deriveKey({name:"PBKDF2",hash:{name:h},salt:u,iterations:c},e,i,!1,["decrypt"])},function(e){return Promise.reject(e)})).then(function(r){var n=new ArrayBuffer(0);if(!1===e.encryptedContentInfo.encryptedContent.idBlock.isConstructed)n=e.encryptedContentInfo.encryptedContent.valueBlock.valueHex;else{var a=!0,s=!1,l=void 0;try{for(var u,c=e.encryptedContentInfo.encryptedContent.valueBlock.value[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){n=Nt(n,u.value.valueBlock.valueHex)}}catch(e){s=!0,l=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw l}}}return t.decrypt({name:i.name,iv:o},r,n)},function(e){return Promise.reject(e)})}},{key:"stampDataWithPassword",value:function(e){var t=this;if(e instanceof Object==!1)return Promise.reject('Parameters must have type "Object"');if("password"in e==!1)return Promise.reject('Absent mandatory parameter "password"');if("hashAlgorithm"in e==!1)return Promise.reject('Absent mandatory parameter "hashAlgorithm"');if("salt"in e==!1)return Promise.reject('Absent mandatory parameter "iterationCount"');if("iterationCount"in e==!1)return Promise.reject('Absent mandatory parameter "salt"');if("contentToStamp"in e==!1)return Promise.reject('Absent mandatory parameter "contentToStamp"');var r=void 0;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":r=160;break;case"sha-256":r=256;break;case"sha-384":r=384;break;case"sha-512":r=512;break;default:return Promise.reject('Incorrect "parameters.hashAlgorithm" parameter: '+e.hashAlgorithm)}var n=Promise.resolve(),a={name:"HMAC",length:r,hash:{name:e.hashAlgorithm}};return n=(n=(n=n.then(function(){return Ft(t,e.hashAlgorithm,r,e.password,e.salt,e.iterationCount)})).then(function(e){return t.importKey("raw",new Uint8Array(e),a,!1,["sign"])})).then(function(r){return t.sign(a,r,new Uint8Array(e.contentToStamp))},function(e){return Promise.reject(e)})}},{key:"verifyDataStampedWithPassword",value:function(e){var t=this;if(e instanceof Object==!1)return Promise.reject('Parameters must have type "Object"');if("password"in e==!1)return Promise.reject('Absent mandatory parameter "password"');if("hashAlgorithm"in e==!1)return Promise.reject('Absent mandatory parameter "hashAlgorithm"');if("salt"in e==!1)return Promise.reject('Absent mandatory parameter "iterationCount"');if("iterationCount"in e==!1)return Promise.reject('Absent mandatory parameter "salt"');if("contentToVerify"in e==!1)return Promise.reject('Absent mandatory parameter "contentToVerify"');if("signatureToVerify"in e==!1)return Promise.reject('Absent mandatory parameter "signatureToVerify"');var r=void 0;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":r=160;break;case"sha-256":r=256;break;case"sha-384":r=384;break;case"sha-512":r=512;break;default:return Promise.reject('Incorrect "parameters.hashAlgorithm" parameter: '+e.hashAlgorithm)}var n=Promise.resolve(),a={name:"HMAC",length:r,hash:{name:e.hashAlgorithm}};return n=(n=(n=n.then(function(){return Ft(t,e.hashAlgorithm,r,e.password,e.salt,e.iterationCount)})).then(function(e){return t.importKey("raw",new Uint8Array(e),a,!1,["verify"])})).then(function(r){return t.verify(a,r,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify))},function(e){return Promise.reject(e)})}},{key:"getSignatureParameters",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"SHA-1";if(""===this.getOIDByAlgorithm({name:t}))return Promise.reject("Unsupported hash algorithm: "+t);var r=new Bt,n=this.getAlgorithmParameters(e.algorithm.name,"sign");switch(n.algorithm.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":r.algorithmId=this.getOIDByAlgorithm(n.algorithm);break;case"RSA-PSS":switch(t.toUpperCase()){case"SHA-256":n.algorithm.saltLength=32;break;case"SHA-384":n.algorithm.saltLength=48;break;case"SHA-512":n.algorithm.saltLength=64}var a={};if("SHA-1"!==t.toUpperCase()){var i=this.getOIDByAlgorithm({name:t});if(""===i)return Promise.reject("Unsupported hash algorithm: "+t);a.hashAlgorithm=new Bt({algorithmId:i,algorithmParams:new xe}),a.maskGenAlgorithm=new Bt({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:a.hashAlgorithm.toSchema()})}20!==n.algorithm.saltLength&&(a.saltLength=n.algorithm.saltLength);var s=new Kt(a);r.algorithmId="1.2.840.113549.1.1.10",r.algorithmParams=s.toSchema();break;default:return Promise.reject("Unsupported signature algorithm: "+e.algorithm.name)}return Promise.resolve().then(function(){return{signatureAlgorithm:r,parameters:n}})}},{key:"signWithPrivateKey",value:function(e,t,r){return this.sign(r.algorithm,t,new Uint8Array(e)).then(function(e){return"ECDSA"===r.algorithm.name&&(e=function(e){if(e.byteLength%2!=0)return new ArrayBuffer(0);var t=e.byteLength/2,r=new ArrayBuffer(t);new Uint8Array(r).set(new Uint8Array(e,0,t));var n=new He({valueHex:r}),a=new ArrayBuffer(t);new Uint8Array(a).set(new Uint8Array(e,t,t));var i=new He({valueHex:a});return new Oe({value:[n.convertToDER(),i.convertToDER()]}).toBER(!1)}(e)),e},function(e){return Promise.reject("Signing error: "+e)})}}]),e}(),qt={name:"none",crypto:null,subtle:null};function Wt(){if(null!==qt.subtle)return qt.subtle}function Qt(e,t){return qt.subtle.getAlgorithmParameters(e,t)}function zt(e){var t=e.replace(/^\s+|\s+$/g,"");return t=(t=t.replace(/\s+/g," ")).toLowerCase()}function Yt(e){return qt.subtle.getAlgorithmByOID(e)}function Zt(e){return qt.subtle.getHashAlgorithm(e)}!function(){if("undefined"!=typeof self&&"crypto"in self){var e="webcrypto",t=self.crypto,r=null;if("webkitSubtle"in self.crypto){try{r=self.crypto.webkitSubtle}catch(e){r=self.crypto.subtle}e="safari"}"subtle"in self.crypto&&(r=self.crypto.subtle),qt={name:e,crypto:t,subtle:new Jt({name:e,crypto:self.crypto,subtle:r})}}}();var $t=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.type=Ct(t,"type",e.defaultValues("type")),this.value=Ct(t,"value",e.defaultValues("value")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{type:"type",value:"typeValue"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for ATTR_TYPE_AND_VALUE");this.type=r.result.type.valueBlock.toString(),this.value=r.result.typeValue}},{key:"toSchema",value:function(){return new Oe({value:[new Xe({value:this.type}),this.value]})}},{key:"toJSON",value:function(){var e={type:this.type};return 0!==Object.keys(this.value).length?e.value=this.value.toJSON():e.value=this.value,e}},{key:"isEqual",value:function(t){if(t instanceof e){if(this.type!==t.type)return!1;if(this.value instanceof Fe&&t.value instanceof Fe||this.value instanceof qe&&t.value instanceof qe||this.value instanceof Qe&&t.value instanceof Qe||this.value instanceof Ze&&t.value instanceof Ze||this.value instanceof $e&&t.value instanceof $e||this.value instanceof et&&t.value instanceof et||this.value instanceof tt&&t.value instanceof tt||this.value instanceof rt&&t.value instanceof rt||this.value instanceof nt&&t.value instanceof nt||this.value instanceof at&&t.value instanceof at||this.value instanceof it&&t.value instanceof it||this.value instanceof st&&t.value instanceof st){var r=zt(this.value.valueBlock.value),n=zt(t.value.valueBlock.value);if(0!==r.localeCompare(n))return!1}else if(!1===St(this.value.valueBeforeDecode,t.value.valueBeforeDecode))return!1;return!0}return t instanceof ArrayBuffer&&St(this.value.valueBeforeDecode,t)}}],[{key:"defaultValues",value:function(e){switch(e){case"type":return"";case"value":return{};default:throw new Error("Invalid member name for AttributeTypeAndValue class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new Xe({name:e.type||""}),new vt({name:e.value||""})]})}}]),e}(),er=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.typesAndValues=Ct(t,"typesAndValues",e.defaultValues("typesAndValues")),this.valueBeforeDecode=Ct(t,"valueBeforeDecode",e.defaultValues("valueBeforeDecode")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{blockName:"RDN",repeatedSet:"typesAndValues"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RDN");"typesAndValues"in r.result&&(this.typesAndValues=Array.from(r.result.typesAndValues,function(e){return new $t({schema:e})})),this.valueBeforeDecode=r.result.RDN.valueBeforeDecode}},{key:"toSchema",value:function(){return 0===this.valueBeforeDecode.byteLength?new Oe({value:[new Be({value:Array.from(this.typesAndValues,function(e){return e.toSchema()})})]}):bt(this.valueBeforeDecode).result}},{key:"toJSON",value:function(){return{typesAndValues:Array.from(this.typesAndValues,function(e){return e.toJSON()})}}},{key:"isEqual",value:function(t){if(t instanceof e){if(this.typesAndValues.length!==t.typesAndValues.length)return!1;var r=!0,n=!1,a=void 0;try{for(var i,s=this.typesAndValues.entries()[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var o=_slicedToArray(i.value,2),l=o[0];if(!1===o[1].isEqual(t.typesAndValues[l]))return!1}}catch(e){n=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw a}}return!0}return t instanceof ArrayBuffer&&St(this.valueBeforeDecode,t)}}],[{key:"defaultValues",value:function(e){switch(e){case"typesAndValues":return[];case"valueBeforeDecode":return new ArrayBuffer(0);default:throw new Error("Invalid member name for RelativeDistinguishedNames class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"typesAndValues":return 0===t.length;case"valueBeforeDecode":return 0===t.byteLength;default:throw new Error("Invalid member name for RelativeDistinguishedNames class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new dt({name:e.repeatedSequence||"",value:new Be({value:[new dt({name:e.repeatedSet||"",value:$t.schema(e.typeAndValue||{})})]})})]})}}]),e}();var tr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.type=Ct(t,"type",e.defaultValues("type")),this.value=Ct(t,"value",e.defaultValues("value")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for GENERAL_NAME");switch(this.type=r.result.blockName.idBlock.tagNumber,this.type){case 0:this.value=r.result.blockName;break;case 1:case 2:case 6:var n=r.result.blockName;n.idBlock.tagClass=1,n.idBlock.tagNumber=22;var a=n.toBER(!1);this.value=bt(a).result.valueBlock.value;break;case 3:this.value=r.result.blockName;break;case 4:this.value=new er({schema:r.result.directoryName});break;case 5:this.value=r.result.ediPartyName;break;case 7:this.value=new De({valueHex:r.result.blockName.valueBlock.valueHex});break;case 8:var i=r.result.blockName;i.idBlock.tagClass=1,i.idBlock.tagNumber=6;var s=i.toBER(!1);this.value=bt(s).result.valueBlock.toString()}}},{key:"toSchema",value:function(){switch(this.type){case 0:case 3:case 5:return new _e({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:var t=new rt({value:this.value});return t.idBlock.tagClass=3,t.idBlock.tagNumber=this.type,t;case 4:return new _e({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:var r=this.value;return r.idBlock.tagClass=3,r.idBlock.tagNumber=this.type,r;case 8:var n=new Xe({value:this.value});return n.idBlock.tagClass=3,n.idBlock.tagNumber=this.type,n;default:return e.schema()}}},{key:"toJSON",value:function(){var e={type:this.type};return"string"==typeof this.value?e.value=this.value:e.value=this.value.toJSON(),e}}],[{key:"defaultValues",value:function(e){switch(e){case"type":return 9;case"value":return{};default:throw new Error("Invalid member name for GeneralName class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"type":return r===e.defaultValues(t);case"value":return 0===Object.keys(r).length;default:throw new Error("Invalid member name for GeneralName class: "+t)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new pt({value:[new _e({idBlock:{tagClass:3,tagNumber:0},name:e.blockName||"",value:[new Xe,new _e({idBlock:{tagClass:3,tagNumber:0},value:[new vt]})]}),new Se({name:e.blockName||"",idBlock:{tagClass:3,tagNumber:1}}),new Se({name:e.blockName||"",idBlock:{tagClass:3,tagNumber:2}}),new _e({idBlock:{tagClass:3,tagNumber:3},name:e.blockName||"",value:[function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ct(e,"names",{});return new Oe({optional:t,value:[new _e({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:r.country_name||"",value:[new pt({value:[new Ze,new $e]})]}),new _e({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:r.administration_domain_name||"",value:[new pt({value:[new Ze,new $e]})]}),new Se({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:r.network_address||"",isHexOnly:!0}),new Se({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:r.terminal_identifier||"",isHexOnly:!0}),new _e({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:r.private_domain_name||"",value:[new pt({value:[new Ze,new $e]})]}),new Se({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:r.organization_name||"",isHexOnly:!0}),new Se({optional:!0,name:r.numeric_user_identifier||"",idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new _e({optional:!0,name:r.personal_name||"",idBlock:{tagClass:3,tagNumber:5},value:[new Se({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new Se({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new Se({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new Se({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new _e({optional:!0,name:r.organizational_unit_names||"",idBlock:{tagClass:3,tagNumber:6},value:[new dt({value:new $e})]})]})}(e.builtInStandardAttributes||{},!1),function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Oe({optional:e,value:[new $e,new $e]})}(!0),function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Be({optional:e,value:[new Se({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new _e({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new vt]})]})}(!0)]}),new _e({idBlock:{tagClass:3,tagNumber:4},name:e.blockName||"",value:[er.schema(e.directoryName||{})]}),new _e({idBlock:{tagClass:3,tagNumber:5},name:e.blockName||"",value:[new _e({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new pt({value:[new et,new $e,new Qe,new Fe,new qe]})]}),new _e({idBlock:{tagClass:3,tagNumber:1},value:[new pt({value:[new et,new $e,new Qe,new Fe,new qe]})]})]}),new Se({name:e.blockName||"",idBlock:{tagClass:3,tagNumber:6}}),new Se({name:e.blockName||"",idBlock:{tagClass:3,tagNumber:7}}),new Se({name:e.blockName||"",idBlock:{tagClass:3,tagNumber:8}})]})}}]),e}(),rr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.accessMethod=Ct(t,"accessMethod",e.defaultValues("accessMethod")),this.accessLocation=Ct(t,"accessLocation",e.defaultValues("accessLocation")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{accessMethod:"accessMethod",accessLocation:{names:{blockName:"accessLocation"}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for AccessDescription");this.accessMethod=r.result.accessMethod.valueBlock.toString(),this.accessLocation=new tr({schema:r.result.accessLocation})}},{key:"toSchema",value:function(){return new Oe({value:[new Xe({value:this.accessMethod}),this.accessLocation.toSchema()]})}},{key:"toJSON",value:function(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"accessMethod":return"";case"accessLocation":return new tr;default:throw new Error("Invalid member name for AccessDescription class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new Xe({name:e.accessMethod||""}),tr.schema(e.accessLocation||{})]})}}]),e}(),nr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.altNames=Ct(t,"altNames",e.defaultValues("altNames")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{altNames:"altNames"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for AltName");"altNames"in r.result&&(this.altNames=Array.from(r.result.altNames,function(e){return new tr({schema:e})}))}},{key:"toSchema",value:function(){return new Oe({value:Array.from(this.altNames,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{altNames:Array.from(this.altNames,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"altNames":return[];default:throw new Error("Invalid member name for AltName class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new dt({name:e.altNames||"",value:tr.schema()})]})}}]),e}(),ar=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.type=Ct(t,"type",e.defaultValues("type")),this.value=Ct(t,"value",e.defaultValues("value")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{utcTimeName:"utcTimeName",generalTimeName:"generalTimeName"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for TIME");"utcTimeName"in r.result&&(this.type=0,this.value=r.result.utcTimeName.toDate()),"generalTimeName"in r.result&&(this.type=1,this.value=r.result.generalTimeName.toDate())}},{key:"toSchema",value:function(){var e={};return 0===this.type&&(e=new ot({valueDate:this.value})),1===this.type&&(e=new lt({valueDate:this.value})),e}},{key:"toJSON",value:function(){return{type:this.type,value:this.value}}}],[{key:"defaultValues",value:function(e){switch(e){case"type":return 0;case"value":return new Date(0,0,0);default:throw new Error("Invalid member name for Time class: "+e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ct(e,"names",{});return new pt({optional:t,value:[new ot({name:r.utcTimeName||""}),new lt({name:r.generalTimeName||""})]})}}]),e}(),ir=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.attributes=Ct(t,"attributes",e.defaultValues("attributes")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{attributes:"attributes"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for SubjectDirectoryAttributes");this.attributes=Array.from(r.result.attributes,function(e){return new Lt({schema:e})})}},{key:"toSchema",value:function(){return new Oe({value:Array.from(this.attributes,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{attributes:Array.from(this.attributes,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"attributes":return[];default:throw new Error("Invalid member name for SubjectDirectoryAttributes class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new dt({name:e.attributes||"",value:Lt.schema()})]})}}]),e}(),sr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),"notBefore"in t&&(this.notBefore=Ct(t,"notBefore",e.defaultValues("notBefore"))),"notAfter"in t&&(this.notAfter=Ct(t,"notAfter",e.defaultValues("notAfter"))),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{notBefore:"notBefore",notAfter:"notAfter"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PrivateKeyUsagePeriod");if("notBefore"in r.result){var n=new lt;n.fromBuffer(r.result.notBefore.valueBlock.valueHex),this.notBefore=n.toDate()}if("notAfter"in r.result){var a=new lt({valueHex:r.result.notAfter.valueBlock.valueHex});a.fromBuffer(r.result.notAfter.valueBlock.valueHex),this.notAfter=a.toDate()}}},{key:"toSchema",value:function(){var e=[];return"notBefore"in this&&e.push(new Se({idBlock:{tagClass:3,tagNumber:0},valueHex:new lt({valueDate:this.notBefore}).valueBlock.valueHex})),"notAfter"in this&&e.push(new Se({idBlock:{tagClass:3,tagNumber:1},valueHex:new lt({valueDate:this.notAfter}).valueBlock.valueHex})),new Oe({value:e})}},{key:"toJSON",value:function(){var e={};return"notBefore"in this&&(e.notBefore=this.notBefore),"notAfter"in this&&(e.notAfter=this.notAfter),e}}],[{key:"defaultValues",value:function(e){switch(e){case"notBefore":case"notAfter":return new Date;default:throw new Error("Invalid member name for PrivateKeyUsagePeriod class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new Se({name:e.notBefore||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Se({name:e.notAfter||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}}]),e}(),or=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.cA=Ct(t,"cA",!1),"pathLenConstraint"in t&&(this.pathLenConstraint=Ct(t,"pathLenConstraint",0)),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{cA:"cA",pathLenConstraint:"pathLenConstraint"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for BasicConstraints");"cA"in r.result&&(this.cA=r.result.cA.valueBlock.value),"pathLenConstraint"in r.result&&(r.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=r.result.pathLenConstraint:this.pathLenConstraint=r.result.pathLenConstraint.valueBlock.valueDec)}},{key:"toSchema",value:function(){var t=[];return this.cA!==e.defaultValues("cA")&&t.push(new Re({value:this.cA})),"pathLenConstraint"in this&&(this.pathLenConstraint instanceof He?t.push(this.pathLenConstraint):t.push(new He({value:this.pathLenConstraint}))),new Oe({value:t})}},{key:"toJSON",value:function(){var t={};return this.cA!==e.defaultValues("cA")&&(t.cA=this.cA),"pathLenConstraint"in this&&(this.pathLenConstraint instanceof He?t.pathLenConstraint=this.pathLenConstraint.toJSON():t.pathLenConstraint=this.pathLenConstraint),t}}],[{key:"defaultValues",value:function(e){switch(e){case"cA":return!1;default:throw new Error("Invalid member name for BasicConstraints class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new Re({optional:!0,name:e.cA||""}),new He({optional:!0,name:e.pathLenConstraint||""})]})}}]),e}(),lr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),"distributionPoint"in t&&(this.distributionPoint=Ct(t,"distributionPoint",e.defaultValues("distributionPoint"))),this.onlyContainsUserCerts=Ct(t,"onlyContainsUserCerts",e.defaultValues("onlyContainsUserCerts")),this.onlyContainsCACerts=Ct(t,"onlyContainsCACerts",e.defaultValues("onlyContainsCACerts")),"onlySomeReasons"in t&&(this.onlySomeReasons=Ct(t,"onlySomeReasons",e.defaultValues("onlySomeReasons"))),this.indirectCRL=Ct(t,"indirectCRL",e.defaultValues("indirectCRL")),this.onlyContainsAttributeCerts=Ct(t,"onlyContainsAttributeCerts",e.defaultValues("onlyContainsAttributeCerts")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{distributionPoint:"distributionPoint",distributionPointNames:"distributionPointNames",onlyContainsUserCerts:"onlyContainsUserCerts",onlyContainsCACerts:"onlyContainsCACerts",onlySomeReasons:"onlySomeReasons",indirectCRL:"indirectCRL",onlyContainsAttributeCerts:"onlyContainsAttributeCerts"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for IssuingDistributionPoint");if("distributionPoint"in r.result)switch(!0){case 0===r.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=Array.from(r.result.distributionPointNames,function(e){return new tr({schema:e})});break;case 1===r.result.distributionPoint.idBlock.tagNumber:r.result.distributionPoint.idBlock.tagClass=1,r.result.distributionPoint.idBlock.tagNumber=16,this.distributionPoint=new er({schema:r.result.distributionPoint});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if("onlyContainsUserCerts"in r.result){var n=new Uint8Array(r.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=0!==n[0]}if("onlyContainsCACerts"in r.result){var a=new Uint8Array(r.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=0!==a[0]}if("onlySomeReasons"in r.result){var i=new Uint8Array(r.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=i[0]}if("indirectCRL"in r.result){var s=new Uint8Array(r.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=0!==s[0]}if("onlyContainsAttributeCerts"in r.result){var o=new Uint8Array(r.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=0!==o[0]}}},{key:"toSchema",value:function(){var t=[];if("distributionPoint"in this){var r=void 0;this.distributionPoint instanceof Array?r=new _e({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,function(e){return e.toSchema()})}):((r=this.distributionPoint.toSchema()).idBlock.tagClass=3,r.idBlock.tagNumber=1),t.push(r)}if(this.onlyContainsUserCerts!==e.defaultValues("onlyContainsUserCerts")&&t.push(new Se({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==e.defaultValues("onlyContainsCACerts")&&t.push(new Se({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),"onlySomeReasons"in this){var n=new ArrayBuffer(1);new Uint8Array(n)[0]=this.onlySomeReasons,t.push(new Se({idBlock:{tagClass:3,tagNumber:3},valueHex:n}))}return this.indirectCRL!==e.defaultValues("indirectCRL")&&t.push(new Se({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==e.defaultValues("onlyContainsAttributeCerts")&&t.push(new Se({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new Oe({value:t})}},{key:"toJSON",value:function(){var t={};return"distributionPoint"in this&&(this.distributionPoint instanceof Array?t.distributionPoint=Array.from(this.distributionPoint,function(e){return e.toJSON()}):t.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==e.defaultValues("onlyContainsUserCerts")&&(t.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==e.defaultValues("onlyContainsCACerts")&&(t.onlyContainsCACerts=this.onlyContainsCACerts),"onlySomeReasons"in this&&(t.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==e.defaultValues("indirectCRL")&&(t.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==e.defaultValues("onlyContainsAttributeCerts")&&(t.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),t}}],[{key:"defaultValues",value:function(e){switch(e){case"distributionPoint":return[];case"onlyContainsUserCerts":case"onlyContainsCACerts":return!1;case"onlySomeReasons":return 0;case"indirectCRL":case"onlyContainsAttributeCerts":return!1;default:throw new Error("Invalid member name for IssuingDistributionPoint class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new _e({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new pt({value:[new _e({name:e.distributionPoint||"",idBlock:{tagClass:3,tagNumber:0},value:[new dt({name:e.distributionPointNames||"",value:tr.schema()})]}),new _e({name:e.distributionPoint||"",idBlock:{tagClass:3,tagNumber:1},value:er.schema().valueBlock.value})]})]}),new Se({name:e.onlyContainsUserCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Se({name:e.onlyContainsCACerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new Se({name:e.onlySomeReasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new Se({name:e.indirectCRL||"",optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new Se({name:e.onlyContainsAttributeCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}}]),e}(),ur=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.names=Ct(t,"names",e.defaultValues("names")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{blockName:"names",generalNames:"generalNames"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for GeneralNames");this.names=Array.from(r.result.generalNames,function(e){return new tr({schema:e})})}},{key:"toSchema",value:function(){return new Oe({value:Array.from(this.names,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{names:Array.from(this.names,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"names":return[];default:throw new Error("Invalid member name for GeneralNames class: "+e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ct(e,"names",{});return new Oe({optional:t,name:r.blockName||"",value:[new dt({name:r.generalNames||"",value:tr.schema()})]})}}]),e}(),cr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.base=Ct(t,"base",e.defaultValues("base")),this.minimum=Ct(t,"minimum",e.defaultValues("minimum")),"maximum"in t&&(this.maximum=Ct(t,"maximum",e.defaultValues("maximum"))),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{base:{names:{blockName:"base"}},minimum:"minimum",maximum:"maximum"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for ");this.base=new tr({schema:r.result.base}),"minimum"in r.result&&(r.result.minimum.valueBlock.isHexOnly?this.minimum=r.result.minimum:this.minimum=r.result.minimum.valueBlock.valueDec),"maximum"in r.result&&(r.result.maximum.valueBlock.isHexOnly?this.maximum=r.result.maximum:this.maximum=r.result.maximum.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[];if(e.push(this.base.toSchema()),0!==this.minimum){var t=0;t=this.minimum instanceof He?this.minimum:new He({value:this.minimum}),e.push(new _e({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if("maximum"in this){var r=0;r=this.maximum instanceof He?this.maximum:new He({value:this.maximum}),e.push(new _e({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[r]}))}return new Oe({value:e})}},{key:"toJSON",value:function(){var e={base:this.base.toJSON()};return 0!==this.minimum&&("number"==typeof this.minimum?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),"maximum"in this&&("number"==typeof this.maximum?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"base":return new tr;case"minimum":case"maximum":return 0;default:throw new Error("Invalid member name for GeneralSubtree class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[tr.schema(e.base||{}),new _e({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new He({name:e.minimum||""})]}),new _e({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new He({name:e.maximum||""})]})]})}}]),e}(),hr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),"permittedSubtrees"in t&&(this.permittedSubtrees=Ct(t,"permittedSubtrees",e.defaultValues("permittedSubtrees"))),"excludedSubtrees"in t&&(this.excludedSubtrees=Ct(t,"excludedSubtrees",e.defaultValues("excludedSubtrees"))),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{permittedSubtrees:"permittedSubtrees",excludedSubtrees:"excludedSubtrees"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for NameConstraints");"permittedSubtrees"in r.result&&(this.permittedSubtrees=Array.from(r.result.permittedSubtrees,function(e){return new cr({schema:e})})),"excludedSubtrees"in r.result&&(this.excludedSubtrees=Array.from(r.result.excludedSubtrees,function(e){return new cr({schema:e})}))}},{key:"toSchema",value:function(){var e=[];return"permittedSubtrees"in this&&e.push(new _e({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Oe({value:Array.from(this.permittedSubtrees,function(e){return e.toSchema()})})]})),"excludedSubtrees"in this&&e.push(new _e({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Oe({value:Array.from(this.excludedSubtrees,function(e){return e.toSchema()})})]})),new Oe({value:e})}},{key:"toJSON",value:function(){var e={};return"permittedSubtrees"in this&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,function(e){return e.toJSON()})),"excludedSubtrees"in this&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,function(e){return e.toJSON()})),e}}],[{key:"defaultValues",value:function(e){switch(e){case"permittedSubtrees":case"excludedSubtrees":return[];default:throw new Error("Invalid member name for NameConstraints class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new _e({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new dt({name:e.permittedSubtrees||"",value:cr.schema()})]}),new _e({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new dt({name:e.excludedSubtrees||"",value:cr.schema()})]})]})}}]),e}(),mr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),"distributionPoint"in t&&(this.distributionPoint=Ct(t,"distributionPoint",e.defaultValues("distributionPoint"))),"reasons"in t&&(this.reasons=Ct(t,"reasons",e.defaultValues("reasons"))),"cRLIssuer"in t&&(this.cRLIssuer=Ct(t,"cRLIssuer",e.defaultValues("cRLIssuer"))),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{distributionPoint:"distributionPoint",distributionPointNames:"distributionPointNames",reasons:"reasons",cRLIssuer:"cRLIssuer",cRLIssuerNames:"cRLIssuerNames"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for DistributionPoint");"distributionPoint"in r.result&&(0===r.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=Array.from(r.result.distributionPointNames,function(e){return new tr({schema:e})})),1===r.result.distributionPoint.idBlock.tagNumber&&(r.result.distributionPoint.idBlock.tagClass=1,r.result.distributionPoint.idBlock.tagNumber=16,this.distributionPoint=new er({schema:r.result.distributionPoint}))),"reasons"in r.result&&(this.reasons=new Te({valueHex:r.result.reasons.valueBlock.valueHex})),"cRLIssuer"in r.result&&(this.cRLIssuer=Array.from(r.result.cRLIssuerNames,function(e){return new tr({schema:e})}))}},{key:"toSchema",value:function(){var e=[];if("distributionPoint"in this){var t=void 0;t=this.distributionPoint instanceof Array?new _e({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,function(e){return e.toSchema()})}):new _e({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new _e({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return"reasons"in this&&e.push(new Se({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHex})),"cRLIssuer"in this&&e.push(new _e({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,function(e){return e.toSchema()})})),new Oe({value:e})}},{key:"toJSON",value:function(){var e={};return"distributionPoint"in this&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,function(e){return e.toJSON()}):e.distributionPoint=this.distributionPoint.toJSON()),"reasons"in this&&(e.reasons=this.reasons.toJSON()),"cRLIssuer"in this&&(e.cRLIssuer=Array.from(this.cRLIssuer,function(e){return e.toJSON()})),e}}],[{key:"defaultValues",value:function(e){switch(e){case"distributionPoint":return[];case"reasons":return new Te;case"cRLIssuer":return[];default:throw new Error("Invalid member name for DistributionPoint class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new _e({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new pt({value:[new _e({name:e.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new dt({name:e.distributionPointNames||"",value:tr.schema()})]}),new _e({name:e.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:1},value:er.schema().valueBlock.value})]})]}),new Se({name:e.reasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new _e({name:e.cRLIssuer||"",optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new dt({name:e.cRLIssuerNames||"",value:tr.schema()})]})]})}}]),e}(),fr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.distributionPoints=Ct(t,"distributionPoints",e.defaultValues("distributionPoints")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{distributionPoints:"distributionPoints"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CRLDistributionPoints");this.distributionPoints=Array.from(r.result.distributionPoints,function(e){return new mr({schema:e})})}},{key:"toSchema",value:function(){return new Oe({value:Array.from(this.distributionPoints,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{distributionPoints:Array.from(this.distributionPoints,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"distributionPoints":return[];default:throw new Error("Invalid member name for CRLDistributionPoints class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new dt({name:e.distributionPoints||"",value:mr.schema()})]})}}]),e}(),pr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.policyQualifierId=Ct(t,"policyQualifierId",e.defaultValues("policyQualifierId")),this.qualifier=Ct(t,"qualifier",e.defaultValues("qualifier")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{policyQualifierId:"policyQualifierId",qualifier:"qualifier"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PolicyQualifierInfo");this.policyQualifierId=r.result.policyQualifierId.valueBlock.toString(),this.qualifier=r.result.qualifier}},{key:"toSchema",value:function(){return new Oe({value:[new Xe({value:this.policyQualifierId}),this.qualifier]})}},{key:"toJSON",value:function(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"policyQualifierId":return"";case"qualifier":return new vt;default:throw new Error("Invalid member name for PolicyQualifierInfo class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new Xe({name:e.policyQualifierId||""}),new vt({name:e.qualifier||""})]})}}]),e}(),vr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.policyIdentifier=Ct(t,"policyIdentifier",e.defaultValues("policyIdentifier")),"policyQualifiers"in t&&(this.policyQualifiers=Ct(t,"policyQualifiers",e.defaultValues("policyQualifiers"))),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{policyIdentifier:"policyIdentifier",policyQualifiers:"policyQualifiers"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PolicyInformation");this.policyIdentifier=r.result.policyIdentifier.valueBlock.toString(),"policyQualifiers"in r.result&&(this.policyQualifiers=Array.from(r.result.policyQualifiers,function(e){return new pr({schema:e})}))}},{key:"toSchema",value:function(){var e=[];return e.push(new Xe({value:this.policyIdentifier})),"policyQualifiers"in this&&e.push(new Oe({value:Array.from(this.policyQualifiers,function(e){return e.toSchema()})})),new Oe({value:e})}},{key:"toJSON",value:function(){var e={policyIdentifier:this.policyIdentifier};return"policyQualifiers"in this&&(e.policyQualifiers=Array.from(this.policyQualifiers,function(e){return e.toJSON()})),e}}],[{key:"defaultValues",value:function(e){switch(e){case"policyIdentifier":return"";case"policyQualifiers":return[];default:throw new Error("Invalid member name for PolicyInformation class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new Xe({name:e.policyIdentifier||""}),new Oe({optional:!0,value:[new dt({name:e.policyQualifiers||"",value:pr.schema()})]})]})}}]),e}(),dr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.certificatePolicies=Ct(t,"certificatePolicies",e.defaultValues("certificatePolicies")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{certificatePolicies:"certificatePolicies"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CertificatePolicies");this.certificatePolicies=Array.from(r.result.certificatePolicies,function(e){return new vr({schema:e})})}},{key:"toSchema",value:function(){return new Oe({value:Array.from(this.certificatePolicies,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{certificatePolicies:Array.from(this.certificatePolicies,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"certificatePolicies":return[];default:throw new Error("Invalid member name for CertificatePolicies class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new dt({name:e.certificatePolicies||"",value:vr.schema()})]})}}]),e}(),yr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.issuerDomainPolicy=Ct(t,"issuerDomainPolicy",e.defaultValues("issuerDomainPolicy")),this.subjectDomainPolicy=Ct(t,"subjectDomainPolicy",e.defaultValues("subjectDomainPolicy")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{issuerDomainPolicy:"issuerDomainPolicy",subjectDomainPolicy:"subjectDomainPolicy"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PolicyMapping");this.issuerDomainPolicy=r.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=r.result.subjectDomainPolicy.valueBlock.toString()}},{key:"toSchema",value:function(){return new Oe({value:[new Xe({value:this.issuerDomainPolicy}),new Xe({value:this.subjectDomainPolicy})]})}},{key:"toJSON",value:function(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}],[{key:"defaultValues",value:function(e){switch(e){case"issuerDomainPolicy":case"subjectDomainPolicy":return"";default:throw new Error("Invalid member name for PolicyMapping class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new Xe({name:e.issuerDomainPolicy||""}),new Xe({name:e.subjectDomainPolicy||""})]})}}]),e}(),gr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.mappings=Ct(t,"mappings",e.defaultValues("mappings")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{mappings:"mappings"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PolicyMappings");this.mappings=Array.from(r.result.mappings,function(e){return new yr({schema:e})})}},{key:"toSchema",value:function(){return new Oe({value:Array.from(this.mappings,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{mappings:Array.from(this.mappings,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"mappings":return[];default:throw new Error("Invalid member name for PolicyMappings class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new dt({name:e.mappings||"",value:yr.schema()})]})}}]),e}(),br=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),"keyIdentifier"in t&&(this.keyIdentifier=Ct(t,"keyIdentifier",e.defaultValues("keyIdentifier"))),"authorityCertIssuer"in t&&(this.authorityCertIssuer=Ct(t,"authorityCertIssuer",e.defaultValues("authorityCertIssuer"))),"authorityCertSerialNumber"in t&&(this.authorityCertSerialNumber=Ct(t,"authorityCertSerialNumber",e.defaultValues("authorityCertSerialNumber"))),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{keyIdentifier:"keyIdentifier",authorityCertIssuer:"authorityCertIssuer",authorityCertSerialNumber:"authorityCertSerialNumber"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for AuthorityKeyIdentifier");"keyIdentifier"in r.result&&(r.result.keyIdentifier.idBlock.tagClass=1,r.result.keyIdentifier.idBlock.tagNumber=4,this.keyIdentifier=r.result.keyIdentifier),"authorityCertIssuer"in r.result&&(this.authorityCertIssuer=Array.from(r.result.authorityCertIssuer,function(e){return new tr({schema:e})})),"authorityCertSerialNumber"in r.result&&(r.result.authorityCertSerialNumber.idBlock.tagClass=1,r.result.authorityCertSerialNumber.idBlock.tagNumber=2,this.authorityCertSerialNumber=r.result.authorityCertSerialNumber)}},{key:"toSchema",value:function(){var e=[];if("keyIdentifier"in this){var t=this.keyIdentifier;t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if("authorityCertIssuer"in this&&e.push(new _e({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,function(e){return e.toSchema()})})),"authorityCertSerialNumber"in this){var r=this.authorityCertSerialNumber;r.idBlock.tagClass=3,r.idBlock.tagNumber=2,e.push(r)}return new Oe({value:e})}},{key:"toJSON",value:function(){var e={};return"keyIdentifier"in this&&(e.keyIdentifier=this.keyIdentifier.toJSON()),"authorityCertIssuer"in this&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,function(e){return e.toJSON()})),"authorityCertSerialNumber"in this&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"keyIdentifier":return new De;case"authorityCertIssuer":return[];case"authorityCertSerialNumber":return new He;default:throw new Error("Invalid member name for AuthorityKeyIdentifier class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new Se({name:e.keyIdentifier||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new _e({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new dt({name:e.authorityCertIssuer||"",value:tr.schema()})]}),new Se({name:e.authorityCertSerialNumber||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}}]),e}(),kr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),"requireExplicitPolicy"in t&&(this.requireExplicitPolicy=Ct(t,"requireExplicitPolicy",e.defaultValues("requireExplicitPolicy"))),"inhibitPolicyMapping"in t&&(this.inhibitPolicyMapping=Ct(t,"inhibitPolicyMapping",e.defaultValues("inhibitPolicyMapping"))),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{requireExplicitPolicy:"requireExplicitPolicy",inhibitPolicyMapping:"inhibitPolicyMapping"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PolicyConstraints");if("requireExplicitPolicy"in r.result){var n=r.result.requireExplicitPolicy;n.idBlock.tagClass=1,n.idBlock.tagNumber=2;var a=bt(n.toBER(!1));this.requireExplicitPolicy=a.result.valueBlock.valueDec}if("inhibitPolicyMapping"in r.result){var i=r.result.inhibitPolicyMapping;i.idBlock.tagClass=1,i.idBlock.tagNumber=2;var s=bt(i.toBER(!1));this.inhibitPolicyMapping=s.result.valueBlock.valueDec}}},{key:"toSchema",value:function(){var e=[];if("requireExplicitPolicy"in this){var t=new He({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if("inhibitPolicyMapping"in this){var r=new He({value:this.inhibitPolicyMapping});r.idBlock.tagClass=3,r.idBlock.tagNumber=1,e.push(r)}return new Oe({value:e})}},{key:"toJSON",value:function(){var e={};return"requireExplicitPolicy"in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),"inhibitPolicyMapping"in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}],[{key:"defaultValues",value:function(e){switch(e){case"requireExplicitPolicy":case"inhibitPolicyMapping":return 0;default:throw new Error("Invalid member name for PolicyConstraints class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new Se({name:e.requireExplicitPolicy||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Se({name:e.inhibitPolicyMapping||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}}]),e}(),Cr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.keyPurposes=Ct(t,"keyPurposes",e.defaultValues("keyPurposes")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{keyPurposes:"keyPurposes"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for ExtKeyUsage");this.keyPurposes=Array.from(r.result.keyPurposes,function(e){return e.valueBlock.toString()})}},{key:"toSchema",value:function(){return new Oe({value:Array.from(this.keyPurposes,function(e){return new Xe({value:e})})})}},{key:"toJSON",value:function(){return{keyPurposes:Array.from(this.keyPurposes)}}}],[{key:"defaultValues",value:function(e){switch(e){case"keyPurposes":return[];default:throw new Error("Invalid member name for ExtKeyUsage class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new dt({name:e.keyPurposes||"",value:new Xe})]})}}]),e}(),wr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.accessDescriptions=Ct(t,"accessDescriptions",e.defaultValues("accessDescriptions")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{accessDescriptions:"accessDescriptions"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for InfoAccess");this.accessDescriptions=Array.from(r.result.accessDescriptions,function(e){return new rr({schema:e})})}},{key:"toSchema",value:function(){return new Oe({value:Array.from(this.accessDescriptions,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{accessDescriptions:Array.from(this.accessDescriptions,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"accessDescriptions":return[];default:throw new Error("Invalid member name for InfoAccess class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new dt({name:e.accessDescriptions||"",value:rr.schema()})]})}}]),e}(),Nr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.extnID=Ct(t,"extnID",e.defaultValues("extnID")),this.critical=Ct(t,"critical",e.defaultValues("critical")),this.extnValue="extnValue"in t?new De({valueHex:t.extnValue}):e.defaultValues("extnValue"),"parsedValue"in t&&(this.parsedValue=Ct(t,"parsedValue",e.defaultValues("parsedValue"))),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{extnID:"extnID",critical:"critical",extnValue:"extnValue"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for EXTENSION");if(this.extnID=r.result.extnID.valueBlock.toString(),"critical"in r.result&&(this.critical=r.result.critical.valueBlock.value),this.extnValue=r.result.extnValue,-1!==(r=bt(this.extnValue.valueBlock.valueHex)).offset)switch(this.extnID){case"2.5.29.9":this.parsedValue=new ir({schema:r.result});break;case"2.5.29.14":case"2.5.29.15":this.parsedValue=r.result;break;case"2.5.29.16":this.parsedValue=new sr({schema:r.result});break;case"2.5.29.17":case"2.5.29.18":this.parsedValue=new nr({schema:r.result});break;case"2.5.29.19":this.parsedValue=new or({schema:r.result});break;case"2.5.29.20":case"2.5.29.27":case"2.5.29.21":case"2.5.29.24":this.parsedValue=r.result;break;case"2.5.29.28":this.parsedValue=new lr({schema:r.result});break;case"2.5.29.29":this.parsedValue=new ur({schema:r.result});break;case"2.5.29.30":this.parsedValue=new hr({schema:r.result});break;case"2.5.29.31":case"2.5.29.46":this.parsedValue=new fr({schema:r.result});break;case"2.5.29.32":this.parsedValue=new dr({schema:r.result});break;case"2.5.29.33":this.parsedValue=new gr({schema:r.result});break;case"2.5.29.35":this.parsedValue=new br({schema:r.result});break;case"2.5.29.36":this.parsedValue=new kr({schema:r.result});break;case"2.5.29.37":this.parsedValue=new Cr({schema:r.result});break;case"2.5.29.54":this.parsedValue=r.result;break;case"1.3.6.1.5.5.7.1.1":case"1.3.6.1.5.5.7.1.11":this.parsedValue=new wr({schema:r.result})}}},{key:"toSchema",value:function(){var t=[];return t.push(new Xe({value:this.extnID})),this.critical!==e.defaultValues("critical")&&t.push(new Re({value:this.critical})),t.push(this.extnValue),new Oe({value:t})}},{key:"toJSON",value:function(){var t={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==e.defaultValues("critical")&&(t.critical=this.critical),"parsedValue"in this&&(t.parsedValue=this.parsedValue.toJSON()),t}}],[{key:"defaultValues",value:function(e){switch(e){case"extnID":return"";case"critical":return!1;case"extnValue":return new De;case"parsedValue":return{};default:throw new Error("Invalid member name for Extension class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[new Xe({name:e.extnID||""}),new Re({name:e.critical||"",optional:!0}),new De({name:e.extnValue||""})]})}}]),e}(),Sr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.extensions=Ct(t,"extensions",e.defaultValues("extensions")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{extensions:"extensions"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for EXTENSIONS");this.extensions=Array.from(r.result.extensions,function(e){return new Nr({schema:e})})}},{key:"toSchema",value:function(){return new Oe({value:Array.from(this.extensions,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{extensions:Array.from(this.extensions,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"extensions":return[];default:throw new Error("Invalid member name for Extensions class: "+e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ct(e,"names",{});return new Oe({optional:t,name:r.blockName||"",value:[new dt({name:r.extensions||"",value:Nr.schema(r.extension||{})})]})}}]),e}();var Ar,_r,Pr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.tbs=Ct(t,"tbs",e.defaultValues("tbs")),this.version=Ct(t,"version",e.defaultValues("version")),this.serialNumber=Ct(t,"serialNumber",e.defaultValues("serialNumber")),this.signature=Ct(t,"signature",e.defaultValues("signature")),this.issuer=Ct(t,"issuer",e.defaultValues("issuer")),this.notBefore=Ct(t,"notBefore",e.defaultValues("notBefore")),this.notAfter=Ct(t,"notAfter",e.defaultValues("notAfter")),this.subject=Ct(t,"subject",e.defaultValues("subject")),this.subjectPublicKeyInfo=Ct(t,"subjectPublicKeyInfo",e.defaultValues("subjectPublicKeyInfo")),"issuerUniqueID"in t&&(this.issuerUniqueID=Ct(t,"issuerUniqueID",e.defaultValues("issuerUniqueID"))),"subjectUniqueID"in t&&(this.subjectUniqueID=Ct(t,"subjectUniqueID",e.defaultValues("subjectUniqueID"))),"extensions"in t&&(this.extensions=Ct(t,"extensions",e.defaultValues("extensions"))),this.signatureAlgorithm=Ct(t,"signatureAlgorithm",e.defaultValues("signatureAlgorithm")),this.signatureValue=Ct(t,"signatureValue",e.defaultValues("signatureValue")),"schema"in t&&this.fromSchema(t.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=kt(t,t,e.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:"tbsCertificate.extensions"}}}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CERT");this.tbs=r.result.tbsCertificate.valueBeforeDecode,"tbsCertificate.version"in r.result&&(this.version=r.result["tbsCertificate.version"].valueBlock.valueDec),this.serialNumber=r.result["tbsCertificate.serialNumber"],this.signature=new Bt({schema:r.result["tbsCertificate.signature"]}),this.issuer=new er({schema:r.result["tbsCertificate.issuer"]}),this.notBefore=new ar({schema:r.result["tbsCertificate.notBefore"]}),this.notAfter=new ar({schema:r.result["tbsCertificate.notAfter"]}),this.subject=new er({schema:r.result["tbsCertificate.subject"]}),this.subjectPublicKeyInfo=new Dt({schema:r.result["tbsCertificate.subjectPublicKeyInfo"]}),"tbsCertificate.issuerUniqueID"in r.result&&(this.issuerUniqueID=r.result["tbsCertificate.issuerUniqueID"].valueBlock.valueHex),"tbsCertificate.subjectUniqueID"in r.result&&(this.issuerUniqueID=r.result["tbsCertificate.subjectUniqueID"].valueBlock.valueHex),"tbsCertificate.extensions"in r.result&&(this.extensions=Array.from(r.result["tbsCertificate.extensions"],function(e){return new Nr({schema:e})})),this.signatureAlgorithm=new Bt({schema:r.result.signatureAlgorithm}),this.signatureValue=r.result.signatureValue}},{key:"encodeTBS",value:function(){var t=[];return"version"in this&&this.version!==e.defaultValues("version")&&t.push(new _e({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new He({value:this.version})]})),t.push(this.serialNumber),t.push(this.signature.toSchema()),t.push(this.issuer.toSchema()),t.push(new Oe({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),t.push(this.subject.toSchema()),t.push(this.subjectPublicKeyInfo.toSchema()),"issuerUniqueID"in this&&t.push(new Se({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),"subjectUniqueID"in this&&t.push(new Se({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),"subjectUniqueID"in this&&t.push(new Se({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[this.extensions.toSchema()]})),"extensions"in this&&t.push(new _e({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new Oe({value:Array.from(this.extensions,function(e){return e.toSchema()})})]})),new Oe({value:t})}},{key:"toSchema",value:function(){var t={};if(!1===(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){if(0===this.tbs.length)return e.schema().value[0];t=bt(this.tbs).result}else t=this.encodeTBS();return new Oe({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){var t={tbs:wt(this.tbs,0,this.tbs.byteLength),serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return"version"in this&&this.version!==e.defaultValues("version")&&(t.version=this.version),"issuerUniqueID"in this&&(t.issuerUniqueID=wt(this.issuerUniqueID,0,this.issuerUniqueID.byteLength)),"subjectUniqueID"in this&&(t.subjectUniqueID=wt(this.subjectUniqueID,0,this.subjectUniqueID.byteLength)),"extensions"in this&&(t.extensions=Array.from(this.extensions,function(e){return e.toJSON()})),t}},{key:"getPublicKey",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=Wt();if(void 0===t)return Promise.reject("Unable to create WebCrypto object");if(null===e){e={};var r=Zt(this.signatureAlgorithm);if(""===r)return Promise.reject("Unsupported signature algorithm: "+this.signatureAlgorithm.algorithmId);var n=Yt(this.subjectPublicKeyInfo.algorithm.algorithmId);if("name"in n==!1)return Promise.reject("Unsupported public key algorithm: "+this.subjectPublicKeyInfo.algorithm.algorithmId);if(e.algorithm=Qt(n.name,"importkey"),"hash"in e.algorithm.algorithm&&(e.algorithm.algorithm.hash.name=r),"ECDSA"===n.name){var a=!1;if("algorithmParams"in this.subjectPublicKeyInfo.algorithm==!0&&"idBlock"in this.subjectPublicKeyInfo.algorithm.algorithmParams&&1===this.subjectPublicKeyInfo.algorithm.algorithmParams.idBlock.tagClass&&6===this.subjectPublicKeyInfo.algorithm.algorithmParams.idBlock.tagNumber&&(a=!0),!1===a)return Promise.reject("Incorrect type for ECDSA public key parameters");var i=Yt(this.subjectPublicKeyInfo.algorithm.algorithmParams.valueBlock.toString());if("name"in i==!1)return Promise.reject("Unsupported named curve algorithm: "+this.subjectPublicKeyInfo.algorithm.algorithmParams.valueBlock.toString());e.algorithm.algorithm.namedCurve=i.name}}var s=this.subjectPublicKeyInfo.toSchema().toBER(!1),o=new Uint8Array(s);return t.importKey("spki",o,e.algorithm.algorithm,!0,e.algorithm.usages)}},{key:"getKeyHash",value:function(){var e=Wt();return void 0===e?Promise.reject("Unable to create WebCrypto object"):e.digest({name:"sha-1"},new Uint8Array(this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHex))}},{key:"sign",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"SHA-1";if(void 0===e)return Promise.reject("Need to provide a private key for signing");var n=Promise.resolve(),a=void 0,i=qt;return n=(n=(n=(n=(n=n.then(function(){return i.subtle.getSignatureParameters(e,r)})).then(function(e){a=e.parameters,t.signature=e.signatureAlgorithm,t.signatureAlgorithm=e.signatureAlgorithm})).then(function(){t.tbs=t.encodeTBS().toBER(!1)})).then(function(){return i.subtle.signWithPrivateKey(t.tbs,e,a)})).then(function(e){t.signatureValue=new Te({valueHex:e})})}},{key:"verify",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=Promise.resolve(),n={},a=this.signatureValue,i=this.tbs;if(null!==t?n=t.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(n=this.subjectPublicKeyInfo),n instanceof Dt==!1)return Promise.reject("Please provide issuer certificate as a parameter");var s=Wt();if(void 0===s)return Promise.reject("Unable to create WebCrypto object");var o=Zt(this.signatureAlgorithm);return""===o?Promise.reject("Unsupported signature algorithm: "+this.signatureAlgorithm.algorithmId):r=(r=r.then(function(){var t=void 0,r=Yt(t="1.2.840.113549.1.1.10"===e.signatureAlgorithm.algorithmId?e.signatureAlgorithm.algorithmId:n.algorithm.algorithmId);if("name"in r==!1)return Promise.reject("Unsupported public key algorithm: "+t);var a=Qt(r.name,"importkey");if("hash"in a.algorithm&&(a.algorithm.hash.name=o),"ECDSA"===r.name){var i=!1;if("algorithmParams"in n.algorithm==!0&&"idBlock"in n.algorithm.algorithmParams&&1===n.algorithm.algorithmParams.idBlock.tagClass&&6===n.algorithm.algorithmParams.idBlock.tagNumber&&(i=!0),!1===i)return Promise.reject("Incorrect type for ECDSA public key parameters");var l=Yt(n.algorithm.algorithmParams.valueBlock.toString());if("name"in l==!1)return Promise.reject("Unsupported named curve algorithm: "+n.algorithm.algorithmParams.valueBlock.toString());a.algorithm.namedCurve=l.name}var u=n.toSchema().toBER(!1),c=new Uint8Array(u);return s.importKey("spki",c,a.algorithm,!0,a.usages)})).then(function(t){var r=Qt(t.algorithm.name,"verify");"hash"in r.algorithm&&(r.algorithm.hash.name=o);var n=a.valueBlock.valueHex;"ECDSA"===t.algorithm.name&&(n=function(e){if(e instanceof Oe==0)return new ArrayBuffer(0);if(2!==e.valueBlock.value.length)return new ArrayBuffer(0);if(e.valueBlock.value[0]instanceof He==0)return new ArrayBuffer(0);if(e.valueBlock.value[1]instanceof He==0)return new ArrayBuffer(0);var t=e.valueBlock.value[0].convertFromDER(),r=e.valueBlock.value[1].convertFromDER();switch(!0){case t.valueBlock.valueHex.byteLength<r.valueBlock.valueHex.byteLength:if(r.valueBlock.valueHex.byteLength-t.valueBlock.valueHex.byteLength!=1)throw new Error("Incorrect DER integer decoding");var n=r.valueBlock.valueHex.byteLength,a=new Uint8Array(t.valueBlock.valueHex),i=new ArrayBuffer(n),s=new Uint8Array(i);return s.set(a,1),s[0]=0,Nt(i,r.valueBlock.valueHex);case t.valueBlock.valueHex.byteLength>r.valueBlock.valueHex.byteLength:if(t.valueBlock.valueHex.byteLength-r.valueBlock.valueHex.byteLength!=1)throw new Error("Incorrect DER integer decoding");var o=t.valueBlock.valueHex.byteLength,l=new Uint8Array(r.valueBlock.valueHex),u=new ArrayBuffer(o),c=new Uint8Array(u);return c.set(l,1),c[0]=0,Nt(t.valueBlock.valueHex,u);default:if(t.valueBlock.valueHex.byteLength%2){var h=t.valueBlock.valueHex.byteLength+1,m=new Uint8Array(t.valueBlock.valueHex),f=new ArrayBuffer(h),p=new Uint8Array(f);p.set(m,1),p[0]=0;var v=new Uint8Array(r.valueBlock.valueHex),d=new ArrayBuffer(h),y=new Uint8Array(d);return y.set(v,1),y[0]=0,Nt(f,d)}}return Nt(t.valueBlock.valueHex,r.valueBlock.valueHex)}(bt(n).result));if("RSA-PSS"===t.algorithm.name){var l=void 0;try{l=new Kt({schema:e.signatureAlgorithm.algorithmParams})}catch(e){return Promise.reject(e)}r.algorithm.saltLength="saltLength"in l?l.saltLength:20;var u="SHA-1";if("hashAlgorithm"in l){var c=Yt(l.hashAlgorithm.algorithmId);if("name"in c==!1)return Promise.reject("Unrecognized hash algorithm: "+l.hashAlgorithm.algorithmId);u=c.name}r.algorithm.hash.name=u}return s.verify(r.algorithm,t,new Uint8Array(n),new Uint8Array(i))})}}],[{key:"defaultValues",value:function(e){switch(e){case"tbs":return new ArrayBuffer(0);case"version":return 0;case"serialNumber":return new He;case"signature":return new Bt;case"issuer":return new er;case"notBefore":case"notAfter":return new ar;case"subject":return new er;case"subjectPublicKeyInfo":return new Dt;case"issuerUniqueID":case"subjectUniqueID":return new ArrayBuffer(0);case"extensions":return[];case"signatureAlgorithm":return new Bt;case"signatureValue":return new Te;default:throw new Error("Invalid member name for Certificate class: "+e)}}},{key:"schema",value:function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"",value:[function(){var e=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Oe({name:e.blockName||"tbsCertificate",value:[new _e({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new He({name:e.tbsCertificateVersion||"tbsCertificate.version"})]}),new He({name:e.tbsCertificateSerialNumber||"tbsCertificate.serialNumber"}),Bt.schema(e.signature||{names:{blockName:"tbsCertificate.signature"}}),er.schema(e.issuer||{names:{blockName:"tbsCertificate.issuer"}}),new Oe({name:e.tbsCertificateValidity||"tbsCertificate.validity",value:[ar.schema(e.notBefore||{names:{utcTimeName:"tbsCertificate.notBefore",generalTimeName:"tbsCertificate.notBefore"}}),ar.schema(e.notAfter||{names:{utcTimeName:"tbsCertificate.notAfter",generalTimeName:"tbsCertificate.notAfter"}})]}),er.schema(e.subject||{names:{blockName:"tbsCertificate.subject"}}),Dt.schema(e.subjectPublicKeyInfo||{names:{blockName:"tbsCertificate.subjectPublicKeyInfo"}}),new Se({name:e.tbsCertificateIssuerUniqueID||"tbsCertificate.issuerUniqueID",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Se({name:e.tbsCertificateSubjectUniqueID||"tbsCertificate.subjectUniqueID",optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new _e({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[Sr.schema(e.extensions||{names:{blockName:"tbsCertificate.extensions"}})]})]})}(e.tbsCertificate),Bt.schema(e.signatureAlgorithm||{names:{blockName:"signatureAlgorithm"}}),new Te({name:e.signatureValue||"signatureValue"})]})}}]),e}(),Ir=null,Er=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"setEngine",value:function(e,t){Ir={getRandomValues:t.getRandomValues.bind(t),subtle:t.subtle,name:e}}},{key:"isNodePlugin",value:function(){return"undefined"==typeof self&&"undefined"==typeof window}},{key:"crypto",get:function(){if(!Ir)throw new b(y.CRYPTOGRAPHIC_NO_MODULE);return Ir}}]),e}();Er.isNodePlugin()||Er.setEngine("W3 WebCrypto module",self.crypto),(_r=Ar||(Ar={}))[_r.BeforeDocElement=0]="BeforeDocElement",_r[_r.InsideDocElement=1]="InsideDocElement",_r[_r.AfterDocElement=2]="AfterDocElement";var Rr=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T;_classCallCheck(this,e),this.propagatedNamespaces=new T,this.result=[],this.visibleNamespaces=new T,this.inclusiveNamespacesPrefixList=[],this.state=Ar.BeforeDocElement,this.withComments=t,this.exclusive=r,this.propagatedNamespaces=n}return _createClass(e,[{key:"Canonicalize",value:function(e){if(!e)throw new b(y.CRYPTOGRAPHIC,"Parameter 1 is not Node");var t=void 0;return e.nodeType===C.Document?(this.document=e,t=this.document.documentElement):(this.document=e.ownerDocument,t=e),this.WriteNode(t),this.result.join("")}},{key:"WriteNode",value:function(e){switch(e.nodeType){case C.Document:case C.DocumentFragment:this.WriteDocumentNode(e);break;case C.Element:this.WriteElementNode(e);break;case C.CDATA:case C.SignificantWhitespace:case C.Text:this.WriteTextNode(e);break;case C.Whitespace:this.state===Ar.InsideDocElement&&this.WriteTextNode(e);break;case C.Comment:this.WriteCommentNode(e);break;case C.ProcessingInstruction:this.WriteProcessingInstructionNode(e);break;case C.EntityReference:for(var t=0;t<e.childNodes.length;t++)this.WriteNode(e.childNodes[t]);break;case C.Attribute:case C.EndElement:case C.EndEntity:throw new b(y.CRYPTOGRAPHIC,"Attribute node is impossible here");case C.DocumentType:case C.Entity:case C.Notation:case C.XmlDeclaration:}}},{key:"WriteDocumentNode",value:function(e){this.state=Ar.BeforeDocElement;for(var t=e.firstChild;null!=t;t=t.nextSibling)this.WriteNode(t)}},{key:"WriteCommentNode",value:function(e){this.withComments&&(this.state===Ar.AfterDocElement?this.result.push(String.fromCharCode(10)+"\x3c!--"):this.result.push("\x3c!--"),this.result.push(this.NormalizeString(e.nodeValue,C.Comment)),this.state===Ar.BeforeDocElement?this.result.push("--\x3e"+String.fromCharCode(10)):this.result.push("--\x3e"))}},{key:"WriteTextNode",value:function(e){this.result.push(this.NormalizeString(e.nodeValue,e.nodeType))}},{key:"WriteProcessingInstructionNode",value:function(e){this.state===Ar.AfterDocElement?this.result.push("\n<?"):this.result.push("<?"),this.result.push(e.nodeName),e.nodeValue&&(this.result.push(" "),this.result.push(this.NormalizeString(e.nodeValue,C.ProcessingInstruction))),this.state===Ar.BeforeDocElement?this.result.push("?>\n"):this.result.push("?>")}},{key:"WriteElementNode",value:function(e){this.state===Ar.BeforeDocElement&&(this.state=Ar.InsideDocElement),this.result.push("<"),this.result.push(e.nodeName);var t=this.WriteNamespacesAxis(e);this.WriteAttributesAxis(e),this.result.push(">");for(var r=e.firstChild;null!=r;r=r.nextSibling)this.WriteNode(r);for(this.result.push("</"),this.result.push(e.nodeName),this.result.push(">"),this.state===Ar.BeforeDocElement&&(this.state=Ar.AfterDocElement);t--;)this.visibleNamespaces.Pop()}},{key:"WriteNamespacesAxis",value:function(e){for(var t=this,r=[],n=0,a=0;a<e.attributes.length;a++){var i=e.attributes[a];if(Ur(i)){if("xmlns"===i.localName&&!i.prefix&&!i.nodeValue){var s={prefix:i.prefix,namespace:i.nodeValue};r.push(s),this.visibleNamespaces.Add(s),n++}var o,l=null;(o=/xmlns:([\w\.]+)/.exec(i.nodeName))&&(l=o[1]);var u=!0;if(this.exclusive&&!this.IsNamespaceInclusive(e,l)){var c=xr(e,l);if(c>1)u=!1;else if(0===c)continue}if(!this.IsNamespaceRendered(l,i.nodeValue)&&u){var h={prefix:l,namespace:i.nodeValue};r.push(h),this.visibleNamespaces.Add(h),n++}}else if(i.prefix&&!this.IsNamespaceRendered(i.prefix,i.namespaceURI)){var m={prefix:i.prefix,namespace:i.namespaceURI};r.push(m),this.visibleNamespaces.Add(m),n++}}if(!this.IsNamespaceRendered(e.prefix,e.namespaceURI)&&"http://www.w3.org/2000/xmlns/"!==e.namespaceURI){var f={prefix:e.prefix,namespace:e.namespaceURI};r.push(f),this.visibleNamespaces.Add(f),n++}r.sort(Or);var p=null;return r.forEach(function(e){e.prefix!==p&&(p=e.prefix,t.result.push(" xmlns"),e.prefix&&t.result.push(":"+e.prefix),t.result.push('="'),t.result.push(e.namespace),t.result.push('"'))}),n}},{key:"WriteAttributesAxis",value:function(e){for(var t=this,r=[],n=0;n<e.attributes.length;n++){var a=e.attributes[n];Ur(a)||r.push(a)}r.sort(Br),r.forEach(function(e){null!=e&&(t.result.push(" "),t.result.push(e.nodeName),t.result.push('="'),t.result.push(t.NormalizeString(e.nodeValue,C.Attribute)),t.result.push('"'))})}},{key:"NormalizeString",value:function(e,t){var r=[];if(e)for(var n=0;n<e.length;n++){var a=e[n];"<"!==a||t!==C.Attribute&&!this.IsTextNode(t)?">"===a&&this.IsTextNode(t)?r.push("&gt;"):"&"!==a||t!==C.Attribute&&!this.IsTextNode(t)?'"'===a&&t===C.Attribute?r.push("&quot;"):"\t"===a&&t===C.Attribute?r.push("&#x9;"):"\n"===a&&t===C.Attribute?r.push("&#xA;"):"\r"===a?r.push("&#xD;"):r.push(a):r.push("&amp;"):r.push("&lt;")}return r.join("")}},{key:"IsTextNode",value:function(e){switch(e){case C.Text:case C.CDATA:case C.SignificantWhitespace:case C.Whitespace:return!0}return!1}},{key:"IsNamespaceInclusive",value:function(e,t){var r=t||null;return e.prefix!==r&&-1!==this.inclusiveNamespacesPrefixList.indexOf(r||"")}},{key:"IsNamespaceRendered",value:function(e,t){if(t=t||"",!(e=e||"")&&!t)return!0;if("xml"===e&&"http://www.w3.org/XML/1998/namespace"===t)return!0;var r=this.visibleNamespaces.GetPrefix(e);return!!r&&r.namespace===t}},{key:"InclusiveNamespacesPrefixList",get:function(){return this.inclusiveNamespacesPrefixList.join(" ")},set:function(e){this.inclusiveNamespacesPrefixList=e.split(" ")}}]),e}();function Or(e,t){return e==t?0:e?t?e.prefix?t.prefix?e.prefix.localeCompare(t.prefix):1:-1:1:-1}function Br(e,t){if(!e.namespaceURI&&t.namespaceURI)return-1;if(!t.namespaceURI&&e.namespaceURI)return 1;var r=e.namespaceURI+e.localName,n=t.namespaceURI+t.localName;return r===n?0:r<n?-1:1}function xr(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t||null;if(e.prefix===n)return++r;if(e.attributes)for(var a=0;a<e.attributes.length;a++){if(!Ur(e.attributes[a])&&t&&e.attributes[a].prefix===t)return++r}for(var i=e.firstChild;i;i=i.nextSibling)if(i.nodeType===C.Element){var s=xr(i,t,r);if(i.nodeType===C.Element&&s)return++r+s}return r}function Ur(e){return!(null===e||e.nodeType!==C.Attribute||"xmlns"!==e.nodeName&&!/xmlns:/.test(e.nodeName))}var Dr={DefaultCanonMethod:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315",DefaultDigestMethod:"http://www.w3.org/2001/04/xmlenc#sha256",DefaultPrefix:"ds",ElementNames:{CanonicalizationMethod:"CanonicalizationMethod",DigestMethod:"DigestMethod",DigestValue:"DigestValue",DSAKeyValue:"DSAKeyValue",DomainParameters:"DomainParameters",EncryptedKey:"EncryptedKey",HMACOutputLength:"HMACOutputLength",RSAPSSParams:"RSAPSSParams",MaskGenerationFunction:"MaskGenerationFunction",SaltLength:"SaltLength",KeyInfo:"KeyInfo",KeyName:"KeyName",KeyValue:"KeyValue",Modulus:"Modulus",Exponent:"Exponent",Manifest:"Manifest",Object:"Object",Reference:"Reference",RetrievalMethod:"RetrievalMethod",RSAKeyValue:"RSAKeyValue",ECDSAKeyValue:"ECDSAKeyValue",NamedCurve:"NamedCurve",PublicKey:"PublicKey",Signature:"Signature",SignatureMethod:"SignatureMethod",SignatureValue:"SignatureValue",SignedInfo:"SignedInfo",Transform:"Transform",Transforms:"Transforms",X509Data:"X509Data",PGPData:"PGPData",SPKIData:"SPKIData",SPKIexp:"SPKIexp",MgmtData:"MgmtData",X509IssuerSerial:"X509IssuerSerial",X509IssuerName:"X509IssuerName",X509SerialNumber:"X509SerialNumber",X509SKI:"X509SKI",X509SubjectName:"X509SubjectName",X509Certificate:"X509Certificate",X509CRL:"X509CRL",XPath:"XPath",X:"X",Y:"Y"},AttributeNames:{Algorithm:"Algorithm",Encoding:"Encoding",Id:"Id",MimeType:"MimeType",Type:"Type",URI:"URI"},AlgorithmNamespaces:{XmlDsigBase64Transform:"http://www.w3.org/2000/09/xmldsig#base64",XmlDsigC14NTransform:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315",XmlDsigC14NWithCommentsTransform:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments",XmlDsigEnvelopedSignatureTransform:"http://www.w3.org/2000/09/xmldsig#enveloped-signature",XmlDsigXPathTransform:"http://www.w3.org/TR/1999/REC-xpath-19991116",XmlDsigXsltTransform:"http://www.w3.org/TR/1999/REC-xslt-19991116",XmlDsigExcC14NTransform:"http://www.w3.org/2001/10/xml-exc-c14n#",XmlDsigExcC14NWithCommentsTransform:"http://www.w3.org/2001/10/xml-exc-c14n#WithComments",XmlDecryptionTransform:"http://www.w3.org/2002/07/decrypt#XML",XmlLicenseTransform:"urn:mpeg:mpeg21:2003:01-REL-R-NS:licenseTransform"},Uri:{Manifest:"http://www.w3.org/2000/09/xmldsig#Manifest"},NamespaceURI:"http://www.w3.org/2000/09/xmldsig#",NamespaceURIMore:"http://www.w3.org/2007/05/xmldsig-more#",NamespaceURIPss:"http://www.example.org/xmldsig-pss/#"},Lr=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,D),t}();Lr=n([h({localName:"xmldsig",namespaceURI:Dr.NamespaceURI,prefix:Dr.DefaultPrefix})],Lr);var Tr=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,L),t}();Tr=n([h({localName:"xmldsig_collection",namespaceURI:Dr.NamespaceURI,prefix:Dr.DefaultPrefix})],Tr);var jr=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Lr),t}(),Hr=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"getAlgorithmName",value:function(){return this.namespaceURI}}]),e}(),Vr=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Hr),_createClass(t,[{key:"Digest",value:function(e){var t=this;return Promise.resolve().then(function(){var r=void 0;if("string"==typeof e)r=N.FromString(e,"utf8");else if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer)r=e;else{var n=(new XMLSerializer).serializeToString(e);r=N.FromString(n,"utf8")}return Er.crypto.subtle.digest(t.algorithm,r)}).then(function(e){return new Uint8Array(e)})}}]),t}(),Mr=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Hr),_createClass(t,[{key:"Sign",value:function(e,t,r){var n=N.FromString(e,"utf8");return Er.crypto.subtle.sign(r,t,n)}},{key:"Verify",value:function(e,t,r,n){var a=N.FromString(e,"utf8");return Er.crypto.subtle.verify(n||this.algorithm,t,r,a)}}]),t}(),Kr="SHA-1",Xr="SHA-256",Gr="SHA-384",Fr="SHA-512",Jr="http://www.w3.org/2000/09/xmldsig#sha1",qr="http://www.w3.org/2001/04/xmlenc#sha256",Wr="http://www.w3.org/2001/04/xmldsig-more#sha384",Qr="http://www.w3.org/2001/04/xmlenc#sha512",zr=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.algorithm={name:Kr},e.namespaceURI=Jr,e}return _inherits(t,Vr),t}(),Yr=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.algorithm={name:Xr},e.namespaceURI=qr,e}return _inherits(t,Vr),t}(),Zr=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.algorithm={name:Gr},e.namespaceURI=Wr,e}return _inherits(t,Vr),t}(),$r=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.algorithm={name:Fr},e.namespaceURI=Qr,e}return _inherits(t,Vr),t}(),en="ECDSA",tn="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha1",rn="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha256",nn="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha384",an="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha512",sn=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.algorithm={name:en,hash:{name:Kr}},e.namespaceURI=tn,e}return _inherits(t,Mr),t}(),on=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.algorithm={name:en,hash:{name:Xr}},e.namespaceURI=rn,e}return _inherits(t,Mr),t}(),ln=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.algorithm={name:en,hash:{name:Gr}},e.namespaceURI=nn,e}return _inherits(t,Mr),t}(),un=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.algorithm={name:en,hash:{name:Fr}},e.namespaceURI=an,e}return _inherits(t,Mr),t}(),cn="HMAC",hn="http://www.w3.org/2000/09/xmldsig#hmac-sha1",mn="http://www.w3.org/2001/04/xmldsig-more#hmac-sha256",fn="http://www.w3.org/2001/04/xmldsig-more#hmac-sha384",pn="http://www.w3.org/2001/04/xmldsig-more#hmac-sha512",vn=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.algorithm={name:cn,hash:{name:Kr}},e.namespaceURI=hn,e}return _inherits(t,Mr),t}(),dn=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.algorithm={name:cn,hash:{name:Xr}},e.namespaceURI=mn,e}return _inherits(t,Mr),t}(),yn=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.algorithm={name:cn,hash:{name:Gr}},e.namespaceURI=fn,e}return _inherits(t,Mr),t}(),gn=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.algorithm={name:cn,hash:{name:Fr}},e.namespaceURI=pn,e}return _inherits(t,Mr),t}(),bn="RSASSA-PKCS1-v1_5",kn="http://www.w3.org/2000/09/xmldsig#rsa-sha1",Cn="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256",wn="http://www.w3.org/2001/04/xmldsig-more#rsa-sha384",Nn="http://www.w3.org/2001/04/xmldsig-more#rsa-sha512",Sn=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.algorithm={name:bn,hash:{name:Kr}},e.namespaceURI=kn,e}return _inherits(t,Mr),t}(),An=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.algorithm={name:bn,hash:{name:Xr}},e.namespaceURI=Cn,e}return _inherits(t,Mr),t}(),_n=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.algorithm={name:bn,hash:{name:Gr}},e.namespaceURI=wn,e}return _inherits(t,Mr),t}(),Pn=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.algorithm={name:bn,hash:{name:Fr}},e.namespaceURI=Nn,e}return _inherits(t,Mr),t}(),In="RSA-PSS",En="http://www.w3.org/2007/05/xmldsig-more#rsa-pss",Rn=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.algorithm={name:In,hash:{name:Kr}},r.namespaceURI=En,e&&(r.algorithm.saltLength=e),r}return _inherits(t,Mr),t}(),On=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.algorithm.hash.name=Kr,r}return _inherits(t,Rn),t}(),Bn=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.algorithm.hash.name=Xr,r}return _inherits(t,Rn),t}(),xn=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.algorithm.hash.name=Gr,r}return _inherits(t,Rn),t}(),Un=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.algorithm.hash.name=Fr,r}return _inherits(t,Rn),t}(),Dn=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Lr),t}();n([f({localName:Dr.AttributeNames.Algorithm,required:!0,defaultValue:Dr.DefaultCanonMethod})],Dn.prototype,"Algorithm",void 0),Dn=n([h({localName:Dr.ElementNames.CanonicalizationMethod})],Dn);var Ln=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Lr),t}();n([f({localName:Dr.AttributeNames.Id,defaultValue:""})],Ln.prototype,"Id",void 0),n([f({localName:Dr.AttributeNames.MimeType,defaultValue:""})],Ln.prototype,"MimeType",void 0),n([f({localName:Dr.AttributeNames.Encoding,defaultValue:""})],Ln.prototype,"Encoding",void 0),Ln=n([h({localName:Dr.ElementNames.Object})],Ln);var Tn=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Tr),t}();Tn=n([h({localName:"xmldsig_objects",parser:Ln})],Tn);var jn=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Lr),t}();n([f({localName:Dr.AttributeNames.Algorithm,required:!0,defaultValue:Dr.DefaultDigestMethod})],jn.prototype,"Algorithm",void 0),jn=n([h({localName:Dr.ElementNames.DigestMethod})],jn);var Hn=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Tr),_createClass(t,[{key:"OnLoadXml",value:function(e){for(var t=this,r=function(r){var n=e.childNodes.item(r);if(n.nodeType!==C.Element)return"continue";var a=null;switch(n.localName){case Dr.ElementNames.KeyValue:a=fa;break;case Dr.ElementNames.X509Data:a=ba;break;case Dr.ElementNames.SPKIData:a=ka;break;case Dr.ElementNames.KeyName:case Dr.ElementNames.RetrievalMethod:case Dr.ElementNames.PGPData:case Dr.ElementNames.MgmtData:}if(a){var i=new a;if(i.LoadXml(n),i instanceof fa){var s=null;if([la,sa].some(function(e){try{for(var t=new e,r=0;r<n.childNodes.length;r++){var a=n.childNodes.item(r);if(a.nodeType===C.Element)return t.LoadXml(a),s=t,!0}}catch(e){}return!1}),!s)throw new b(y.CRYPTOGRAPHIC,"Unsupported KeyValue in use");i.Value=s}t.Add(i)}},n=0;n<e.childNodes.length;n++)r(n)}}]),t}();n([f({localName:Dr.AttributeNames.Id,defaultValue:""})],Hn.prototype,"Id",void 0),Hn=n([h({localName:Dr.ElementNames.KeyInfo})],Hn);var Vn=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.innerXml=null,e}return _inherits(t,Lr),_createClass(t,[{key:"GetOutput",value:function(){throw new b(y.METHOD_NOT_IMPLEMENTED)}},{key:"LoadInnerXml",value:function(e){if(!e)throw new b(y.PARAM_REQUIRED,"node");this.innerXml=e}},{key:"GetInnerXml",value:function(){return this.innerXml}}]),t}();n([f({localName:Dr.AttributeNames.Algorithm,defaultValue:""})],Vn.prototype,"Algorithm",void 0),n([m({localName:Dr.ElementNames.XPath,defaultValue:""})],Vn.prototype,"XPath",void 0),Vn=n([h({localName:Dr.ElementNames.Transform})],Vn);var Mn=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.Algorithm=Dr.AlgorithmNamespaces.XmlDsigBase64Transform,e}return _inherits(t,Vn),_createClass(t,[{key:"GetOutput",value:function(){if(!this.innerXml)throw new b(y.PARAM_REQUIRED,"innerXml");return N.FromString(this.innerXml.textContent||"","base64")}}]),t}(),Kn=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315",e.xmlCanonicalizer=new Rr(!1,!1),e}return _inherits(t,Vn),_createClass(t,[{key:"GetOutput",value:function(){if(!this.innerXml)throw new b(y.PARAM_REQUIRED,"innerXml");return this.xmlCanonicalizer.Canonicalize(this.innerXml)}}]),t}(),Xn=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments",e.xmlCanonicalizer=new Rr(!0,!1),e}return _inherits(t,Kn),t}(),Gn=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature",e}return _inherits(t,Vn),_createClass(t,[{key:"GetOutput",value:function(){if(!this.innerXml)throw new b(y.PARAM_REQUIRED,"innerXml");var e=I(this.innerXml,".//*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']")[0];return e&&e.parentNode.removeChild(e),this.innerXml}}]),t}(),Fn=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#",e.xmlCanonicalizer=new Rr(!1,!0),e}return _inherits(t,Vn),_createClass(t,[{key:"GetOutput",value:function(){if(!this.innerXml)throw new b(y.PARAM_REQUIRED,"innerXml");return this.xmlCanonicalizer.Canonicalize(this.innerXml)}},{key:"InclusiveNamespacesPrefixList",get:function(){return this.xmlCanonicalizer.InclusiveNamespacesPrefixList},set:function(e){this.xmlCanonicalizer.InclusiveNamespacesPrefixList=e}}]),t}(),Jn=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#WithComments",e.xmlCanonicalizer=new Rr(!0,!0),e}return _inherits(t,Fn),t}(),qn=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Tr),_createClass(t,[{key:"OnLoadXml",value:function(e){_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"OnLoadXml",this).call(this,e),this.items=this.GetIterator().map(function(e){switch(e.Algorithm){case Dr.AlgorithmNamespaces.XmlDsigEnvelopedSignatureTransform:return Wn(e,Gn);case Dr.AlgorithmNamespaces.XmlDsigC14NTransform:return Wn(e,Kn);case Dr.AlgorithmNamespaces.XmlDsigC14NWithCommentsTransform:return Wn(e,Xn);case Dr.AlgorithmNamespaces.XmlDsigExcC14NTransform:return Wn(e,Fn);case Dr.AlgorithmNamespaces.XmlDsigExcC14NWithCommentsTransform:return Wn(e,Jn);case Dr.AlgorithmNamespaces.XmlDsigBase64Transform:return Wn(e,Mn);default:throw new b(y.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM,e.Algorithm)}})}}]),t}();function Wn(e,t){var r=new t;return r.element=e.Element,r}qn=n([h({localName:Dr.ElementNames.Transforms,parser:Vn})],qn);var Qn=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e&&(r.Uri=e),r}return _inherits(t,Lr),t}();n([f({defaultValue:""})],Qn.prototype,"Id",void 0),n([f({localName:Dr.AttributeNames.URI,defaultValue:""})],Qn.prototype,"Uri",void 0),n([f({localName:Dr.AttributeNames.Type,defaultValue:""})],Qn.prototype,"Type",void 0),n([m({parser:qn})],Qn.prototype,"Transforms",void 0),n([m({required:!0,parser:jn})],Qn.prototype,"DigestMethod",void 0),n([m({required:!0,localName:Dr.ElementNames.DigestValue,namespaceURI:Dr.NamespaceURI,prefix:Dr.DefaultPrefix,converter:x})],Qn.prototype,"DigestValue",void 0),Qn=n([h({localName:Dr.ElementNames.Reference})],Qn);var zn=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Tr),t}();zn=n([h({localName:"References",parser:Qn})],zn);var Yn=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Tr),_createClass(t,[{key:"OnLoadXml",value:function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes.item(t);if(r.nodeType===C.Element&&r.nodeName!==Dr.ElementNames.HMACOutputLength){var n=void 0;switch(r.localName){case Dr.ElementNames.RSAPSSParams:n=ma}if(n){var a=new n;a.LoadXml(r),this.Add(a)}}}}}]),t}();Yn=n([h({localName:"Other"})],Yn);var Zn=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Lr),t}();n([f({localName:Dr.AttributeNames.Algorithm,required:!0,defaultValue:""})],Zn.prototype,"Algorithm",void 0),n([m({localName:Dr.ElementNames.HMACOutputLength,namespaceURI:Dr.NamespaceURI,prefix:Dr.DefaultPrefix,converter:U})],Zn.prototype,"HMACOutputLength",void 0),n([m({parser:Yn,noRoot:!0,minOccurs:0})],Zn.prototype,"Any",void 0),Zn=n([h({localName:Dr.ElementNames.SignatureMethod})],Zn);var $n=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Lr),t}();n([f({localName:Dr.AttributeNames.Id,defaultValue:""})],$n.prototype,"Id",void 0),n([m({parser:Dn,required:!0})],$n.prototype,"CanonicalizationMethod",void 0),n([m({parser:Zn,required:!0})],$n.prototype,"SignatureMethod",void 0),n([m({parser:zn,minOccurs:1,noRoot:!0})],$n.prototype,"References",void 0),$n=n([h({localName:Dr.ElementNames.SignedInfo})],$n);var ea=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Lr),t}();n([f({localName:Dr.AttributeNames.Id,defaultValue:""})],ea.prototype,"Id",void 0),n([m({parser:$n,required:!0})],ea.prototype,"SignedInfo",void 0),n([m({localName:Dr.ElementNames.SignatureValue,namespaceURI:Dr.NamespaceURI,prefix:Dr.DefaultPrefix,required:!0,converter:x,defaultValue:null})],ea.prototype,"SignatureValue",void 0),n([m({parser:Hn})],ea.prototype,"KeyInfo",void 0),n([m({parser:Tn,noRoot:!0})],ea.prototype,"ObjectList",void 0),ea=n([h({localName:Dr.ElementNames.Signature})],ea);var ta="http://www.w3.org/2001/04/xmldsig-more#",ra="ecdsa",na=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,D),t}();n([m({localName:Dr.ElementNames.X,namespaceURI:ta,prefix:ra,required:!0,converter:x})],na.prototype,"X",void 0),n([m({localName:Dr.ElementNames.Y,namespaceURI:ta,prefix:ra,required:!0,converter:x})],na.prototype,"Y",void 0),na=n([h({localName:Dr.ElementNames.PublicKey,namespaceURI:ta,prefix:ra})],na);var aa=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,D),t}();n([f({localName:Dr.AttributeNames.URI,required:!0})],aa.prototype,"Uri",void 0),aa=n([h({localName:Dr.ElementNames.NamedCurve,namespaceURI:ta,prefix:ra})],aa);var ia=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,D),t}();n([m({parser:aa})],ia.prototype,"NamedCurve",void 0),ia=n([h({localName:Dr.ElementNames.DomainParameters,namespaceURI:ta,prefix:ra})],ia);var sa=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.name=Dr.ElementNames.ECDSAKeyValue,e.key=null,e.jwk=null,e.keyUsage=null,e}return _inherits(t,jr),_createClass(t,[{key:"importKey",value:function(e){var t=this;return new Promise(function(r,n){if("ECDSA"!==e.algorithm.name.toUpperCase())throw new b(y.ALGORITHM_WRONG_NAME,e.algorithm.name);t.key=e,Er.crypto.subtle.exportKey("jwk",e).then(function(r){return t.jwk=r,t.PublicKey=new na,t.PublicKey.X=N.FromString(r.x,"base64url"),t.PublicKey.Y=N.FromString(r.y,"base64url"),t.DomainParameters||(t.DomainParameters=new ia),t.DomainParameters.NamedCurve||(t.DomainParameters.NamedCurve=new aa),t.DomainParameters.NamedCurve.Uri=oa(r.crv),t.keyUsage=e.usages,Promise.resolve(t)}).then(r,n)})}},{key:"exportKey",value:function(e){var t=this;return Promise.resolve().then(function(){if(t.key)return t.key;var e=N.ToBase64Url(t.PublicKey.X),r=N.ToBase64Url(t.PublicKey.Y),n=function(e){switch(e){case"urn:oid:1.2.840.10045.3.1.7":return"P-256";case"urn:oid:1.3.132.0.34":return"P-384";case"urn:oid:1.3.132.0.35":return"P-521"}throw new b(y.CRYPTOGRAPHIC,"Unknown NamedCurve OID")}(t.DomainParameters.NamedCurve.Uri),a={kty:"EC",crv:n,x:e,y:r,ext:!0};return t.keyUsage=["verify"],Er.crypto.subtle.importKey("jwk",a,{name:"ECDSA",namedCurve:n},!0,t.keyUsage)}).then(function(e){return t.key=e,t.key})}},{key:"NamedCurve",get:function(){return oa(this.DomainParameters.NamedCurve.Uri)}}]),t}();function oa(e){switch(e){case"P-256":return"urn:oid:1.2.840.10045.3.1.7";case"P-384":return"urn:oid:1.3.132.0.34";case"P-521":return"urn:oid:1.3.132.0.35"}throw new b(y.CRYPTOGRAPHIC,"Unknown NamedCurve")}n([m({parser:ia})],sa.prototype,"DomainParameters",void 0),n([m({parser:na,required:!0})],sa.prototype,"PublicKey",void 0),sa=n([h({localName:Dr.ElementNames.ECDSAKeyValue,namespaceURI:ta,prefix:ra})],sa);var la=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.key=null,e.jwk=null,e.keyUsage=[],e}return _inherits(t,jr),_createClass(t,[{key:"importKey",value:function(e){var t=this;return new Promise(function(r,n){var a=e.algorithm.name.toUpperCase();if(a!==bn.toUpperCase()&&a!==In.toUpperCase())throw new b(y.ALGORITHM_WRONG_NAME,e.algorithm.name);t.key=e,Er.crypto.subtle.exportKey("jwk",e).then(function(r){return t.jwk=r,t.Modulus=N.FromBase64Url(r.n),t.Exponent=N.FromBase64Url(r.e),t.keyUsage=e.usages,Promise.resolve(t)}).then(r,n)})}},{key:"exportKey",value:function(e){var t=this;return new Promise(function(r,n){if(t.key)return r(t.key);if(!t.Modulus)throw new b(y.CRYPTOGRAPHIC,"RsaKeyValue has no Modulus");var a=N.ToBase64Url(t.Modulus);if(!t.Exponent)throw new b(y.CRYPTOGRAPHIC,"RsaKeyValue has no Exponent");var i=N.ToBase64Url(t.Exponent),s=void 0;switch(e.name.toUpperCase()){case bn.toUpperCase():s="R";break;case In.toUpperCase():s="P";break;default:throw new b(y.ALGORITHM_NOT_SUPPORTED,e.name)}switch(e.hash.name.toUpperCase()){case Kr:s+="S1";break;case Xr:s+="S256";break;case Gr:s+="S384";break;case Fr:s+="S512"}var o={kty:"RSA",alg:s,n:a,e:i,ext:!0};Er.crypto.subtle.importKey("jwk",o,e,!0,t.keyUsage).then(r,n)})}},{key:"LoadXml",value:function(e){_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"LoadXml",this).call(this,e),this.keyUsage=["verify"]}}]),t}();n([m({localName:Dr.ElementNames.Modulus,prefix:Dr.DefaultPrefix,namespaceURI:Dr.NamespaceURI,required:!0,converter:x})],la.prototype,"Modulus",void 0),n([m({localName:Dr.ElementNames.Exponent,prefix:Dr.DefaultPrefix,namespaceURI:Dr.NamespaceURI,required:!0,converter:x})],la.prototype,"Exponent",void 0),la=n([h({localName:Dr.ElementNames.RSAKeyValue})],la);var ua="http://www.w3.org/2007/05/xmldsig-more#",ca=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,D),t}();n([m({parser:jn})],ca.prototype,"DigestMethod",void 0),n([f({localName:Dr.AttributeNames.Algorithm,defaultValue:"http://www.w3.org/2007/05/xmldsig-more#MGF1"})],ca.prototype,"Algorithm",void 0),ca=n([h({localName:Dr.ElementNames.MaskGenerationFunction,prefix:"pss",namespaceURI:ua})],ca);var ha,ma=ha=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e&&r.FromAlgorithm(e),r}return _inherits(t,D),_createClass(t,[{key:"FromAlgorithm",value:function(e){this.DigestMethod=new jn;var t=Na.GetHashAlgorithm(e.hash);this.DigestMethod.Algorithm=t.namespaceURI,e.saltLength&&(this.SaltLength=e.saltLength)}}],[{key:"FromAlgorithm",value:function(e){return new ha(e)}}]),t}();n([m({parser:jn})],ma.prototype,"DigestMethod",void 0),n([m({parser:ca})],ma.prototype,"MGF",void 0),n([m({converter:U,prefix:"pss",namespaceURI:ua})],ma.prototype,"SaltLength",void 0),n([m({converter:U})],ma.prototype,"TrailerField",void 0),ma=ha=n([h({localName:Dr.ElementNames.RSAPSSParams,prefix:"pss",namespaceURI:ua})],ma);var fa=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e&&(r.Value=e),r}return _inherits(t,jr),_createClass(t,[{key:"importKey",value:function(e){var t=this;return Promise.resolve().then(function(){switch(e.algorithm.name.toUpperCase()){case In.toUpperCase():case bn.toUpperCase():return t.Value=new la,t.Value.importKey(e);case en.toUpperCase():return t.Value=new sa,t.Value.importKey(e);default:throw new b(y.ALGORITHM_NOT_SUPPORTED,e.algorithm.name)}}).then(function(){return t})}},{key:"exportKey",value:function(e){var t=this;return Promise.resolve().then(function(){if(!t.Value)throw new b(y.NULL_REFERENCE);return t.Value.exportKey(e)})}},{key:"OnGetXml",value:function(e){if(!this.Value)throw new b(y.CRYPTOGRAPHIC,"KeyValue has empty value");var t=this.Value.GetXml();t&&e.appendChild(t)}},{key:"Value",set:function(e){this.element=null,this.value=e},get:function(){return this.value}}]),t}();fa=n([h({localName:Dr.ElementNames.KeyValue})],fa);var pa,va,da={"2.5.4.3":{short:"CN",long:"CommonName"},"2.5.4.6":{short:"C",long:"Country"},"2.5.4.5":{long:"DeviceSerialNumber"},"0.9.2342.19200300.100.1.25":{short:"DC",long:"DomainComponent"},"1.2.840.113549.1.9.1":{short:"E",long:"EMail"},"2.5.4.42":{short:"G",long:"GivenName"},"2.5.4.43":{short:"I",long:"Initials"},"2.5.4.7":{short:"L",long:"Locality"},"2.5.4.10":{short:"O",long:"Organization"},"2.5.4.11":{short:"OU",long:"OrganizationUnit"},"2.5.4.8":{short:"ST",long:"State"},"2.5.4.9":{short:"Street",long:"StreetAddress"},"2.5.4.4":{short:"SN",long:"SurName"},"2.5.4.12":{short:"T",long:"Title"},"1.2.840.113549.1.9.8":{long:"UnstructuredAddress"},"1.2.840.113549.1.9.2":{long:"UnstructuredName"}},ya=function(){function e(t){if(_classCallCheck(this,e),this.publicKey=null,t){var r=new Uint8Array(t);this.LoadRaw(r),this.raw=r}}return _createClass(e,[{key:"Thumbprint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SHA-1";return Er.crypto.subtle.digest(e,this.raw)}},{key:"GetRaw",value:function(){return this.raw}},{key:"exportKey",value:function(e){var t=this;return Promise.resolve().then(function(){var r,n,a;Wt()||(r=Er.crypto.name,n=new Jt({name:Er.crypto.name,crypto:Er.crypto}),a=Er.crypto.subtle,qt={name:r,crypto:n,subtle:a});var i={algorithm:e,usages:["verify"]};return i.algorithm.name.toUpperCase()===en&&(i.algorithm.namedCurve=t.simpl.subjectPublicKeyInfo.toJSON().crv),t.simpl.getPublicKey({algorithm:i}).then(function(e){return t.publicKey=e,e})})}},{key:"NameToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",r=[];return e.typesAndValues.forEach(function(e){var t=e.type,n=da[t.toString()],a=n?n.short:null;r.push((a||t)+"="+e.value.valueBlock.value)}),r.join(t+" ")}},{key:"LoadRaw",value:function(e){this.raw=new Uint8Array(e);var t=bt(this.raw.buffer);this.simpl=new Pr({schema:t.result})}},{key:"SerialNumber",get:function(){return this.simpl.serialNumber.valueBlock.toString()}},{key:"Issuer",get:function(){return this.NameToString(this.simpl.issuer)}},{key:"Subject",get:function(){return this.NameToString(this.simpl.subject)}},{key:"PublicKey",get:function(){return this.publicKey}}]),e}(),ga=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Lr),t}();n([m({localName:Dr.ElementNames.X509IssuerName,namespaceURI:Dr.NamespaceURI,prefix:Dr.DefaultPrefix,required:!0})],ga.prototype,"X509IssuerName",void 0),n([m({localName:Dr.ElementNames.X509SerialNumber,namespaceURI:Dr.NamespaceURI,prefix:Dr.DefaultPrefix,required:!0})],ga.prototype,"X509SerialNumber",void 0),ga=n([h({localName:Dr.ElementNames.X509IssuerSerial})],ga),(va=pa||(pa={}))[va.None=0]="None",va[va.EndCertOnly=1]="EndCertOnly",va[va.ExcludeRoot=2]="ExcludeRoot",va[va.WholeChain=3]="WholeChain";var ba=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pa.None;_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(n.x509crl=null,n.SubjectKeyIdList=[],n.key=null,e)if(e instanceof Uint8Array)n.AddCertificate(new ya(e));else if(e instanceof ya)switch(r){case pa.None:case pa.EndCertOnly:n.AddCertificate(e);break;case pa.ExcludeRoot:n.AddCertificatesChainFrom(e,!1);break;case pa.WholeChain:n.AddCertificatesChainFrom(e,!0)}return n}return _inherits(t,jr),_createClass(t,[{key:"importKey",value:function(e){return Promise.reject(new b(y.METHOD_NOT_SUPPORTED))}},{key:"exportKey",value:function(e){var t=this;return Promise.resolve().then(function(){if(t.Certificates.length)return t.Certificates[0].exportKey(e);throw new b(y.NULL_REFERENCE)}).then(function(e){return t.key=e,e})}},{key:"AddCertificate",value:function(e){if(!e)throw new b(y.PARAM_REQUIRED,"certificate");this.X509CertificateList||(this.X509CertificateList=[]),this.X509CertificateList.push(e)}},{key:"AddIssuerSerial",value:function(e,t){if(null==e)throw new b(y.PARAM_REQUIRED,"issuerName");null==this.IssuerSerialList&&(this.IssuerSerialList=[]);var r={issuerName:e,serialNumber:t};this.IssuerSerialList.push(r)}},{key:"AddSubjectKeyId",value:function(e){if(this.SubjectKeyIdList&&(this.SubjectKeyIdList=[]),"string"==typeof e){if(null!=e){var t;t=N.FromBase64(e),this.SubjectKeyIdList.push(t)}}else this.SubjectKeyIdList.push(e)}},{key:"AddSubjectName",value:function(e){null==this.SubjectNameList&&(this.SubjectNameList=[]),this.SubjectNameList.push(e)}},{key:"GetXml",value:function(){var e=this.CreateDocument(),t=this.CreateElement(e),r=this.GetPrefix();if(null!=this.IssuerSerialList&&this.IssuerSerialList.length>0&&this.IssuerSerialList.forEach(function(n){var a=e.createElementNS(Dr.NamespaceURI,r+Dr.ElementNames.X509IssuerSerial),i=e.createElementNS(Dr.NamespaceURI,r+Dr.ElementNames.X509IssuerName);i.textContent=n.issuerName,a.appendChild(i);var s=e.createElementNS(Dr.NamespaceURI,r+Dr.ElementNames.X509SerialNumber);s.textContent=n.serialNumber,a.appendChild(s),t.appendChild(a)}),null!=this.SubjectKeyIdList&&this.SubjectKeyIdList.length>0&&this.SubjectKeyIdList.forEach(function(n){var a=e.createElementNS(Dr.NamespaceURI,r+Dr.ElementNames.X509SKI);a.textContent=N.ToBase64(n),t.appendChild(a)}),null!=this.SubjectNameList&&this.SubjectNameList.length>0&&this.SubjectNameList.forEach(function(n){var a=e.createElementNS(Dr.NamespaceURI,r+Dr.ElementNames.X509SubjectName);a.textContent=n,t.appendChild(a)}),null!=this.X509CertificateList&&this.X509CertificateList.length>0&&this.X509CertificateList.forEach(function(n){var a=e.createElementNS(Dr.NamespaceURI,r+Dr.ElementNames.X509Certificate);a.textContent=N.ToBase64(n.GetRaw()),t.appendChild(a)}),null!=this.x509crl){var n=e.createElementNS(Dr.NamespaceURI,r+Dr.ElementNames.X509CRL);n.textContent=N.ToBase64(this.x509crl),t.appendChild(n)}return t}},{key:"LoadXml",value:function(e){var r=this;_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"LoadXml",this).call(this,e),this.IssuerSerialList&&(this.IssuerSerialList=[]),this.SubjectKeyIdList&&(this.SubjectKeyIdList=[]),this.SubjectNameList&&(this.SubjectNameList=[]),this.X509CertificateList&&(this.X509CertificateList=[]),this.x509crl=null;var n=this.GetChildren(Dr.ElementNames.X509IssuerSerial);n&&n.forEach(function(e){var t=Lr.GetChild(e,Dr.ElementNames.X509IssuerName,Dr.NamespaceURI,!0),n=Lr.GetChild(e,Dr.ElementNames.X509SerialNumber,Dr.NamespaceURI,!0);t&&t.textContent&&n&&n.textContent&&r.AddIssuerSerial(t.textContent,n.textContent)}),(n=this.GetChildren(Dr.ElementNames.X509SKI))&&n.forEach(function(e){if(e.textContent){var t=N.FromBase64(e.textContent);r.AddSubjectKeyId(t)}}),null!=(n=this.GetChildren(Dr.ElementNames.X509SubjectName))&&n.forEach(function(e){e.textContent&&r.AddSubjectName(e.textContent)}),(n=this.GetChildren(Dr.ElementNames.X509Certificate))&&n.forEach(function(e){if(e.textContent){var t=N.FromBase64(e.textContent);r.AddCertificate(new ya(t))}});var a=this.GetChild(Dr.ElementNames.X509CRL,!1);a&&a.textContent&&(this.x509crl=N.FromBase64(a.textContent))}},{key:"AddCertificatesChainFrom",value:function(e,t){throw new b(y.METHOD_NOT_IMPLEMENTED)}},{key:"Key",get:function(){return this.key}},{key:"Certificates",get:function(){return this.X509CertificateList}},{key:"CRL",get:function(){return this.x509crl},set:function(e){this.x509crl=e}},{key:"IssuerSerials",get:function(){return this.IssuerSerialList}},{key:"SubjectKeyIds",get:function(){return this.SubjectKeyIdList}},{key:"SubjectNames",get:function(){return this.SubjectNameList}}]),t}();ba=n([h({localName:Dr.ElementNames.X509Data})],ba);var ka=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,jr),_createClass(t,[{key:"importKey",value:function(e){var t=this;return Promise.resolve().then(function(){return Er.crypto.subtle.exportKey("spki",e)}).then(function(r){return t.SPKIexp=new Uint8Array(r),t.Key=e,t})}},{key:"exportKey",value:function(e){var t=this;return Promise.resolve().then(function(){return Er.crypto.subtle.importKey("spki",t.SPKIexp,e,!0,["verify"])}).then(function(e){return t.Key=e,e})}}]),t}();n([m({localName:Dr.ElementNames.SPKIexp,namespaceURI:Dr.NamespaceURI,prefix:Dr.DefaultPrefix,required:!0,converter:x})],ka.prototype,"SPKIexp",void 0),ka=n([h({localName:Dr.ElementNames.SPKIData})],ka);var Ca={};Ca[kn]=Sn,Ca[Cn]=An,Ca[wn]=_n,Ca[Nn]=Pn,Ca[tn]=sn,Ca[rn]=on,Ca[nn]=ln,Ca[an]=un,Ca[hn]=vn,Ca[mn]=dn,Ca[fn]=yn,Ca[pn]=gn;var wa={};wa[Jr]=zr,wa[qr]=Yr,wa[Wr]=Zr,wa[Qr]=$r;var Na=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"CreateFromName",value:function(e){var t=void 0;switch(e){case Dr.AlgorithmNamespaces.XmlDsigBase64Transform:t=new Mn;break;case Dr.AlgorithmNamespaces.XmlDsigC14NTransform:t=new Kn;break;case Dr.AlgorithmNamespaces.XmlDsigC14NWithCommentsTransform:t=new Xn;break;case Dr.AlgorithmNamespaces.XmlDsigEnvelopedSignatureTransform:t=new Gn;break;case Dr.AlgorithmNamespaces.XmlDsigXPathTransform:case Dr.AlgorithmNamespaces.XmlDsigXsltTransform:throw new b(y.ALGORITHM_NOT_SUPPORTED,e);case Dr.AlgorithmNamespaces.XmlDsigExcC14NTransform:t=new Fn;break;case Dr.AlgorithmNamespaces.XmlDsigExcC14NWithCommentsTransform:t=new Jn;break;case Dr.AlgorithmNamespaces.XmlDecryptionTransform:default:throw new b(y.ALGORITHM_NOT_SUPPORTED,e)}return t}},{key:"CreateSignatureAlgorithm",value:function(e){var t=Ca[e.Algorithm]||null;if(t)return new t;if(e.Algorithm===En){var r=void 0;if(e.Any.Some(function(e){return e instanceof ma&&(r=e),!!r}),r)switch(r.DigestMethod.Algorithm){case Jr:return new On(r.SaltLength);case qr:return new Bn(r.SaltLength);case Wr:return new xn(r.SaltLength);case Qr:return new Un(r.SaltLength)}throw new b(y.CRYPTOGRAPHIC,"Cannot get params for RSA-PSS algoriithm")}throw new Error("signature algorithm '"+e.Algorithm+"' is not supported")}},{key:"CreateHashAlgorithm",value:function(e){var t=wa[e];if(t)return new t;throw new Error("hash algorithm '"+e+"' is not supported")}},{key:"GetHashAlgorithm",value:function(e){var t="string"==typeof e?{name:e}:e;switch(t.name.toUpperCase()){case Kr:return new zr;case Xr:return new Yr;case Gr:return new Zr;case Fr:return new $r;default:throw new b(y.ALGORITHM_NOT_SUPPORTED,t.name)}}},{key:"GetSignatureAlgorithm",value:function(e){"string"==typeof e.hash&&(e.hash={name:e.hash});var t=e.hash.name;if(!t)throw new Error("Signing algorithm doesn't have name for hash");var r=void 0;switch(e.name.toUpperCase()){case bn.toUpperCase():switch(t.toUpperCase()){case Kr:r=new Sn;break;case Xr:r=new An;break;case Gr:r=new _n;break;case Fr:r=new Pn;break;default:throw new b(y.ALGORITHM_NOT_SUPPORTED,e.name+":"+t)}break;case In.toUpperCase():var n=e.saltLength;switch(t.toUpperCase()){case Kr:r=new On(n);break;case Xr:r=new Bn(n);break;case Gr:r=new xn(n);break;case Fr:r=new Un(n);break;default:throw new b(y.ALGORITHM_NOT_SUPPORTED,e.name+":"+t)}break;case en:switch(t.toUpperCase()){case Kr:r=new sn;break;case Xr:r=new on;break;case Gr:r=new ln;break;case Fr:r=new un;break;default:throw new b(y.ALGORITHM_NOT_SUPPORTED,e.name+":"+t)}break;case cn:switch(t.toUpperCase()){case Kr:r=new vn;break;case Xr:r=new dn;break;case Gr:r=new yn;break;case Fr:r=new gn;break;default:throw new b(y.ALGORITHM_NOT_SUPPORTED,e.name+":"+t)}break;default:throw new b(y.ALGORITHM_NOT_SUPPORTED,e.name)}return r}}]),e}(),Sa=function(){function e(t){if(_classCallCheck(this,e),this.signature=new ea,t&&t.nodeType===C.Document)this.document=t;else if(t&&t.nodeType===C.Element){var r=(new XMLSerializer).serializeToString(t);this.document=(new DOMParser).parseFromString(r,S)}}return _createClass(e,[{key:"Sign",value:function(e,t,r,n){var a=this,i=void 0,s=void 0;return Promise.resolve().then(function(){var r=B({},t.algorithm,e);return i=Na.GetSignatureAlgorithm(r),a.ApplySignOptions(a.XmlSignature,e,t,n)}).then(function(){return s=a.XmlSignature.SignedInfo,a.DigestReferences(r.documentElement)}).then(function(){if(s.SignatureMethod.Algorithm=i.namespaceURI,In.toUpperCase()===e.name.toUpperCase()){var n=B({},t.algorithm,e);"string"==typeof n.hash&&(n.hash={name:n.hash});var o=new ma(n);a.XmlSignature.SignedInfo.SignatureMethod.Any.Add(o)}else if(cn.toUpperCase()===e.name.toUpperCase()){var l=0,u=t.algorithm;switch(u.hash.name.toUpperCase()){case Kr:l=u.length||160;break;case Xr:l=u.length||256;break;case Gr:l=u.length||384;break;case Fr:l=u.length||512}a.XmlSignature.SignedInfo.SignatureMethod.HMACOutputLength=l}var c=a.TransformSignedInfo(r);return i.Sign(c,t,e)}).then(function(e){return a.Key=t,a.XmlSignature.SignatureValue=new Uint8Array(e),a.document=r,a.XmlSignature})}},{key:"Verify",value:function(e){var t=this;return Promise.resolve().then(function(){var e=t.document;if(!e||!e.documentElement)throw new b(y.NULL_PARAM,"SignedXml","document");return t.ValidateReferences(e.documentElement)}).then(function(r){if(r){var n=Promise.resolve([]);return(n=e?n.then(function(){return[e]}):n.then(function(){return t.GetPublicKeys()})).then(function(e){return t.ValidateSignatureValue(e)})}return!1})}},{key:"GetXml",value:function(){return this.signature.GetXml()}},{key:"LoadXml",value:function(e){this.signature=ea.LoadXml(e)}},{key:"toString",value:function(){var e=this.XmlSignature;if(e.SignedInfo.References&&e.SignedInfo.References.Some(function(e){return e.Transforms&&e.Transforms.Some(function(e){return e instanceof Gn})})){var t=this.document.documentElement.cloneNode(!0),r=this.XmlSignature.GetXml();if(!r)throw new b(y.XML_EXCEPTION,"Cannot get Xml element from Signature");var n=r.cloneNode(!0);return t.appendChild(n),(new XMLSerializer).serializeToString(t)}return this.XmlSignature.toString()}},{key:"GetPublicKeys",value:function(){var e=this,t=[];return Promise.resolve().then(function(){var r=e.XmlSignature.KeyInfo.GetIterator(),n=[];return r.forEach(function(r){var a=Na.CreateSignatureAlgorithm(e.XmlSignature.SignedInfo.SignatureMethod);r instanceof ba?r.Certificates.forEach(function(e){n.push(e.exportKey(a.algorithm).then(function(e){t.push(e)}))}):n.push(r.exportKey(a.algorithm).then(function(e){t.push(e)}))}),Promise.all(n)}).then(function(){return t})}},{key:"GetSignatureNamespaces",value:function(){var e={};return this.XmlSignature.NamespaceURI&&(e[this.XmlSignature.Prefix||""]=this.XmlSignature.NamespaceURI),e}},{key:"CopyNamespaces",value:function(e,t,r){var n;this.InjectNamespaces((function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t&&t.nodeType===C.Element){var n=t;n.namespaceURI&&"http://www.w3.org/XML/1998/namespace"!==n.namespaceURI&&Aa(r,n.prefix?n.prefix:"",t.namespaceURI);for(var a=0;a<n.attributes.length;a++){var i=n.attributes.item(a);"xmlns"===i.prefix&&Aa(r,i.localName?i.localName:"",i.value)}t.parentNode&&e(t.parentNode,r)}}(e,n={}),n),t,r)}},{key:"InjectNamespaces",value:function(e,t,r){for(var n in e){var a=e[n];r&&""===n||t.setAttribute("xmlns"+(n?":"+n:""),a)}}},{key:"DigestReference",value:function(e,t,r){var n=this;return Promise.resolve().then(function(){if(t.Uri){var r=void 0;if(t.Uri.indexOf("#xpointer"))"#"===t.Uri[0]&&(r=t.Uri.substring(1));else{var a=t.Uri;(a=(a=a.substring(9).replace(/[\r\n\t\s]/g,"")).length<2||"("!==a[0]||")"!==a[a.length-1]?"":a.substring(1,a.length-1)).length>6&&0===a.indexOf("id(")&&")"===a[a.length-1]&&(r=a.substring(4,a.length-2))}if(r){var i=null;if(n.XmlSignature.ObjectList&&n.XmlSignature.ObjectList.Some(function(t){if(i=function e(t,r){if(t.nodeType!==C.Element)return null;if(t.hasAttribute("Id")&&t.getAttribute("Id")===r)return t;if(t.childNodes&&t.childNodes.length)for(var n=0;n<t.childNodes.length;n++){var a=e(t.childNodes[n],r);if(a)return a}return null}(t.GetXml(),r)){var a=i.cloneNode(!0);if(n.CopyNamespaces(e,a,!1),n.Parent){var s=n.Parent instanceof D?n.Parent.GetXml():n.Parent;n.CopyNamespaces(s,a,!0)}return n.CopyNamespaces(i,a,!1),n.InjectNamespaces(n.GetSignatureNamespaces(),a,!0),e=a,!0}return!1}),!i&&e&&(i=D.GetElementById(e,r))){var s=i.cloneNode(!0);n.CopyNamespaces(i,s,!1),n.CopyNamespaces(e,s,!1),e=s}if(null==i)throw new b(y.CRYPTOGRAPHIC,"Cannot get object by reference: "+r)}}var o=null;if(t.Transforms&&t.Transforms.Count)o=n.ApplyTransforms(t.Transforms,e);else if(t.Uri&&"#"!==t.Uri[0])o=(new XMLSerializer).serializeToString(e.ownerDocument);else{var l=new Kn;l.LoadInnerXml(e),o=l.GetOutput()}if(!t.DigestMethod.Algorithm)throw new b(y.NULL_PARAM,"Reference","DigestMethod");return Na.CreateHashAlgorithm(t.DigestMethod.Algorithm).Digest(o)})}},{key:"DigestReferences",value:function(e){var t=this;return Promise.resolve().then(function(){var r=t.XmlSignature.SignedInfo.References.Map(function(r){return r.DigestMethod.Algorithm||(r.DigestMethod.Algorithm=(new Yr).namespaceURI),t.DigestReference(e,r,!1).then(function(e){r.DigestValue=e})}).GetIterator();return Promise.all(r)})}},{key:"TransformSignedInfo",value:function(e){var t=Na.CreateFromName(this.XmlSignature.SignedInfo.CanonicalizationMethod.Algorithm),r=this.XmlSignature.SignedInfo.GetXml();if(!r)throw new b(y.XML_EXCEPTION,"Cannot get Xml element from SignedInfo");var n=r.cloneNode(!0);if(this.CopyNamespaces(r,n,!1),e&&(e.nodeType===C.Document?this.CopyNamespaces(e.documentElement,n,!1):this.CopyNamespaces(e,n,!1)),this.Parent){var a=this.Parent instanceof D?this.Parent.GetXml():this.Parent;a&&this.CopyNamespaces(a,n,!1)}var i=O(r);for(var s in i){var o=i[s];s!==n.prefix&&n.setAttribute("xmlns"+(s?":"+s:""),o)}return t.LoadInnerXml(n),t.GetOutput()}},{key:"ResolveTransform",value:function(e){switch(e){case"enveloped":return new Gn;case"c14n":return new Kn;case"c14n-com":return new Xn;case"exc-c14n":return new Fn;case"exc-c14n-com":return new Jn;case"base64":return new Mn;default:throw new b(y.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM,e)}}},{key:"ApplyTransforms",value:function(e,t){var r=null;if(e.Sort(function(e,t){return t instanceof Gn?1:0}).ForEach(function(e){e instanceof Xn&&(e=new Kn),e instanceof Jn&&(e=new Fn),e.LoadInnerXml(t),r=e.GetOutput()}),1===e.Count&&e.Item(0)instanceof Gn){var n=new Kn;n.LoadInnerXml(t),r=n.GetOutput()}return r}},{key:"ApplySignOptions",value:function(e,t,r){var n=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Promise.resolve().then(function(){if(a.keyValue&&r.algorithm.name.toUpperCase()!==cn){e.KeyInfo||(e.KeyInfo=new Hn);var t=e.KeyInfo,n=new fa;return t.Add(n),n.importKey(a.keyValue)}return Promise.resolve()}).then(function(){if(a.x509){e.KeyInfo||(e.KeyInfo=new Hn);var t=e.KeyInfo;a.x509.forEach(function(e){var r=N.FromBase64(e),n=new ba(r);t.Add(n)})}return Promise.resolve()}).then(function(){if(a.references&&a.references.forEach(function(t){var r=new Qn;t.id&&(r.Id=t.id),t.uri&&(r.Uri=t.uri),t.type&&(r.Type=t.type);var a=Na.GetHashAlgorithm(t.hash);if(r.DigestMethod.Algorithm=a.namespaceURI,t.transforms&&t.transforms.length){var i=new qn;t.transforms.forEach(function(e){i.Add(n.ResolveTransform(e))}),r.Transforms=i}e.SignedInfo.References||(e.SignedInfo.References=new zn),e.SignedInfo.References.Add(r)}),!e.SignedInfo.References.Count){var t=new Qn;e.SignedInfo.References.Add(t)}return Promise.resolve()})}},{key:"ValidateReferences",value:function(e){var t=this;return Promise.resolve().then(function(){return Promise.all(t.XmlSignature.SignedInfo.References.Map(function(r){return t.DigestReference(e,r,!1).then(function(e){var t=N.ToBase64(e),n=N.ToString(r.DigestValue,"base64");if(t!==n){var a="Invalid digest for uri '"+r.Uri+"'. Calculated digest is "+t+" but the xml to validate supplies digest "+n;throw new b(y.CRYPTOGRAPHIC,a)}return Promise.resolve(!0)})}).GetIterator())}).then(function(){return!0})}},{key:"ValidateSignatureValue",value:function(e){var t=this,r=void 0,n=void 0;return Promise.resolve().then(function(){n=t.TransformSignedInfo(t.document),r=Na.CreateSignatureAlgorithm(t.XmlSignature.SignedInfo.SignatureMethod);var a=Promise.resolve(!1);return e.forEach(function(e){a=a.then(function(a){return a?Promise.resolve(a):r.Verify(n,e,t.Signature)})}),a})}},{key:"XmlSignature",get:function(){return this.signature}},{key:"Signature",get:function(){return this.XmlSignature.SignatureValue}}]),e}();function Aa(e,t,r){t in e||(e[t]=r)}var _a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([m({parser:jn,required:!0})],t.prototype,"DigestMethod",void 0),n([m({localName:Dr.ElementNames.DigestValue,namespaceURI:Dr.NamespaceURI,prefix:Dr.DefaultPrefix,converter:x,required:!0})],t.prototype,"DigestValue",void 0),t=n([h({localName:j.ElementNames.DigestAlgAndValue})],t)}(H),Pa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.IssuerSerial,namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix})],t)}(ga),Ia=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([m({localName:j.ElementNames.CertDigest,parser:_a,required:!0})],t.prototype,"CertDigest",void 0),n([m({parser:Pa,required:!0})],t.prototype,"IssuerSerial",void 0),n([f({localName:j.AttributeNames.URI})],t.prototype,"Uri",void 0),t=n([h({localName:j.ElementNames.Cert})],t)}(H),Ea=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:"CertIDList",parser:Ia})],t)}(V),Ra=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.SigningCertificate})],t)}(Ea),Oa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),n([m({localName:j.ElementNames.CertRefs,parser:Ea,required:!0})],t.prototype,"CertRefs",void 0),t=n([h({localName:j.ElementNames.CompleteCertificateRefs})],t)}(H),Ba=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,xa=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,Ua=/[^-+\dA-Z]/g;function Da(e,t,r,n){if(1!==arguments.length||"string"!==function(e){if(null===e)return"null";if(void 0===e)return"undefined";if("object"!==(void 0===e?"undefined":_typeof(e)))return void 0===e?"undefined":_typeof(e);if(Array.isArray(e))return"array";return{}.toString.call(e).slice(8,-1).toLowerCase()}(e)||/\d/.test(e)||(t=e,e=void 0),(e=e||new Date)instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");var a=(t=String(La[t]||t||La.default)).slice(0,4);"UTC:"!==a&&"GMT:"!==a||(t=t.slice(4),r=!0,"GMT:"===a&&(n=!0));var i=r?"getUTC":"get",s=e[i+"Date"](),o=e[i+"Day"](),l=e[i+"Month"](),u=e[i+"FullYear"](),c=e[i+"Hours"](),h=e[i+"Minutes"](),m=e[i+"Seconds"](),f=e[i+"Milliseconds"](),p=r?0:e.getTimezoneOffset(),v=function(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var r=new Date(t.getFullYear(),0,4);r.setDate(r.getDate()-(r.getDay()+6)%7+3);var n=t.getTimezoneOffset()-r.getTimezoneOffset();t.setHours(t.getHours()-n);var a=(t.getTime()-r.getTime())/6048e5;return 1+Math.floor(a)}(e),d=function(e){var t=e.getDay();0===t&&(t=7);return t}(e),y={d:s,dd:ja(s),ddd:Ta.dayNames[o],dddd:Ta.dayNames[o+7],m:l+1,mm:ja(l+1),mmm:Ta.monthNames[l],mmmm:Ta.monthNames[l+12],yy:String(u).slice(2),yyyy:u,h:c%12||12,hh:ja(c%12||12),H:c,HH:ja(c),M:h,MM:ja(h),s:m,ss:ja(m),l:ja(f,3),L:ja(Math.round(f/10)),t:c<12?Ta.timeNames[0]:Ta.timeNames[1],tt:c<12?Ta.timeNames[2]:Ta.timeNames[3],T:c<12?Ta.timeNames[4]:Ta.timeNames[5],TT:c<12?Ta.timeNames[6]:Ta.timeNames[7],Z:n?"GMT":r?"UTC":(String(e).match(xa)||[""]).pop().replace(Ua,""),o:(p>0?"-":"+")+ja(100*Math.floor(Math.abs(p)/60)+Math.abs(p)%60,4),W:v,N:d};return t.replace(Ba,function(e){return e in y?y[e]:e.slice(1,e.length-1)})}var La={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},Ta={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]};function ja(e,t){for(void 0===t&&(t=2),e=String(e);e.length<t;)e="0"+e;return e}var Ha=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.OnLoadXml=function(e){e.textContent&&(this.Value=new Date(e.textContent))},t.prototype.OnGetXml=function(e){this.Format?e.textContent=Da(this.Value,this.Format):e.textContent=this.Value.toISOString()},n([p({defaultValue:new Date,required:!0})],t.prototype,"Value",void 0),t=n([h({localName:"XadesDateTime",namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix})],t)}(H),Va=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.OtherRef})],t)}(M),Ma=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.OtherRefs})],t)}(V),Ka=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([m({localName:j.ElementNames.ByName,namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix,required:!0})],t.prototype,"ByName",void 0),n([m({localName:j.ElementNames.ByKey,namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix,converter:x,required:!0})],t.prototype,"ByKey",void 0),t=n([h({localName:j.ElementNames.OCSPIdentifier})],t)}(H),Xa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.URI,defaultValue:""})],t.prototype,"URI",void 0),n([m({parser:Ka,required:!0})],t.prototype,"ResponderID",void 0),n([m({localName:j.ElementNames.IssueTime,parser:Ha,required:!0})],t.prototype,"ProducedAt",void 0),t=n([h({localName:j.ElementNames.OCSPIdentifier})],t)}(H),Ga=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([m({parser:Xa})],t.prototype,"OCSPIdentifier",void 0),n([m({parser:_a,required:!0})],t.prototype,"DigestAlgAndValue",void 0),t=n([h({localName:j.ElementNames.OCSPRef})],t)}(H),Fa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.OCSPRefs})],t)}(V),Ja=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.URI,defaultValue:""})],t.prototype,"URI",void 0),n([m({localName:j.ElementNames.Issuer,namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix,required:!0})],t.prototype,"Issuer",void 0),n([m({localName:j.ElementNames.IssueTime,parser:Ha,required:!0})],t.prototype,"IssueTime",void 0),n([m({localName:j.ElementNames.Number,namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix,converter:U})],t.prototype,"Number",void 0),t=n([h({localName:j.ElementNames.CRLIdentifier})],t)}(H),qa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([m({parser:_a,required:!0})],t.prototype,"DigestAlgAndValue",void 0),n([m({parser:Ja})],t.prototype,"CRLIdentifier",void 0),t=n([h({localName:j.ElementNames.CRLRef})],t)}(H),Wa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.CRLRefs})],t)}(V),Qa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),n([m({parser:Wa})],t.prototype,"CRLRefs",void 0),n([m({parser:Fa})],t.prototype,"OCSPRefs",void 0),n([m({parser:Ma})],t.prototype,"OtherRefs",void 0),t=n([h({localName:j.ElementNames.CompleteRevocationRefs})],t)}(H),za=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([m({parser:ea,required:!0})],t.prototype,"Signature",void 0),t=n([h({localName:j.ElementNames.CounterSignature})],t)}(H),Ya=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.ObjectReference,required:!0})],t.prototype,"ObjectReference",void 0),n([m({localName:j.ElementNames.Description,namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix})],t.prototype,"Description",void 0),n([m({parser:$})],t.prototype,"ObjectIdentifier",void 0),n([m({localName:j.ElementNames.MimeType,namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix})],t.prototype,"MimeType",void 0),n([m({localName:j.ElementNames.Encoding,namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix})],t.prototype,"Encoding",void 0),t=n([h({localName:j.ElementNames.DataObjectFormat})],t)}(H),Za=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.URI,defaultValue:"",required:!0})],t.prototype,"Uri",void 0),n([f({localName:j.AttributeNames.ReferencedData,defaultValue:!1})],t.prototype,"ReferencedData",void 0),t=n([h({localName:j.ElementNames.Include})],t)}(H),$a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.URI,defaultValue:""})],t.prototype,"Uri",void 0),n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),n([m({localName:Dr.ElementNames.DigestMethod,namespaceURI:Dr.NamespaceURI,prefix:Dr.DefaultPrefix,required:!0})],t.prototype,"DigestMethod",void 0),n([m({localName:Dr.ElementNames.DigestMethod,namespaceURI:Dr.NamespaceURI,prefix:Dr.DefaultPrefix,converter:x,required:!0})],t.prototype,"DigestValue",void 0),t=n([h({localName:j.ElementNames.ReferenceInfo})],t)}(H),ei=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:"ReferenceInfos",parser:$a})],t)}(V),ti=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.EncapsulatedTimeStamp})],t)}(G),ri=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:"EncapsulatedPKIDatas",parser:ti})],t)}(V),ni=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.XMLTimeStamp})],t)}(M),ai=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:"XMLTimeStampCollection",parser:ni})],t)}(V),ii=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),n([m({parser:Za})],t.prototype,"Include",void 0),n([m({parser:ei,noRoot:!0})],t.prototype,"ReferenceInfo",void 0),n([m({parser:Dn})],t.prototype,"CanonicalizationMethod",void 0),n([m({parser:ri,noRoot:!0})],t.prototype,"EncapsulatedTimeStamp",void 0),n([m({parser:ai,noRoot:!0})],t.prototype,"XMLTimeStamp",void 0),t=n([h({localName:"GenericTimeStamp"})],t)}(H),si=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),n([m({parser:ei,noRoot:!0})],t.prototype,"ReferenceInfo",void 0),n([m({parser:Dn})],t.prototype,"CanonicalizationMethod",void 0),n([m({parser:ri,noRoot:!0})],t.prototype,"EncapsulatedTimeStamp",void 0),n([m({parser:ai,noRoot:!0})],t.prototype,"XMLTimeStamp",void 0),t=n([h({localName:j.ElementNames.OtherTimeStamp})],t)}(H),oi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),n([m({parser:Za})],t.prototype,"Include",void 0),n([m({parser:Dn})],t.prototype,"CanonicalizationMethod",void 0),n([m({parser:ri,noRoot:!0})],t.prototype,"EncapsulatedTimeStamp",void 0),n([m({parser:ai,noRoot:!0})],t.prototype,"XMLTimeStamp",void 0),t=n([h({localName:j.ElementNames.XAdESTimeStamp})],t)}(H),li=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.IndividualDataObjectsTimeStamp})],t)}(oi),ui=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:"IndividualDataObjectsTimeStampCollection",parser:li})],t)}(V),ci=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.AllDataObjectsTimeStamp})],t)}(oi),hi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:"DataObjectFormatCollection",parser:Ya})],t)}(V),mi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:"CommitmentTypeIndicationCollection",parser:ie})],t)}(V),fi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:"AllDataObjectsTimeStampCollection",parser:ci})],t)}(V),pi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),n([m({parser:hi,noRoot:!0})],t.prototype,"DataObjectFormats",void 0),n([m({parser:mi,noRoot:!0})],t.prototype,"CommitmentTypeIndications",void 0),n([m({parser:fi,noRoot:!0})],t.prototype,"AllDataObjectsTimeStamps",void 0),n([m({parser:ui,noRoot:!0})],t.prototype,"IndividualDataObjectsTimeStamps",void 0),t=n([h({localName:j.ElementNames.SignedDataObjectProperties})],t)}(H),vi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.SigPolicyId})],t)}($),di=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.SigPolicyHash})],t)}(_a),yi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.SigPolicyQualifier})],t)}(K),gi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([p({converter:U,required:!0})],t.prototype,"Value",void 0),t=n([h({localName:"int"})],t)}(H),bi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:"IntegerList",parser:gi})],t)}(V),ki=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([m({localName:j.ElementNames.Organization,namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix,required:!0})],t.prototype,"Organization",void 0),n([m({localName:j.ElementNames.NoticeNumbers,parser:bi,required:!0})],t.prototype,"NoticeNumbers",void 0),t=n([h({localName:j.ElementNames.NoticeRef})],t)}(H),Ci=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([m({localName:j.ElementNames.NoticeRef,parser:ki})],t.prototype,"NoticeRef",void 0),n([m({localName:j.ElementNames.ExplicitText,namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix})],t.prototype,"ExplicitText",void 0),t=n([h({localName:j.ElementNames.SPUserNotice})],t)}(H),wi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([p()],t.prototype,"Value",void 0),t=n([h({localName:j.ElementNames.SPURI})],t)}(H),Ni=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.SigPolicyQualifiers,parser:yi})],t)}(V),Si=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([m({localName:j.ElementNames.SigPolicyId,parser:vi,required:!0})],t.prototype,"SigPolicyId",void 0),n([m({parser:qn})],t.prototype,"Transforms",void 0),n([m({localName:j.ElementNames.SigPolicyHash,parser:di,required:!0})],t.prototype,"SigPolicyHash",void 0),n([m({localName:j.ElementNames.SigPolicyQualifiers,parser:Ni})],t.prototype,"SigPolicyQualifiers",void 0),t=n([h({localName:j.ElementNames.SignaturePolicyId})],t)}(H),Ai={set:function(e){return!0},get:function(e){return""}},_i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([m({localName:j.ElementNames.SignaturePolicyId,namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix,parser:Si})],t.prototype,"SignaturePolicyId",void 0),n([m({localName:j.ElementNames.SignaturePolicyImplied,namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix,converter:Ai,defaultValue:!1})],t.prototype,"SignaturePolicyImplied",void 0),t=n([h({localName:j.ElementNames.SignaturePolicyIdentifier})],t)}(H),Pi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([m({localName:j.ElementNames.City,defaultValue:"",namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix})],t.prototype,"City",void 0),n([m({localName:j.ElementNames.StateOrProvince,defaultValue:"",namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix})],t.prototype,"StateOrProvince",void 0),n([m({localName:j.ElementNames.PostalCode,defaultValue:"",namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix})],t.prototype,"PostalCode",void 0),n([m({localName:j.ElementNames.CountryName,defaultValue:"",namespaceURI:j.NamespaceURI,prefix:j.DefaultPrefix})],t.prototype,"CountryName",void 0),t=n([h({localName:j.ElementNames.SignatureProductionPlace})],t)}(H),Ii=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.ClaimedRole})],t)}(M),Ei=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.ClaimedRoles,parser:Ii})],t)}(V),Ri=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.CertifiedRole})],t)}(G),Oi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.CertifiedRoles,parser:Ri})],t)}(V),Bi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([m({parser:Ei})],t.prototype,"ClaimedRoles",void 0),n([m({parser:Oi})],t.prototype,"CertifiedRoles",void 0),t=n([h({localName:j.ElementNames.SignerRole})],t)}(H),xi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),n([m({localName:j.ElementNames.SigningTime,parser:Ha})],t.prototype,"SigningTime",void 0),n([m({parser:Ra})],t.prototype,"SigningCertificate",void 0),n([m({parser:_i})],t.prototype,"SignaturePolicyIdentifier",void 0),n([m({parser:Pi})],t.prototype,"SignatureProductionPlace",void 0),n([m({parser:Bi})],t.prototype,"SignerRole",void 0),t=n([h({localName:j.ElementNames.SignedSignatureProperties})],t)}(H),Ui=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),n([m({parser:xi})],t.prototype,"SignedSignatureProperties",void 0),n([m({parser:pi})],t.prototype,"SignedDataObjectProperties",void 0),t=n([h({localName:j.ElementNames.SignedProperties})],t)}(H),Di=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.UnsignedDataObjectProperty})],t)}(M),Li=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),t=n([h({localName:j.ElementNames.UnsignedSignatureProperties,parser:Di})],t)}(V),Ti=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.OtherValue})],t)}(G),ji=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.OCSPValues,parser:Ti})],t)}(V),Hi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.EncapsulatedOCSPValue})],t)}(G),Vi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.OCSPValues})],t)}(V),Mi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.EncapsulatedCRLValue})],t)}(G),Ki=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.CRLValues,parser:Mi})],t)}(V),Xi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),n([m({parser:Ki})],t.prototype,"CRLValues",void 0),n([m({parser:Vi})],t.prototype,"OCSPValues",void 0),n([m({parser:ji})],t.prototype,"OtherValues",void 0),t=n([h({localName:j.ElementNames.RevocationValues})],t)}(H),Gi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.SignatureTimeStamp})],t)}(oi),Fi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.SigAndRefsTimeStamp})],t)}(oi),Ji=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.RefsOnlyTimeStamp})],t)}(oi),qi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.ArchiveTimeStamp})],t)}(oi),Wi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.AttributeCertificateRefs})],t)}(Oa),Qi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.AttributeRevocationRefs})],t)}(Qa),zi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.AttrAuthoritiesCertValues})],t)}(Q),Yi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:j.ElementNames.AttributeRevocationValues})],t)}(Xi),Zi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t=n([h({localName:"UnsignedSignatureProperty"})],t)}(H),$i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.OnLoadXml=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes.item(t);if(r.nodeType===C.Element){var n=void 0;switch(r.localName){case j.ElementNames.CounterSignature:n=za;break;case j.ElementNames.SignatureTimeStamp:n=Gi;break;case j.ElementNames.CompleteCertificateRefs:n=Oa;break;case j.ElementNames.CompleteRevocationRefs:n=Qa;break;case j.ElementNames.AttributeCertificateRefs:n=Wi;break;case j.ElementNames.AttributeRevocationRefs:n=Qi;break;case j.ElementNames.SigAndRefsTimeStamp:n=Fi;break;case j.ElementNames.RefsOnlyTimeStamp:n=Ji;break;case j.ElementNames.CertificateValues:n=Q;break;case j.ElementNames.RevocationValues:n=Xi;break;case j.ElementNames.AttrAuthoritiesCertValues:n=zi;break;case j.ElementNames.AttributeRevocationValues:n=Yi;break;case j.ElementNames.ArchiveTimeStamp:n=qi}if(n){var a=n.LoadXml(r);this.Add(a)}}}},n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),t=n([h({localName:j.ElementNames.UnsignedSignatureProperties,parser:Zi})],t)}(V),es=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),n([m({parser:$i})],t.prototype,"UnsignedSignatureProperties",void 0),n([m({parser:Li})],t.prototype,"UnsignedDataObjectProperties",void 0),t=n([h({localName:j.ElementNames.UnsignedProperties})],t)}(H),ts=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.Target,required:!0})],t.prototype,"Target",void 0),n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),n([m({parser:Ui})],t.prototype,"SignedProperties",void 0),n([m({parser:es})],t.prototype,"UnsignedProperties",void 0),t=n([h({localName:j.ElementNames.QualifyingProperties})],t)}(H),rs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([f({localName:j.AttributeNames.URI,required:!0})],t.prototype,"Uri",void 0),n([f({localName:j.AttributeNames.Id,defaultValue:""})],t.prototype,"Id",void 0),t=n([h({localName:j.ElementNames.QualifyingPropertiesReference})],t)}(H),ns=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),n([m({parser:ts})],t.prototype,"QualifyingProperties",void 0),t=n([h({localName:Dr.ElementNames.Object})],t)}(Ln),as=Object.freeze({Any:M,AnyCollection:K,OtherCertificate:F,OtherCertificateCollection:J,EncapsulatedX509Certificate:q,EncapsulatedX509CertificateCollection:W,CertificateValues:Q,CommitmentTypeQualifier:ee,CommitmentTypeQualifiers:te,ObjectReference:re,ObjectReferenceCollection:ne,CommitmentTypeIndication:ie,CompleteCertificateRefs:Oa,OtherRef:Va,OtherRefs:Ma,ResponderID:Ka,OCSPIdentifier:Xa,OCSPRef:Ga,OCSPRefs:Fa,CRLIdentifier:Ja,CRLRef:qa,CRLRefs:Wa,CompleteRevocationRefs:Qa,CounterSignature:za,DataObjectFormat:Ya,XadesDateTime:Ha,EncapsulatedPKIData:G,Include:Za,ReferenceInfo:$a,ReferenceInfos:ei,EncapsulatedTimeStamp:ti,EncapsulatedTimeStampCollection:ri,XMLTimeStamp:ni,XMLTimeStampCollection:ai,GenericTimeStamp:ii,Identifier:z,DocumentationReference:Y,DocumentationReferences:Z,ObjectIdentifier:$,OtherTimeStamp:si,QualifyingProperties:ts,QualifyingPropertiesReference:rs,OtherValue:Ti,OtherValues:ji,EncapsulatedOCSPValue:Hi,OCSPValues:Vi,EncapsulatedCRLValue:Mi,CRLValues:Ki,RevocationValues:Xi,SigPolicyId:vi,SigPolicyHash:di,SigPolicyQualifier:yi,Integer:gi,IntegerList:bi,NoticeReference:ki,SPUserNotice:Ci,SPURI:wi,SigPolicyQualifiers:Ni,SignaturePolicyId:Si,SignaturePolicyIdentifier:_i,SignatureProductionPlace:Pi,IndividualDataObjectsTimeStamp:li,IndividualDataObjectsTimeStampCollection:ui,AllDataObjectsTimeStamp:ci,DataObjectFormatCollection:hi,CommitmentTypeIndicationCollection:mi,AllDataObjectsTimeStampCollection:fi,SignedDataObjectProperties:pi,SignedProperties:Ui,SignedSignatureProperties:xi,ClaimedRole:Ii,ClaimedRoles:Ei,CertifiedRole:Ri,CertifiedRoles:Oi,SignerRole:Bi,DigestAlgAndValueType:_a,IssuerSerial:Pa,Cert:Ia,CertIDList:Ea,SigningCertificate:Ra,UnsignedDataObjectProperty:Di,UnsignedDataObjectProperties:Li,UnsignedProperties:es,SignatureTimeStamp:Gi,SigAndRefsTimeStamp:Fi,RefsOnlyTimeStamp:Ji,ArchiveTimeStamp:qi,AttributeCertificateRefs:Wi,AttributeRevocationRefs:Qi,AttrAuthoritiesCertValues:zi,AttributeRevocationValues:Yi,UnsignedSignatureProperty:Zi,UnsignedSignatureProperties:$i,XAdESTimeStamp:oi,DataObject:ns,XmlXades:j}),is=function(e){function t(t){var r=e.call(this,t)||this;return r.properties=null,r.CreateQualifyingProperties(),r}return r(t,e),Object.defineProperty(t.prototype,"Properties",{get:function(){return this.properties},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SignedProperties",{get:function(){if(!this.Properties)throw new b(y.XML_EXCEPTION,"Properties is empty");return this.Properties.SignedProperties},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"UnsignedProperties",{get:function(){if(!this.Properties)throw new b(y.XML_EXCEPTION,"Properties is empty");return this.Properties.UnsignedProperties},enumerable:!0,configurable:!0}),t.prototype.LoadXml=function(t,r){e.prototype.LoadXml.call(this,t);var n=null;this.XmlSignature.ObjectList.Some(function(e){if(e.Element)for(var t=0;t<e.Element.childNodes.length;t++){var r=e.Element.childNodes.item(t);if(r.nodeType===C.Element&&r.localName===j.ElementNames.QualifyingProperties)return n=ts.LoadXml(r),!0}return!1}),this.properties=n},t.prototype.Sign=function(t,r,n,a){return(i=e.prototype.Sign).apply.call(i,this,arguments);var i},t.prototype.CreateQualifyingProperties=function(){if(this.Properties)throw new b(y.XML_EXCEPTION,"Cannot create QualifyingProperties cause current signature has got one. You must create CounterSignature");var e=Er.crypto.getRandomValues(new Uint8Array(6)),t=N.ToHex(e);this.XmlSignature.Id="id-"+t;var r=new ns;r.QualifyingProperties.Target="#"+this.XmlSignature.Id,r.QualifyingProperties.SignedProperties.Id="xades-"+this.XmlSignature.Id,this.properties=r.QualifyingProperties,this.XmlSignature.ObjectList.Add(r)},t.prototype.ApplySignOptions=function(t,r,n,s){return a(this,void 0,void 0,function(){var a,o,l;return i(this,function(i){switch(i.label){case 0:return[4,e.prototype.ApplySignOptions.call(this,t,r,n,s)];case 1:return i.sent(),this.Properties?(this.Properties.SignedProperties.SignedSignatureProperties.SigningTime.Value=new Date,a=B({},r,n.algorithm),o=a.hash,(l=new Qn).Type="http://uri.etsi.org/01903#SignedProperties",l.Uri="#"+this.Properties.SignedProperties.Id,l.DigestMethod.Algorithm=Na.GetHashAlgorithm(o).namespaceURI,t.SignedInfo.References.Add(l),[4,this.ApplySigningCertificate(s.signingCertificate)]):[3,4];case 2:return i.sent(),[4,this.ApplySignaturePolicyIdentifier(s.policy)];case 3:i.sent(),this.ApplySignatureProductionPlace(s.productionPlace),this.ApplySignerRoles(s.signerRole),i.label=4;case 4:return[2]}})})},t.prototype.ApplySigningCertificate=function(e){return a(this,void 0,void 0,function(){var t,r,n,a,s,o;return i(this,function(i){switch(i.label){case 0:if(!this.Properties||!e)return[3,2];if(t=N.FromBase64(e),r=new ya(t),this.Properties.SignedProperties.SignedSignatureProperties.SigningCertificate.Count)throw new b(y.XML_EXCEPTION,"Signature can contain only one SigningCertificate");return(n=new Ia).IssuerSerial.X509IssuerName=r.Issuer,n.IssuerSerial.X509SerialNumber=r.SerialNumber,a=Na.GetHashAlgorithm("SHA-256"),n.CertDigest.DigestMethod.Algorithm=a.namespaceURI,s=n.CertDigest,o=Uint8Array.bind,[4,r.Thumbprint(a.algorithm.name)];case 1:s.DigestValue=new(o.apply(Uint8Array,[void 0,i.sent()])),this.Properties.SignedProperties.SignedSignatureProperties.SigningCertificate.Add(n),i.label=2;case 2:return[2]}})})},t.prototype.ApplySignaturePolicyIdentifier=function(e){return a(this,void 0,void 0,function(){var t,r,n,a,s,o,l,u=this;return i(this,function(i){switch(i.label){case 0:return this.Properties?(t=this.Properties.SignedProperties.SignedSignatureProperties,e&&"object"===(void 0===e?"undefined":_typeof(e))?((r=new Si).SigPolicyId=new vi,r.SigPolicyId.Identifier=new z,r.SigPolicyId.Identifier.Qualifier=e.identifier.qualifier,r.SigPolicyId.Identifier.Value=e.identifier.value,e.identifier.description&&(r.SigPolicyId.Description=e.identifier.description),e.identifier.references&&(r.SigPolicyId.DocumentationReferences=new Z,e.identifier.references.forEach(function(e){var t=new Y;t.Uri=e,r.SigPolicyId.DocumentationReferences.Add(t)})),e.transforms&&e.transforms.length&&(r.Transforms=new qn,e.transforms.forEach(function(e){r.Transforms.Add(u.ResolveTransform(e))})),r.SigPolicyHash=new di,r.SigPolicyHash.DigestMethod=new jn,n=Na.GetHashAlgorithm(e.hash),r.SigPolicyHash.DigestMethod.Algorithm=n.namespaceURI,a=r.SigPolicyId.Identifier.GetXml().cloneNode(!0),this.CopyNamespaces(a,a,!0),this.InjectNamespaces(this.GetSignatureNamespaces(),a,!0),s=null,r.Transforms&&r.Transforms.Count?s=this.ApplyTransforms(r.Transforms,a):((o=new Kn).LoadInnerXml(a),s=o.GetOutput()),l=r.SigPolicyHash,[4,n.Digest(s)]):[3,2]):[3,3];case 1:return l.DigestValue=i.sent(),e.qualifiers&&(r.SigPolicyQualifiers=new Ni,e.qualifiers.forEach(function(e){var t=new yi;if("string"==typeof e){var n=new wi;n.Value=e,t.Add(n)}else{var a=new Ci;e.explicitText&&(a.ExplicitText=e.explicitText),e.noticeRef&&(a.NoticeRef=new ki,a.NoticeRef.Organization=e.noticeRef.organization,a.NoticeRef.NoticeNumbers=new bi,e.noticeRef.noticeNumbers&&e.noticeRef.noticeNumbers.forEach(function(e){var t=new gi;t.Value=e,a.NoticeRef.NoticeNumbers.Add(t)})),t.Add(a)}r.SigPolicyQualifiers.Add(t)})),t.SignaturePolicyIdentifier.SignaturePolicyId=r,t.SignaturePolicyIdentifier.SignaturePolicyImplied=!1,[3,3];case 2:t.SignaturePolicyIdentifier.SignaturePolicyImplied=!0,i.label=3;case 3:return[2]}})})},t.prototype.ApplySignatureProductionPlace=function(e){if(this.Properties&&e){var t=this.Properties.SignedProperties.SignedSignatureProperties;e.city&&(t.SignatureProductionPlace.City=e.city),e.code&&(t.SignatureProductionPlace.PostalCode=e.code),e.country&&(t.SignatureProductionPlace.CountryName=e.country),e.state&&(t.SignatureProductionPlace.StateOrProvince=e.state)}},t.prototype.ApplySignerRoles=function(e){if(this.Properties&&e){var t=this.Properties.SignedProperties.SignedSignatureProperties;e.claimed&&e.claimed.forEach(function(e){var r=new Ii;r.Value=e,t.SignerRole.ClaimedRoles.Add(r)}),e.certified&&e.certified.forEach(function(e){var r=new Ri;r.Encoding="der",r.Value=N.FromBase64(e),t.SignerRole.CertifiedRoles.Add(r)})}},t.prototype.VerifySigningCertificate=function(){return a(this,void 0,void 0,function(){var e,t,r,n,a,s,o,l,u,c,h,m,f;return i(this,function(i){switch(i.label){case 0:if(e=null,!this.XmlSignature||!this.Properties)return[3,7];if(1!==(t=this.Properties.SignedProperties.SignedSignatureProperties).SigningCertificate.Count)throw new b(y.XML_EXCEPTION,"Signature has got wrong amount of SigningCertificate, MUST be one");r=Na.GetHashAlgorithm("SHA-256"),n=t.SigningCertificate.Item(0),a=N.ToBase64(n.CertDigest.DigestValue),s=this.XmlSignature.KeyInfo,o=0,i.label=1;case 1:if(s.Count,e)return[3,6];if(!((l=s.Item(o))instanceof ba))return[3,5];u=l.Certificates,c=0,i.label=2;case 2:return u.length,e?[3,5]:(h=u[c])?(f=Uint8Array.bind,[4,h.Thumbprint(r.algorithm)]):[3,4];case 3:m=new(f.apply(Uint8Array,[void 0,i.sent()])),N.ToBase64(m)===a&&(e=h),i.label=4;case 4:return c++,[3,2];case 5:return o++,[3,1];case 6:if(!e||e.Issuer!==n.IssuerSerial.X509IssuerName||e.SerialNumber!==n.IssuerSerial.X509SerialNumber)throw new b(y.XML_EXCEPTION,"SigningCertificate not found");i.label=7;case 7:return[2,e]}})})},t}(Sa),ss=as;e.xml=ss,e.Application=Er,e.Select=I,e.Parse=E,e.Convert=N,e.SignedXml=is,Object.defineProperty(e,"__esModule",{value:!0})});
