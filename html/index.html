<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>XADESJS tests</title>
    <link rel="stylesheet" media="all" href="css/mocha.css">
</head>

<body>
    <div id="mocha">
        <p><a href=".">Index</a></p>
    </div>
    <div id="messages"></div>
    <div id="fixtures"></div>
    <script src="src/mocha.js"></script>
    <!--Lib-->
    <script type="text/javascript" src="../node_modules/xpath.js/xpath.js"></script>
    <script type="text/javascript" src="../node_modules/asn1js/org/pkijs/common.js"></script>
    <script type="text/javascript" src="../node_modules/asn1js/org/pkijs/asn1.js"></script>
    <script type="text/javascript" src="../node_modules/pkijs/org/pkijs/x509_schema.js"></script>
    <script type="text/javascript" src="../node_modules/pkijs/org/pkijs/x509_simpl.js"></script>
    <script src="../built/xades.js"></script>
    <script src="src/test.js"></script>
    <!---->
    <script>
        mocha.setup('bdd')
    </script>
    <!--Test-->
    <script src="test/test.js"></script>
    <script src="test/c14n.js"></script>
    <script>
        var debug = false;
        if (!debug)
            mocha.run();
        else {
            function done(e){
                console.log("Done", e);
            }
            
            // function verifyXML(name, done) {
            //     readXml("./test/static/"+name, function(xml) {
            //         var signature = select(xml, "//*//*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']")[0];
            //         var sig = new xadesjs.SignedXml();
            //         sig.loadXml(signature);
            //         sig.checkSignature(xml)
            //             .then(function(v) {
            //                 assert.equal(v, true, "Wrong signature verifing");
            //                 done();
            //             })
            //             .catch(done);
            //     })
            // }
            
            // verifyXML("saml_external_ns.xml", done);
            
            function compare(xml, xpath, expected, inclusiveNamespacesPrefixList, done) {
                var doc = new DOMParser().parseFromString(xml, "application/xml")
                var elem = select(doc, xpath)[0]
                var can = new xadesjs.XmlDsigExcC14NWithCommentsTransform();
                var result = can.process(elem, { inclusiveNamespacesPrefixList: inclusiveNamespacesPrefixList }).toString()

                assert.equal(result, expected);
                done()
            }


        compare(
            "<root xmlns=\"foo\"><child><inner xmlns=\"\">123</inner></child></root>",
            "//*[local-name(.)='child']",
            "<child xmlns=\"foo\"><inner xmlns=\"\">123</inner></child>",
            null,
            done)

        }
    </script>
</body>

</html>